/* 
 * Marzipano - a 360Â° media viewer for the modern web (v0.1.1)
 *
 * Copyright (C) 2015 Digisfera Lda. All Rights Reserved.
 *
 * All source code, documentation and other information contained herein is
 * and remains the property of Digisfera Lda. Dissemination or reproduction
 * of this material is strictly forbidden unless prior written permission
 * is obtained from Digisfera Lda.
 *
 * This software may not be used for any commercial purposes. 
 * The "Powered by Marzipano" watermark must remain visible.
 * For more information see LICENSE.txt
 * 
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Marzipano=t()}}(function(){var t;return function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[s]={exports:{}};t[s][0].call(l.exports,function(e){var i=t[s][1][e];return r(i?i:e)},l,l.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,i,n){!function(e,n){"undefined"!=typeof i&&i.exports?i.exports.browser=n():"function"==typeof t&&t.amd?t(n):this[e]=n()}("bowser",function(){function t(t){function i(e){var i=t.match(e);return i&&i.length>1&&i[1]||""}var n,r=i(/(ipod|iphone|ipad)/i).toLowerCase(),o=/like android/i.test(t),s=!o&&/android/i.test(t),a=i(/version\/(\d+(\.\d+)?)/i),h=/tablet/i.test(t),u=!h&&/[^-]mobi/i.test(t);/opera|opr/i.test(t)?n={name:"Opera",opera:e,version:a||i(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(t)?n={name:"Windows Phone",windowsphone:e,msie:e,version:i(/iemobile\/(\d+(\.\d+)?)/i)}:/msie|trident/i.test(t)?n={name:"Internet Explorer",msie:e,version:i(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(t)?n={name:"Chrome",chrome:e,version:i(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:r?(n={name:"iphone"==r?"iPhone":"ipad"==r?"iPad":"iPod"},a&&(n.version=a)):/sailfish/i.test(t)?n={name:"Sailfish",sailfish:e,version:i(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?n={name:"SeaMonkey",seamonkey:e,version:i(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(t)?(n={name:"Firefox",firefox:e,version:i(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(n.firefoxos=e)):/silk/i.test(t)?n={name:"Amazon Silk",silk:e,version:i(/silk\/(\d+(\.\d+)?)/i)}:s?n={name:"Android",version:a}:/phantom/i.test(t)?n={name:"PhantomJS",phantom:e,version:i(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?n={name:"BlackBerry",blackberry:e,version:a||i(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(t)?(n={name:"WebOS",webos:e,version:a||i(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(n.touchpad=e)):n=/bada/i.test(t)?{name:"Bada",bada:e,version:i(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(t)?{name:"Tizen",tizen:e,version:i(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||a}:/safari/i.test(t)?{name:"Safari",safari:e,version:a}:{},/(apple)?webkit/i.test(t)?(n.name=n.name||"Webkit",n.webkit=e,!n.version&&a&&(n.version=a)):!n.opera&&/gecko\//i.test(t)&&(n.name=n.name||"Gecko",n.gecko=e,n.version=n.version||i(/gecko\/(\d+(\.\d+)?)/i)),s||n.silk?n.android=e:r&&(n[r]=e,n.ios=e);var l="";r?(l=i(/os (\d+([_\s]\d+)*) like mac os x/i),l=l.replace(/[_\s]/g,".")):s?l=i(/android[ \/-](\d+(\.\d+)*)/i):n.windowsphone?l=i(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.webos?l=i(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?l=i(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?l=i(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(l=i(/tizen[\/\s](\d+(\.\d+)*)/i)),l&&(n.osversion=l);var c=l.split(".")[0];return h||"ipad"==r||s&&(3==c||4==c&&!u)||n.silk?n.tablet=e:(u||"iphone"==r||"ipod"==r||s||n.blackberry||n.webos||n.bada)&&(n.mobile=e),n.msie&&n.version>=10||n.chrome&&n.version>=20||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1?n.a=e:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6?n.c=e:n.x=e,n}var e=!0,i=t("undefined"!=typeof navigator?navigator.userAgent:"");return i._detect=t,i})},{}],2:[function(e,i,n){!function(e){"use strict";var i={};"undefined"==typeof n?"function"==typeof t&&"object"==typeof t.amd&&t.amd?(i.exports={},t(function(){return i.exports})):i.exports="undefined"!=typeof window?window:e:i.exports=n,function(t){if(!e)var e=1e-6;if(!i)var i="undefined"!=typeof Float32Array?Float32Array:Array;if(!n)var n=Math.random;var r={};r.setMatrixArrayType=function(t){i=t},"undefined"!=typeof t&&(t.glMatrix=r);var o=Math.PI/180;r.toRadian=function(t){return t*o};var s={};s.create=function(){var t=new i(2);return t[0]=0,t[1]=0,t},s.clone=function(t){var e=new i(2);return e[0]=t[0],e[1]=t[1],e},s.fromValues=function(t,e){var n=new i(2);return n[0]=t,n[1]=e,n},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},s.set=function(t,e,i){return t[0]=e,t[1]=i,t},s.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},s.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},s.sub=s.subtract,s.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},s.mul=s.multiply,s.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},s.div=s.divide,s.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},s.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},s.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},s.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},s.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},s.dist=s.distance,s.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},s.len=s.length,s.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},s.normalize=function(t,e){var i=e[0],n=e[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},s.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},s.lerp=function(t,e,i,n){var r=e[0],o=e[1];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t},s.random=function(t,e){e=e||1;var i=2*n()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},s.transformMat2=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t},s.transformMat2d=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5],t},s.transformMat3=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[3]*r+i[6],t[1]=i[1]*n+i[4]*r+i[7],t},s.transformMat4=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t},s.forEach=function(){var t=s.create();return function(e,i,n,r,o,s){var a,h;for(i||(i=2),n||(n=0),h=r?Math.min(r*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}(),s.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},"undefined"!=typeof t&&(t.vec2=s);var a={};a.create=function(){var t=new i(3);return t[0]=0,t[1]=0,t[2]=0,t},a.clone=function(t){var e=new i(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},a.fromValues=function(t,e,n){var r=new i(3);return r[0]=t,r[1]=e,r[2]=n,r},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},a.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},a.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},a.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},a.sub=a.subtract,a.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},a.mul=a.multiply,a.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},a.div=a.divide,a.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},a.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},a.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},a.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},a.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(i*i+n*n+r*r)},a.dist=a.distance,a.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return i*i+n*n+r*r},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},a.len=a.length,a.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},a.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},a.cross=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],h=i[2];return t[0]=r*h-o*a,t[1]=o*s-n*h,t[2]=n*a-r*s,t},a.lerp=function(t,e,i,n){var r=e[0],o=e[1],s=e[2];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=s+n*(i[2]-s),t},a.random=function(t,e){e=e||1;var i=2*n()*Math.PI,r=2*n()-1,o=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(i)*o,t[1]=Math.sin(i)*o,t[2]=r*e,t},a.transformMat4=function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12],t[1]=i[1]*n+i[5]*r+i[9]*o+i[13],t[2]=i[2]*n+i[6]*r+i[10]*o+i[14],t},a.transformMat3=function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t},a.transformQuat=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],h=i[2],u=i[3],l=u*n+a*o-h*r,c=u*r+h*n-s*o,p=u*o+s*r-a*n,f=-s*n-a*r-h*o;return t[0]=l*u+f*-s+c*-h-p*-a,t[1]=c*u+f*-a+p*-s-l*-h,t[2]=p*u+f*-h+l*-a-c*-s,t},a.rotateX=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},a.rotateY=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},a.rotateZ=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},a.forEach=function(){var t=a.create();return function(e,i,n,r,o,s){var a,h;for(i||(i=3),n||(n=0),h=r?Math.min(r*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}(),a.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},"undefined"!=typeof t&&(t.vec3=a);var h={};h.create=function(){var t=new i(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},h.clone=function(t){var e=new i(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},h.fromValues=function(t,e,n,r){var o=new i(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o},h.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},h.set=function(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t},h.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},h.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},h.sub=h.subtract,h.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},h.mul=h.multiply,h.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},h.div=h.divide,h.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},h.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},h.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},h.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},h.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(i*i+n*n+r*r+o*o)},h.dist=h.distance,h.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return i*i+n*n+r*r+o*o},h.sqrDist=h.squaredDistance,h.length=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},h.len=h.length,h.squaredLength=function(t){var e=t[0],i=t[1],n=t[2],r=t[3];return e*e+i*i+n*n+r*r},h.sqrLen=h.squaredLength,h.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},h.normalize=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*i+n*n+r*r+o*o;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s),t},h.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},h.lerp=function(t,e,i,n){var r=e[0],o=e[1],s=e[2],a=e[3];return t[0]=r+n*(i[0]-r),t[1]=o+n*(i[1]-o),t[2]=s+n*(i[2]-s),t[3]=a+n*(i[3]-a),t},h.random=function(t,e){return e=e||1,t[0]=n(),t[1]=n(),t[2]=n(),t[3]=n(),h.normalize(t,t),h.scale(t,t,e),t},h.transformMat4=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,t},h.transformQuat=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],h=i[2],u=i[3],l=u*n+a*o-h*r,c=u*r+h*n-s*o,p=u*o+s*r-a*n,f=-s*n-a*r-h*o;return t[0]=l*u+f*-s+c*-h-p*-a,t[1]=c*u+f*-a+p*-s-l*-h,t[2]=p*u+f*-h+l*-a-c*-s,t},h.forEach=function(){var t=h.create();return function(e,i,n,r,o,s){var a,h;for(i||(i=4),n||(n=0),h=r?Math.min(r*i+n,e.length):e.length,a=n;h>a;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),h.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.vec4=h);var u={};u.create=function(){var t=new i(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},u.clone=function(t){var e=new i(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},u.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},u.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*o-r*n;return s?(s=1/s,t[0]=o*s,t[1]=-n*s,t[2]=-r*s,t[3]=i*s,t):null},u.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},u.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},u.multiply=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[0],h=i[1],u=i[2],l=i[3];return t[0]=n*a+o*h,t[1]=r*a+s*h,t[2]=n*u+o*l,t[3]=r*u+s*l,t},u.mul=u.multiply,u.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+o*a,t[1]=r*h+s*a,t[2]=n*-a+o*h,t[3]=r*-a+s*h,t},u.scale=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[0],h=i[1];return t[0]=n*a,t[1]=r*a,t[2]=o*h,t[3]=s*h,t},u.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},u.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},u.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},"undefined"!=typeof t&&(t.mat2=u);var l={};l.create=function(){var t=new i(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},l.clone=function(t){var e=new i(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},l.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},l.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=i*o-n*r;return h?(h=1/h,t[0]=o*h,t[1]=-n*h,t[2]=-r*h,t[3]=i*h,t[4]=(r*a-o*s)*h,t[5]=(n*s-i*a)*h,t):null},l.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},l.multiply=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=i[0],l=i[1],c=i[2],p=i[3],f=i[4],d=i[5];return t[0]=n*u+o*l,t[1]=r*u+s*l,t[2]=n*c+o*p,t[3]=r*c+s*p,t[4]=n*f+o*d+a,t[5]=r*f+s*d+h,t},l.mul=l.multiply,l.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*u,t[1]=r*l+s*u,t[2]=n*-u+o*l,t[3]=r*-u+s*l,t[4]=a,t[5]=h,t},l.scale=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=i[0],l=i[1];return t[0]=n*u,t[1]=r*u,t[2]=o*l,t[3]=s*l,t[4]=a,t[5]=h,t},l.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=i[0],l=i[1];return t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=n*u+o*l+a,t[5]=r*u+s*l+h,t},l.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},l.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},"undefined"!=typeof t&&(t.mat2d=l);var c={};c.create=function(){var t=new i(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},c.clone=function(t){var e=new i(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},c.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},c.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=l*s-a*u,p=-l*o+a*h,f=u*o-s*h,d=i*c+n*p+r*f;return d?(d=1/d,t[0]=c*d,t[1]=(-l*n+r*u)*d,t[2]=(a*n-r*s)*d,t[3]=p*d,t[4]=(l*i-r*h)*d,t[5]=(-a*i+r*o)*d,t[6]=f*d,t[7]=(-u*i+n*h)*d,t[8]=(s*i-n*o)*d,t):null},c.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8];return t[0]=s*l-a*u,t[1]=r*u-n*l,t[2]=n*a-r*s,t[3]=a*h-o*l,t[4]=i*l-r*h,t[5]=r*o-i*a,t[6]=o*u-s*h,t[7]=n*h-i*u,t[8]=i*s-n*o,t},c.determinant=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],h=t[7],u=t[8];return e*(u*o-s*h)+i*(-u*r+s*a)+n*(h*r-o*a)},c.multiply=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],p=i[0],f=i[1],d=i[2],m=i[3],v=i[4],_=i[5],y=i[6],g=i[7],w=i[8];return t[0]=p*n+f*s+d*u,t[1]=p*r+f*a+d*l,t[2]=p*o+f*h+d*c,t[3]=m*n+v*s+_*u,t[4]=m*r+v*a+_*l,t[5]=m*o+v*h+_*c,t[6]=y*n+g*s+w*u,t[7]=y*r+g*a+w*l,t[8]=y*o+g*h+w*c,t},c.mul=c.multiply,c.translate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],p=i[0],f=i[1];return t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=p*n+f*s+u,t[7]=p*r+f*a+l,t[8]=p*o+f*h+c,t},c.rotate=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],p=Math.sin(i),f=Math.cos(i);return t[0]=f*n+p*s,t[1]=f*r+p*a,t[2]=f*o+p*h,t[3]=f*s-p*n,t[4]=f*a-p*r,t[5]=f*h-p*o,t[6]=u,t[7]=l,t[8]=c,t},c.scale=function(t,e,i){var n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},c.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i+i,a=n+n,h=r+r,u=i*s,l=n*s,c=n*a,p=r*s,f=r*a,d=r*h,m=o*s,v=o*a,_=o*h;return t[0]=1-c-d,t[3]=l-_,t[6]=p+v,t[1]=l+_,t[4]=1-u-d,t[7]=f-m,t[2]=p-v,t[5]=f+m,t[8]=1-u-c,t},c.normalFromMat4=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=e[9],p=e[10],f=e[11],d=e[12],m=e[13],v=e[14],_=e[15],y=i*a-n*s,g=i*h-r*s,w=i*u-o*s,x=n*h-r*a,b=n*u-o*a,E=r*u-o*h,T=l*m-c*d,M=l*v-p*d,C=l*_-f*d,L=c*v-p*m,S=c*_-f*m,R=p*_-f*v,A=y*R-g*S+w*L+x*C-b*M+E*T;return A?(A=1/A,t[0]=(a*R-h*S+u*L)*A,t[1]=(h*C-s*R-u*M)*A,t[2]=(s*S-a*C+u*T)*A,t[3]=(r*S-n*R-o*L)*A,t[4]=(i*R-r*C+o*M)*A,t[5]=(n*C-i*S-o*T)*A,t[6]=(m*E-v*b+_*x)*A,t[7]=(v*w-d*E-_*g)*A,t[8]=(d*b-m*w+_*y)*A,t):null},c.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},c.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},"undefined"!=typeof t&&(t.mat3=c);var p={};p.create=function(){var t=new i(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},p.clone=function(t){var e=new i(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},p.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=r,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},p.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=e[9],p=e[10],f=e[11],d=e[12],m=e[13],v=e[14],_=e[15],y=i*a-n*s,g=i*h-r*s,w=i*u-o*s,x=n*h-r*a,b=n*u-o*a,E=r*u-o*h,T=l*m-c*d,M=l*v-p*d,C=l*_-f*d,L=c*v-p*m,S=c*_-f*m,R=p*_-f*v,A=y*R-g*S+w*L+x*C-b*M+E*T;return A?(A=1/A,t[0]=(a*R-h*S+u*L)*A,t[1]=(r*S-n*R-o*L)*A,t[2]=(m*E-v*b+_*x)*A,t[3]=(p*b-c*E-f*x)*A,t[4]=(h*C-s*R-u*M)*A,t[5]=(i*R-r*C+o*M)*A,t[6]=(v*w-d*E-_*g)*A,t[7]=(l*E-p*w+f*g)*A,t[8]=(s*S-a*C+u*T)*A,t[9]=(n*C-i*S-o*T)*A,t[10]=(d*b-m*w+_*y)*A,t[11]=(c*w-l*b-f*y)*A,t[12]=(a*M-s*L-h*T)*A,t[13]=(i*L-n*M+r*T)*A,t[14]=(m*g-d*x-v*y)*A,t[15]=(l*x-c*g+p*y)*A,t):null},p.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=e[9],p=e[10],f=e[11],d=e[12],m=e[13],v=e[14],_=e[15];return t[0]=a*(p*_-f*v)-c*(h*_-u*v)+m*(h*f-u*p),t[1]=-(n*(p*_-f*v)-c*(r*_-o*v)+m*(r*f-o*p)),t[2]=n*(h*_-u*v)-a*(r*_-o*v)+m*(r*u-o*h),t[3]=-(n*(h*f-u*p)-a*(r*f-o*p)+c*(r*u-o*h)),t[4]=-(s*(p*_-f*v)-l*(h*_-u*v)+d*(h*f-u*p)),t[5]=i*(p*_-f*v)-l*(r*_-o*v)+d*(r*f-o*p),t[6]=-(i*(h*_-u*v)-s*(r*_-o*v)+d*(r*u-o*h)),t[7]=i*(h*f-u*p)-s*(r*f-o*p)+l*(r*u-o*h),t[8]=s*(c*_-f*m)-l*(a*_-u*m)+d*(a*f-u*c),t[9]=-(i*(c*_-f*m)-l*(n*_-o*m)+d*(n*f-o*c)),t[10]=i*(a*_-u*m)-s*(n*_-o*m)+d*(n*u-o*a),t[11]=-(i*(a*f-u*c)-s*(n*f-o*c)+l*(n*u-o*a)),t[12]=-(s*(c*v-p*m)-l*(a*v-h*m)+d*(a*p-h*c)),t[13]=i*(c*v-p*m)-l*(n*v-r*m)+d*(n*p-r*c),t[14]=-(i*(a*v-h*m)-s*(n*v-r*m)+d*(n*h-r*a)),t[15]=i*(a*p-h*c)-s*(n*p-r*c)+l*(n*h-r*a),t},p.determinant=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],h=t[7],u=t[8],l=t[9],c=t[10],p=t[11],f=t[12],d=t[13],m=t[14],v=t[15],_=e*s-i*o,y=e*a-n*o,g=e*h-r*o,w=i*a-n*s,x=i*h-r*s,b=n*h-r*a,E=u*d-l*f,T=u*m-c*f,M=u*v-p*f,C=l*m-c*d,L=l*v-p*d,S=c*v-p*m;return _*S-y*L+g*C+w*M-x*T+b*E},p.multiply=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],p=e[9],f=e[10],d=e[11],m=e[12],v=e[13],_=e[14],y=e[15],g=i[0],w=i[1],x=i[2],b=i[3];return t[0]=g*n+w*a+x*c+b*m,t[1]=g*r+w*h+x*p+b*v,t[2]=g*o+w*u+x*f+b*_,t[3]=g*s+w*l+x*d+b*y,g=i[4],w=i[5],x=i[6],b=i[7],t[4]=g*n+w*a+x*c+b*m,t[5]=g*r+w*h+x*p+b*v,t[6]=g*o+w*u+x*f+b*_,t[7]=g*s+w*l+x*d+b*y,g=i[8],w=i[9],x=i[10],b=i[11],t[8]=g*n+w*a+x*c+b*m,t[9]=g*r+w*h+x*p+b*v,t[10]=g*o+w*u+x*f+b*_,t[11]=g*s+w*l+x*d+b*y,g=i[12],w=i[13],x=i[14],b=i[15],t[12]=g*n+w*a+x*c+b*m,t[13]=g*r+w*h+x*p+b*v,t[14]=g*o+w*u+x*f+b*_,t[15]=g*s+w*l+x*d+b*y,t},p.mul=p.multiply,p.translate=function(t,e,i){var n,r,o,s,a,h,u,l,c,p,f,d,m=i[0],v=i[1],_=i[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*_+e[12],t[13]=e[1]*m+e[5]*v+e[9]*_+e[13],t[14]=e[2]*m+e[6]*v+e[10]*_+e[14],t[15]=e[3]*m+e[7]*v+e[11]*_+e[15]):(n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],p=e[9],f=e[10],d=e[11],t[0]=n,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+a*v+c*_+e[12],t[13]=r*m+h*v+p*_+e[13],t[14]=o*m+u*v+f*_+e[14],t[15]=s*m+l*v+d*_+e[15]),t},p.scale=function(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.rotate=function(t,i,n,r){var o,s,a,h,u,l,c,p,f,d,m,v,_,y,g,w,x,b,E,T,M,C,L,S,R=r[0],A=r[1],I=r[2],k=Math.sqrt(R*R+A*A+I*I);return Math.abs(k)<e?null:(k=1/k,R*=k,A*=k,I*=k,o=Math.sin(n),s=Math.cos(n),a=1-s,h=i[0],u=i[1],l=i[2],c=i[3],p=i[4],f=i[5],d=i[6],m=i[7],v=i[8],_=i[9],y=i[10],g=i[11],w=R*R*a+s,x=A*R*a+I*o,b=I*R*a-A*o,E=R*A*a-I*o,T=A*A*a+s,M=I*A*a+R*o,C=R*I*a+A*o,L=A*I*a-R*o,S=I*I*a+s,t[0]=h*w+p*x+v*b,t[1]=u*w+f*x+_*b,t[2]=l*w+d*x+y*b,t[3]=c*w+m*x+g*b,t[4]=h*E+p*T+v*M,t[5]=u*E+f*T+_*M,t[6]=l*E+d*T+y*M,t[7]=c*E+m*T+g*M,t[8]=h*C+p*L+v*S,t[9]=u*C+f*L+_*S,t[10]=l*C+d*L+y*S,t[11]=c*C+m*L+g*S,i!==t&&(t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15]),t)},p.rotateX=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],h=e[7],u=e[8],l=e[9],c=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*n,t[5]=s*r+l*n,t[6]=a*r+c*n,t[7]=h*r+p*n,t[8]=u*r-o*n,t[9]=l*r-s*n,t[10]=c*r-a*n,t[11]=p*r-h*n,t},p.rotateY=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],u=e[8],l=e[9],c=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-u*n,t[1]=s*r-l*n,t[2]=a*r-c*n,t[3]=h*r-p*n,t[8]=o*n+u*r,t[9]=s*n+l*r,t[10]=a*n+c*r,t[11]=h*n+p*r,t},p.rotateZ=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],h=e[3],u=e[4],l=e[5],c=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+u*n,t[1]=s*r+l*n,t[2]=a*r+c*n,t[3]=h*r+p*n,t[4]=u*r-o*n,t[5]=l*r-s*n,t[6]=c*r-a*n,t[7]=p*r-h*n,t},p.fromRotationTranslation=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=n+n,h=r+r,u=o+o,l=n*a,c=n*h,p=n*u,f=r*h,d=r*u,m=o*u,v=s*a,_=s*h,y=s*u;return t[0]=1-(f+m),t[1]=c+y,t[2]=p-_,t[3]=0,t[4]=c-y,t[5]=1-(l+m),t[6]=d+v,t[7]=0,t[8]=p+_,t[9]=d-v,t[10]=1-(l+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},p.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i+i,a=n+n,h=r+r,u=i*s,l=n*s,c=n*a,p=r*s,f=r*a,d=r*h,m=o*s,v=o*a,_=o*h;return t[0]=1-c-d,t[1]=l+_,t[2]=p-v,t[3]=0,t[4]=l-_,t[5]=1-u-d,t[6]=f+m,t[7]=0,t[8]=p+v,t[9]=f-m,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},p.frustum=function(t,e,i,n,r,o,s){var a=1/(i-e),h=1/(r-n),u=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(r+n)*h,t[10]=(s+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*u,t[15]=0,t},p.perspective=function(t,e,i,n,r){var o=1/Math.tan(e/2),s=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*s,t[15]=0,t},p.ortho=function(t,e,i,n,r,o,s){var a=1/(e-i),h=1/(n-r),u=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*h,t[14]=(s+o)*u,t[15]=1,t},p.lookAt=function(t,i,n,r){var o,s,a,h,u,l,c,f,d,m,v=i[0],_=i[1],y=i[2],g=r[0],w=r[1],x=r[2],b=n[0],E=n[1],T=n[2];return Math.abs(v-b)<e&&Math.abs(_-E)<e&&Math.abs(y-T)<e?p.identity(t):(c=v-b,f=_-E,d=y-T,m=1/Math.sqrt(c*c+f*f+d*d),c*=m,f*=m,d*=m,o=w*d-x*f,s=x*c-g*d,a=g*f-w*c,m=Math.sqrt(o*o+s*s+a*a),m?(m=1/m,o*=m,s*=m,a*=m):(o=0,s=0,a=0),h=f*a-d*s,u=d*o-c*a,l=c*s-f*o,m=Math.sqrt(h*h+u*u+l*l),m?(m=1/m,h*=m,u*=m,l*=m):(h=0,u=0,l=0),t[0]=o,t[1]=h,t[2]=c,t[3]=0,t[4]=s,t[5]=u,t[6]=f,t[7]=0,t[8]=a,t[9]=l,t[10]=d,t[11]=0,t[12]=-(o*v+s*_+a*y),t[13]=-(h*v+u*_+l*y),t[14]=-(c*v+f*_+d*y),t[15]=1,t)},p.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},p.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},"undefined"!=typeof t&&(t.mat4=p);var f={};f.create=function(){var t=new i(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.rotationTo=function(){var t=a.create(),e=a.fromValues(1,0,0),i=a.fromValues(0,1,0);return function(n,r,o){var s=a.dot(r,o);return-.999999>s?(a.cross(t,e,r),a.length(t)<1e-6&&a.cross(t,i,r),a.normalize(t,t),f.setAxisAngle(n,t,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(a.cross(t,r,o),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+s,f.normalize(n,n))}}(),f.setAxes=function(){var t=c.create();return function(e,i,n,r){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],f.normalize(e,f.fromMat3(e,t))}}(),f.clone=h.clone,f.fromValues=h.fromValues,f.copy=h.copy,f.set=h.set,f.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.setAxisAngle=function(t,e,i){i=.5*i;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t},f.add=h.add,f.multiply=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=i[0],h=i[1],u=i[2],l=i[3];return t[0]=n*l+s*a+r*u-o*h,t[1]=r*l+s*h+o*a-n*u,t[2]=o*l+s*u+n*h-r*a,t[3]=s*l-n*a-r*h-o*u,t},f.mul=f.multiply,f.scale=h.scale,f.rotateX=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+s*a,t[1]=r*h+o*a,t[2]=o*h-r*a,t[3]=s*h-n*a,t},f.rotateY=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h-o*a,t[1]=r*h+s*a,t[2]=o*h+n*a,t[3]=s*h-r*a,t},f.rotateZ=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+r*a,t[1]=r*h-n*a,t[2]=o*h+s*a,t[3]=s*h-o*a,t},f.calculateW=function(t,e){var i=e[0],n=e[1],r=e[2];return t[0]=i,t[1]=n,t[2]=r,t[3]=-Math.sqrt(Math.abs(1-i*i-n*n-r*r)),t},f.dot=h.dot,f.lerp=h.lerp,f.slerp=function(t,e,i,n){var r,o,s,a,h,u=e[0],l=e[1],c=e[2],p=e[3],f=i[0],d=i[1],m=i[2],v=i[3];return o=u*f+l*d+c*m+p*v,0>o&&(o=-o,f=-f,d=-d,m=-m,v=-v),1-o>1e-6?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-n)*r)/s,h=Math.sin(n*r)/s):(a=1-n,h=n),t[0]=a*u+h*f,t[1]=a*l+h*d,t[2]=a*c+h*m,t[3]=a*p+h*v,t},f.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*i+n*n+r*r+o*o,a=s?1/s:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-r*a,t[3]=o*a,t},f.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},f.length=h.length,f.len=f.length,f.squaredLength=h.squaredLength,f.sqrLen=f.squaredLength,f.normalize=h.normalize,f.fromMat3=function(t,e){var i,n=e[0]+e[4]+e[8];if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[7]-e[5])*i,t[1]=(e[2]-e[6])*i,t[2]=(e[3]-e[1])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*s+s]+1),t[r]=.5*i,i=.5/i,t[3]=(e[3*s+o]-e[3*o+s])*i,t[o]=(e[3*o+r]+e[3*r+o])*i,t[s]=(e[3*s+r]+e[3*r+s])*i}return t},f.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},"undefined"!=typeof t&&(t.quat=f)}(i.exports)}(this)},{}],3:[function(e,i,n){!function(e,n,r,o){"use strict";function s(t,e,i){return setTimeout(f(t,i),e)}function a(t,e,i){return Array.isArray(t)?(h(t,i[e],i),!0):!1}function h(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==o)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function u(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===o)&&(t[n[r]]=e[n[r]]),r++;return t}function l(t,e){
return u(t,e,!0)}function c(t){if(Object.create)return Object.create(t);var e=function(){};e.prototype=t;var i=new e;return e.prototype=null,i}function p(t,e,i){var n,r=e.prototype;n=t.prototype=c(r),n.constructor=t,n._super=r,i&&u(n,i)}function f(t,e){return function(){return t.apply(e,arguments)}}function d(t,e){return typeof t==ft?t.apply(e?e[0]||o:o,e):t}function m(t,e){return t===o?e:t}function v(t,e,i){h(w(e),function(e){t.addEventListener(e,i,!1)})}function _(t,e,i){h(w(e),function(e){t.removeEventListener(e,i,!1)})}function y(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function g(t,e){return t.indexOf(e)>-1}function w(t){return t.trim().split(/\s+/g)}function x(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function b(t){return Array.prototype.slice.call(t,0)}function E(t,e,i){for(var n=[],r=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];x(r,s)<0&&n.push(t[o]),r[o]=s,o++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function T(t,e){for(var i,n,r=e[0].toUpperCase()+e.slice(1),s=0;s<ct.length;){if(i=ct[s],n=i?i+r:e,n in t)return n;s++}return o}function M(){return _t++}function C(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||e}function L(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){d(t.options.enable,[t])&&i.handler(e)},this.init()}function S(t){var e,i=t.options.inputClass;return new(e=i?i:wt?N:xt?X:gt?G:V)(t,R)}function R(t,e,i){var n=i.pointers.length,r=i.changedPointers.length,o=e&Lt&&n-r===0,s=e&(Rt|At)&&n-r===0;i.isFirst=!!o,i.isFinal=!!s,o&&(t.session={}),i.eventType=e,A(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function A(t,e){var i=t.session,n=e.pointers,r=n.length;i.firstInput||(i.firstInput=z(e)),r>1&&!i.firstMultiple?i.firstMultiple=z(e):1===r&&(i.firstMultiple=!1);var o=i.firstInput,s=i.firstMultiple,a=s?s.center:o.center,h=e.center=F(n);e.timeStamp=vt(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=H(a,h),e.distance=O(a,h),I(i,e),e.offsetDirection=D(e.deltaX,e.deltaY),e.scale=s?B(s.pointers,n):1,e.rotation=s?q(s.pointers,n):0,k(i,e);var u=t.element;y(e.srcEvent.target,u)&&(u=e.srcEvent.target),e.target=u}function I(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};(e.eventType===Lt||o.eventType===Rt)&&(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}function k(t,e){var i,n,r,s,a=t.lastInterval||e,h=e.timeStamp-a.timeStamp;if(e.eventType!=At&&(h>Ct||a.velocity===o)){var u=a.deltaX-e.deltaX,l=a.deltaY-e.deltaY,c=P(h,u,l);n=c.x,r=c.y,i=mt(c.x)>mt(c.y)?c.x:c.y,s=D(u,l),t.lastInterval=e}else i=a.velocity,n=a.velocityX,r=a.velocityY,s=a.direction;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=s}function z(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:dt(t.pointers[i].clientX),clientY:dt(t.pointers[i].clientY)},i++;return{timeStamp:vt(),pointers:e,center:F(e),deltaX:t.deltaX,deltaY:t.deltaY}}function F(t){var e=t.length;if(1===e)return{x:dt(t[0].clientX),y:dt(t[0].clientY)};for(var i=0,n=0,r=0;e>r;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:dt(i/e),y:dt(n/e)}}function P(t,e,i){return{x:e/t||0,y:i/t||0}}function D(t,e){return t===e?It:mt(t)>=mt(e)?t>0?kt:zt:e>0?Ft:Pt}function O(t,e,i){i||(i=qt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function H(t,e,i){i||(i=qt);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}function q(t,e){return H(e[1],e[0],Bt)-H(t[1],t[0],Bt)}function B(t,e){return O(e[0],e[1],Bt)/O(t[0],t[1],Bt)}function V(){this.evEl=Nt,Wt?this.evDoc=Yt:this.evWin=Yt,this.allow=!0,this.pressed=!1,L.apply(this,arguments)}function N(){this.evEl=Gt,this.evWin=jt,L.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function Y(){this.evTarget=Zt,this.evWin=Kt,this.started=!1,L.apply(this,arguments)}function W(t,e){var i=b(t.touches),n=b(t.changedTouches);return e&(Rt|At)&&(i=E(i.concat(n),"identifier",!0)),[i,n]}function X(){this.evTarget=$t,this.targetIds={},L.apply(this,arguments)}function U(t,e){var i=b(t.touches),n=this.targetIds;if(e&(Lt|St)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,o,s=b(t.changedTouches),a=[],h=this.target;if(o=i.filter(function(t){return y(t.target,h)}),e===Lt)for(r=0;r<o.length;)n[o[r].identifier]=!0,r++;for(r=0;r<s.length;)n[s[r].identifier]&&a.push(s[r]),e&(Rt|At)&&delete n[s[r].identifier],r++;return a.length?[E(o.concat(a),"identifier",!0),a]:void 0}function G(){L.apply(this,arguments);var t=f(this.handler,this);this.touch=new X(this.manager,t),this.mouse=new V(this.manager,t)}function j(t,e){this.manager=t,this.set(e)}function Q(t){if(g(t,oe))return oe;var e=g(t,se),i=g(t,ae);return e&&i?se+" "+ae:e||i?e?se:ae:g(t,re)?re:ne}function Z(t){this.id=M(),this.manager=null,this.options=l(t||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=he,this.simultaneous={},this.requireFail=[]}function K(t){return t&fe?"cancel":t&ce?"end":t&le?"move":t&ue?"start":""}function J(t){return t==Pt?"down":t==Ft?"up":t==kt?"left":t==zt?"right":""}function $(t,e){var i=e.manager;return i?i.get(t):t}function tt(){Z.apply(this,arguments)}function et(){tt.apply(this,arguments),this.pX=null,this.pY=null}function it(){tt.apply(this,arguments)}function nt(){Z.apply(this,arguments),this._timer=null,this._input=null}function rt(){tt.apply(this,arguments)}function ot(){tt.apply(this,arguments)}function st(){Z.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function at(t,e){return e=e||{},e.recognizers=m(e.recognizers,at.defaults.preset),new ht(t,e)}function ht(t,e){e=e||{},this.options=l(e,at.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=S(this),this.touchAction=new j(this,this.options.touchAction),ut(this,!0),h(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function ut(t,e){var i=t.element;i.style&&h(t.options.cssProps,function(t,n){i.style[T(i.style,n)]=e?t:""})}function lt(t,e){var i=n.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}var ct=["","webkit","moz","MS","ms","o"],pt=n.createElement("div"),ft="function",dt=Math.round,mt=Math.abs,vt=Date.now,_t=1,yt=/mobile|tablet|ip(ad|hone|od)|android/i,gt="ontouchstart"in e,wt=T(e,"PointerEvent")!==o,xt=gt&&yt.test(navigator.userAgent),bt="touch",Et="pen",Tt="mouse",Mt="kinect",Ct=25,Lt=1,St=2,Rt=4,At=8,It=1,kt=2,zt=4,Ft=8,Pt=16,Dt=kt|zt,Ot=Ft|Pt,Ht=Dt|Ot,qt=["x","y"],Bt=["clientX","clientY"];L.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(C(this.element),this.evWin,this.domHandler),this.evDoc&&v(n,this.evDoc,this.domHandler),this.evBody&&v(n.body,this.evBody,this.domHandler)},destroy:function(){this.evEl&&_(this.element,this.evEl,this.domHandler),this.evTarget&&_(this.target,this.evTarget,this.domHandler),this.evWin&&_(C(this.element),this.evWin,this.domHandler),this.evDoc&&_(n,this.evDoc,this.domHandler),this.evBody&&_(n.body,this.evBody,this.domHandler)}};var Vt={mousedown:Lt,mousemove:St,mouseup:Rt},Nt="mousedown",Yt="mousemove mouseup",Wt=e.navigator.userAgent.indexOf("MSIE 8")>0;p(V,L,{handler:function(t){var e=Vt[t.type],i=0;Wt&&(i=1),e&Lt&&t.button===i&&(this.pressed=!0),e&St&&t.button!==i&&(e=Rt),this.pressed&&this.allow&&(e&Rt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:Tt,srcEvent:t}))}});var Xt={pointerdown:Lt,pointermove:St,pointerup:Rt,pointercancel:At,pointerout:At},Ut={2:bt,3:Et,4:Tt,5:Mt},Gt="pointerdown",jt="pointermove pointerup pointercancel";e.MSPointerEvent&&(Gt="MSPointerDown",jt="MSPointerMove MSPointerUp MSPointerCancel"),p(N,L,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=Xt[n],o=Ut[t.pointerType]||t.pointerType,s=o==bt,a=x(e,t.pointerId,"pointerId");r&Lt&&(0===t.button||s)?0>a&&(e.push(t),a=e.length-1):r&(Rt|At)&&(i=!0),0>a||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),i&&e.splice(a,1))}});var Qt={touchstart:Lt,touchmove:St,touchend:Rt,touchcancel:At},Zt="touchstart",Kt="touchstart touchmove touchend touchcancel";p(Y,L,{handler:function(t){var e=Qt[t.type];if(e===Lt&&(this.started=!0),this.started){var i=W.call(this,t,e);e&(Rt|At)&&i[0].length-i[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:bt,srcEvent:t})}}});var Jt={touchstart:Lt,touchmove:St,touchend:Rt,touchcancel:At},$t="touchstart touchmove touchend touchcancel";p(X,L,{handler:function(t){var e=Jt[t.type],i=U.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:bt,srcEvent:t})}}),p(G,L,{handler:function(t,e,i){var n=i.pointerType==bt,r=i.pointerType==Tt;if(n)this.mouse.allow=!1;else if(r&&!this.mouse.allow)return;e&(Rt|At)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var te=T(pt.style,"touchAction"),ee=te!==o,ie="compute",ne="auto",re="manipulation",oe="none",se="pan-x",ae="pan-y";j.prototype={set:function(t){t==ie&&(t=this.compute()),ee&&this.manager.element.style&&(this.manager.element.style[te]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return h(this.manager.recognizers,function(e){d(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Q(t.join(" "))},preventDefaults:function(t){if(!ee){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var n=this.actions,r=g(n,oe),o=g(n,ae),s=g(n,se);return r||o&&i&Dt||s&&i&Ot?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var he=1,ue=2,le=4,ce=8,pe=ce,fe=16,de=32;Z.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(a(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=$(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return a(t,"dropRecognizeWith",this)?this:(t=$(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(a(t,"requireFailure",this))return this;var e=this.requireFail;return t=$(t,this),-1===x(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(a(t,"dropRequireFailure",this))return this;t=$(t,this);var e=x(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(i.options.event+(e?K(n):""),t)}var i=this,n=this.state;ce>n&&e(!0),e(),n>=ce&&e(!0)},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=de)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(de|he)))return!1;t++}return!0},recognize:function(t){var e=u({},t);return d(this.options.enable,[this,e])?(this.state&(pe|fe|de)&&(this.state=he),this.state=this.process(e),void(this.state&(ue|le|ce|fe)&&this.tryEmit(e))):(this.reset(),void(this.state=de))},process:function(t){},getTouchAction:function(){},reset:function(){}},p(tt,Z,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(ue|le),r=this.attrTest(t);return n&&(i&At||!r)?e|fe:n||r?i&Rt?e|ce:e&ue?e|le:ue:de}}),p(et,tt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ht},getTouchAction:function(){var t=this.options.direction,e=[];return t&Dt&&e.push(ae),t&Ot&&e.push(se),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(e.direction&Dt?(r=0===o?It:0>o?kt:zt,i=o!=this.pX,n=Math.abs(t.deltaX)):(r=0===s?It:0>s?Ft:Pt,i=s!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return tt.prototype.attrTest.call(this,t)&&(this.state&ue||!(this.state&ue)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=J(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),p(it,tt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[oe]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&ue)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),p(nt,Z,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[ne]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(Rt|At)&&!r)this.reset();else if(t.eventType&Lt)this.reset(),this._timer=s(function(){this.state=pe,this.tryEmit()},e.time,this);else if(t.eventType&Rt)return pe;return de},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===pe&&(t&&t.eventType&Rt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=vt(),this.manager.emit(this.options.event,this._input)))}}),p(rt,tt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[oe]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&ue)}}),p(ot,tt,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Dt|Ot,pointers:1},getTouchAction:function(){return et.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(Dt|Ot)?e=t.velocity:i&Dt?e=t.velocityX:i&Ot&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&mt(e)>this.options.velocity&&t.eventType&Rt},emit:function(t){var e=J(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),p(st,Z,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[re]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&Lt&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=Rt)return this.failTimeout();var o=this.pTime?t.timeStamp-this.pTime<e.interval:!0,a=!this.pCenter||O(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t;var h=this.count%e.taps;if(0===h)return this.hasRequireFailures()?(this._timer=s(function(){this.state=pe,this.tryEmit()},e.interval,this),ue):pe}return de},failTimeout:function(){return this._timer=s(function(){this.state=de},this.options.interval,this),de},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==pe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),at.VERSION="2.0.4",at.defaults={domEvents:!1,touchAction:ie,enable:!0,inputTarget:null,inputClass:null,preset:[[rt,{enable:!1}],[it,{enable:!1},["rotate"]],[ot,{direction:Dt}],[et,{direction:Dt},["swipe"]],[st],[st,{event:"doubletap",taps:2},["tap"]],[nt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var me=1,ve=2;ht.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?ve:me},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&pe)&&(r=e.curRecognizer=null);for(var o=0;o<n.length;)i=n[o],e.stopped===ve||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(ue|le|ce)&&(r=e.curRecognizer=i),o++}},get:function(t){if(t instanceof Z)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(a(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(a(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(x(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return h(w(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return h(w(t),function(t){e?i[t].splice(x(i[t],e),1):delete i[t]}),this},emit:function(t,e){this.options.domEvents&&lt(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&ut(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(at,{INPUT_START:Lt,INPUT_MOVE:St,INPUT_END:Rt,INPUT_CANCEL:At,STATE_POSSIBLE:he,STATE_BEGAN:ue,STATE_CHANGED:le,STATE_ENDED:ce,STATE_RECOGNIZED:pe,STATE_CANCELLED:fe,STATE_FAILED:de,DIRECTION_NONE:It,DIRECTION_LEFT:kt,DIRECTION_RIGHT:zt,DIRECTION_UP:Ft,DIRECTION_DOWN:Pt,DIRECTION_HORIZONTAL:Dt,DIRECTION_VERTICAL:Ot,DIRECTION_ALL:Ht,Manager:ht,Input:L,TouchAction:j,TouchInput:X,MouseInput:V,PointerEventInput:N,TouchMouseInput:G,SingleTouchInput:Y,Recognizer:Z,AttrRecognizer:tt,Tap:st,Pan:et,Swipe:ot,Pinch:it,Rotate:rt,Press:nt,on:v,off:_,each:h,merge:l,extend:u,inherit:p,bindFn:f,prefixed:T}),typeof t==ft&&t.amd?t(function(){return at}):"undefined"!=typeof i&&i.exports?i.exports=at:e[r]=at}(window,document,"Hammer")},{}],4:[function(t,e,i){void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var n=n||function(){var t=[];return{REVISION:"14",getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)},update:function(e){if(0===t.length)return!1;var i=0;for(e=void 0!==e?e:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();i<t.length;)t[i].update(e)?i++:t.splice(i,1);return!0}}}();n.Tween=function(t){var e=t,i={},r={},o={},s=1e3,a=0,h=!1,u=!1,l=!1,c=0,p=null,f=n.Easing.Linear.None,d=n.Interpolation.Linear,m=[],v=null,_=!1,y=null,g=null,w=null;for(var x in t)i[x]=parseFloat(t[x],10);this.to=function(t,e){return void 0!==e&&(s=e),r=t,this},this.start=function(t){n.add(this),u=!0,_=!1,p=void 0!==t?t:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),p+=c;for(var s in r){if(r[s]instanceof Array){if(0===r[s].length)continue;r[s]=[e[s]].concat(r[s])}i[s]=e[s],i[s]instanceof Array==!1&&(i[s]*=1),o[s]=i[s]||0}return this},this.stop=function(){return u?(n.remove(this),u=!1,null!==w&&w.call(e),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var t=0,e=m.length;e>t;t++)m[t].stop()},this.delay=function(t){return c=t,this},this.repeat=function(t){return a=t,this},this.yoyo=function(t){return h=t,this},this.easing=function(t){return f=t,this},this.interpolation=function(t){return d=t,this},this.chain=function(){return m=arguments,this},this.onStart=function(t){return v=t,this},this.onUpdate=function(t){return y=t,this},this.onComplete=function(t){return g=t,this},this.onStop=function(t){return w=t,this},this.update=function(t){var n;if(p>t)return!0;_===!1&&(null!==v&&v.call(e),_=!0);var u=(t-p)/s;u=u>1?1:u;var w=f(u);for(n in r){var x=i[n]||0,b=r[n];b instanceof Array?e[n]=d(b,w):("string"==typeof b&&(b=x+parseFloat(b,10)),"number"==typeof b&&(e[n]=x+(b-x)*w))}if(null!==y&&y.call(e,w),1==u){if(a>0){isFinite(a)&&a--;for(n in o){if("string"==typeof r[n]&&(o[n]=o[n]+parseFloat(r[n],10)),h){var E=o[n];o[n]=r[n],r[n]=E}i[n]=o[n]}return h&&(l=!l),p=t+c,!0}null!==g&&g.call(e);for(var T=0,M=m.length;M>T;T++)m[T].start(t);return!1}return!0}},n.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)))},Out:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/n)+1)},InOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n):i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/n)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-n.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*n.Easing.Bounce.In(2*t):.5*n.Easing.Bounce.Out(2*t-1)+.5}}},n.Interpolation={Linear:function(t,e){var i=t.length-1,r=i*e,o=Math.floor(r),s=n.Interpolation.Utils.Linear;return 0>e?s(t[0],t[1],r):e>1?s(t[i],t[i-1],i-r):s(t[o],t[o+1>i?i:o+1],r-o)},Bezier:function(t,e){var i,r=0,o=t.length-1,s=Math.pow,a=n.Interpolation.Utils.Bernstein;for(i=0;o>=i;i++)r+=s(1-e,o-i)*s(e,i)*t[i]*a(o,i);return r},CatmullRom:function(t,e){var i=t.length-1,r=i*e,o=Math.floor(r),s=n.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(0>e&&(o=Math.floor(r=i*(1+e))),s(t[(o-1+i)%i],t[o],t[(o+1)%i],t[(o+2)%i],r-o)):0>e?t[0]-(s(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[i]-(s(t[i],t[i],t[i-1],t[i-1],r-i)-t[i]):s(t[o?o-1:0],t[o],t[o+1>i?i:o+1],t[o+2>i?i:o+2],r-o)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=n.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i,n=1;if(t[e])return t[e];for(i=e;i>1;i--)n*=i;return t[e]=n}}(),CatmullRom:function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e}}},e.exports=n},{}],5:[function(t,e,i){"use strict";function n(){this._yaw=null,this._pitch=null,this._hfov=null,this._vfov=null,this._corners=[r.create(),r.create(),r.create(),r.create()],this._planes=[r.create(),r.create(),r.create(),r.create(),r.create()]}var r=t("gl-matrix").vec3,o=t("./util/rotateVector");n.prototype._needsUpdate=function(t,e,i,n){return t!==this._yaw||e!==this._pitch||i!==this._hfov||n!==this._vfov},n.prototype._update=function(t,e,i,n){var s=this._corners,a=this._planes,h=.5*Math.tan(i/2),u=.5*Math.tan(n/2);r.set(s[0],-h,u,-.5),r.set(s[1],h,u,-.5),r.set(s[2],h,-u,-.5),r.set(s[3],-h,-u,-.5);for(var l=0;4>l;l++)o(s[l],s[l],0,-t,-e);r.cross(a[0],s[0],s[1]),r.cross(a[1],s[1],s[2]),r.cross(a[2],s[2],s[3]),r.cross(a[3],s[3],s[0]),r.set(a[4],0,0,-1),o(a[4],a[4],0,-t,-e),this._yaw=t,this._pitch=e,this._hfov=i,this._vfov=n},n.prototype.intersects=function(t,e,i,n,o){var s=this._planes;this._needsUpdate(t,e,i,n)&&this._update(t,e,i,n);for(var a=0;5>a;a++){for(var h=s[a],u=!1,l=0;l<o.length;l++){var c=o[l];if(r.dot(h,c)>=0){u=!0;break}}if(!u)return!1}return!0},e.exports=n},{"./util/rotateVector":108,"gl-matrix":2}],6:[function(t,e,i){"use strict";function n(t,e){this._equals=t,this._hash=e,this._queue=[],this._visited=new r(t,e),this._neighborsFun=null,this._exploreFun=null}var r=t("./collections/Set");n.prototype.start=function(t,e,i){if(this._neighborsFun||this._exploreFun)throw new Error("GraphFinder: search already in progress");this.reset(),this._neighborsFun=e,this._exploreFun=i,this._queue.push(t)},n.prototype.reset=function(){this._neighborsFun=null,this._exploreFun=null,this._queue.length=0,this._visited.clear()},n.prototype.next=function(){var t=this._queue,e=this._visited,i=this._neighborsFun,n=this._exploreFun;if(!i||!n)throw new Error("GraphFinder: no search in progress");for(;t.length>0;){var r=this._queue.shift();if(!e.has(r)&&n(r)){e.add(r);for(var o=i(r),s=0;s<o.length;s++)t.push(o[s]);return r}}return this.reset(),null},e.exports=n},{"./collections/Set":26}],7:[function(t,e,i){"use strict";function n(t,e,i,n,r){if(r=r||{},this._domElement=t,this._domContainer=e._hotspotContainer,this._domContainer.appendChild(this._domElement),this._scene=i,this._params=n,r.embedInSphereWithRadius&&!u())throw new Error("Hotspot: can not be embedded in sphere if CSS 3D Transforms are not supported");this._embedInSphereWithRadius=r.embedInSphereWithRadius,this._visible=!0,this._displayed=!1,this._position={x:0,y:0},this._viewChangeListener=this._update.bind(this),this._update()}function r(t,e,i,n){t.style.left="0",t.style.top="0";var r="",o=e.size(),s=o.width,a=o.height;r+="translateX("+s/2+"px) translateY("+a/2+"px) ";var u=.5*a/Math.tan(e.fov()/2);r+="perspective("+u+"px) ",r+="translateZ("+u+"px) ",r+="rotateX("+-e.pitch()+"rad) ",r+="rotateY("+e.yaw()+"rad) ",r+="rotateY("+-i.yaw+"rad) ",r+="rotateX("+i.pitch+"rad) ",r+="translateZ("+-a/2+"px) ",r+="scale("+a/n+", "+a/n+") ",h(t,r)}function o(t,e,i){if(u()){t.style.left="0",t.style.top="0";var n="translateX("+e+"px) translateY("+i+"px) translateZ(0)";h(t,n)}else t.style.left=e+"px",t.style.top=i+"px"}function s(t){t.style.left="",t.style.top="",u()&&h(t,"")}var a=t("./util/eventEmitter"),h=t("./domUtil").setTransform,u=t("./support/Css");a(n),n.prototype._destroy=function(){this._scene.removeEventListener("viewChange",this._viewChangeListener),this._viewChangeListener=null,this._domContainer.removeChild(this._domElement),this._domElement=null,this._domContainer=null,this._scene=null,this._params=null,this._visible=null,this._displayed=null,this._position=null},n.prototype.domElement=function(){return this._domElement},n.prototype.show=function(){this._visible||(this._visible=!0,this._displayed&&this._scene.addEventListener("viewChange",this._viewChangeListener),this._update())},n.prototype.hide=function(){this._visible&&(this._visible=!1,this._displayed||this._scene.removeEventListener("viewChange",this._viewChangeListener),this._update())},n.prototype._display=function(){this._displayed||(this._displayed=!0,this._visible&&this._scene.addEventListener("viewChange",this._viewChangeListener),this._update())},n.prototype._undisplay=function(){this._displayed&&(this._displayed=!1,this._visible||this._scene.removeEventListener("viewChange",this._viewChangeListener),this._update())},n.prototype._update=function(){var t,e,i=this._domElement,n=this._params,a=this._position,h=!1;if(this._visible&&this._displayed){var u=this._scene.view();this._embedInSphereWithRadius?(h=!0,r(i,u,n,this._embedInSphereWithRadius)):(u.coordinatesToScreen(n,a),t=a.x,e=a.y,null!=t&&null!=e&&(h=!0,o(i,t,e)))}h?(i.style.display="block",i.style.position="absolute"):(i.style.display="none",i.style.position="",s(i))},e.exports=n},{"./domUtil":43,"./support/Css":83,"./util/eventEmitter":97}],8:[function(t,e,i){"use strict";function n(t,e,i,n,r,o){o=o||{};var s=this;this._stage=t,this._source=e,this._geometry=i,this._view=n,this._effects=o.effects||null,this._textureStore=r,this._fixedLevelIndex=null,this._viewChangeHandler=function(){s.emit("viewChange",s.view())},this._view.addEventListener("change",this._viewChangeHandler),this._handleTextureStoreChange=function(){s.emit("textureStoreChange",s.textureStore())},this._textureStore.addEventListener("textureLoad",this._handleTextureStoreChange),this._textureStore.addEventListener("textureError",this._handleTextureStoreChange),this._textureStore.addEventListener("textureInvalid",this._handleTextureStoreChange),this._levels=[]}var r=t("./util/eventEmitter");r(n),n.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._handleTextureStoreChange),this._textureStore.removeEventListener("textureError",this._handleTextureStoreChange),this._textureStore.removeEventListener("textureInvalid",this._handleTextureStoreChange),this._stage.removeEventListener("resize",this._handleStageResize),this._stage=null,this._source=null,this._geometry=null,this._view=null,this._textureStore=null},n.prototype.source=function(){return this._source},n.prototype.geometry=function(){return this._geometry},n.prototype.view=function(){return this._view},n.prototype.effects=function(){return this._effects},n.prototype.textureStore=function(){return this._textureStore},n.prototype.setView=function(t){this._view=t,this.emit("viewChange",this._view)},n.prototype.setEffects=function(t){this._effects=t,this.emit("effectsChange",this._effects)},n.prototype.fixedLevel=function(){return this._fixedLevelIndex},n.prototype.setFixedLevel=function(t){if(t!==this._fixedLevelIndex){if(null!=t&&(t>=this._geometry.levelList.length||0>t))throw new Error("Level index out of range: "+t);this._fixedLevelIndex=t,this.emit("fixedLevelChange",this._fixedLevelIndex)}},n.prototype._selectLevel=function(){var t;return t=null!=this._fixedLevelIndex?this._geometry.levelList[this._fixedLevelIndex]:this._view.selectLevel(this._geometry.selectableLevelList)},n.prototype.visibleTiles=function(t){var e=this._selectLevel();return this._geometry.visibleTiles(this._view,e,t)},n.prototype.pinLevel=function(t){for(var e=this._geometry.levelList[t],i=this._geometry.getLevelTiles(e),n=0;n<i.length;n++)this._textureStore.pin(i[n])},n.prototype.unpinLevel=function(t){for(var e=this._geometry.levelList[t],i=this._geometry.getLevelTiles(e),n=0;n<i.length;n++)this._textureStore.unpin(i[n])},n.prototype.pinFirstLevel=function(){return this.pinLevel(0)},n.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)},e.exports=n},{"./util/eventEmitter":97}],9:[function(t,e,i){"use strict";function n(){this.constructor.super_.apply(this,arguments)}var r=t("./util/inherits");r(n,Error),e.exports=n},{"./util/inherits":99}],10:[function(t,e,i){"use strict";function n(t,e){this._stage=t,this._controls=e,this._running=!1,this._renderOnNextFrame=!1,this._boundLoop=this._loop.bind(this),this._onBeforeRender=!1;var i=this;this._renderInvalidHandler=function(){i._onBeforeRender||i.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}var r=t("./util/eventEmitter");r(n),n.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),
this._stage=null},n.prototype.stage=function(){return this._stage},n.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},n.prototype.stop=function(){this._running=!1},n.prototype.renderOnNextFrame=function(){this._running&&!this._renderOnNextFrame&&(this._renderOnNextFrame=!0,requestAnimationFrame(this._boundLoop))},n.prototype._loop=function(){this._running&&(this._renderOnNextFrame=!1,this.render())},n.prototype.render=function(){this._onBeforeRender=!0,this.emit("beforeRender"),this._onBeforeRender=!1,this._stage.render(),this.emit("afterRender")},e.exports=n},{"./util/eventEmitter":97}],11:[function(t,e,i){"use strict";function n(t,e){this._viewer=t,this._layer=e,this._displayed=!1,this._hotspots=[],this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotsHandler=this._updateHotspots.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotsHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._layer.view().addEventListener("change",this._viewChangeHandler)}var r=t("./util/eventEmitter"),o=t("./Hotspot"),s=t("./util/clock"),a=t("./util/noop"),h=t("./util/type"),u=t("./util/defaults"),l=2e3;r(n),n.prototype._destroy=function(){this._layer.view().removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotsHandler);var t=this;this._hotspots.forEach(function(e){t.destroyHotspot(e)}),this._movement&&this.stopMovement(),this._movement=null,this._viewChangeListener=null,this._sceneChangeListener=null,this._viewer=null,this._layer=null,this._displayed=null,this._hotspots=null},n.prototype.createHotspot=function(t,e,i){e=e||{};var n=new o(t,this._viewer,this,e,i);return this._hotspots.push(n),this._viewer.scene()===this&&n._display(),n},n.prototype.hasHotspot=function(t){return this._hotspots.indexOf(t)>=0},n.prototype.listHotspots=function(){return[].concat(this._hotspots)},n.prototype.destroyHotspot=function(t){var e=this._hotspots.indexOf(t);if(0>e)throw new Error("No such hotspot");this._hotspots.splice(e,0),this._viewer.scene()===this&&t._undisplay(),t._destroy()},n.prototype.layer=function(){return this._layer},n.prototype.view=function(){return this._layer.view()},n.prototype.visible=function(){return this._displayed},n.prototype.switchTo=function(t,e){return this._viewer.switchScene(this,t,e)},n.prototype.lookTo=function(t,e,i){if(e=e||{},i=i||a,"object"!==h(t))throw new Error("Parameter 0 of lookTo() should be an object");var n=null!=e.transitionDuration?e.transitionDuration:l,r=this._layer.view(),o=r.parameters(),s={};u(s,t),u(s,o);var c=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},p=function(){var t=!1;return function(e,i){if(i>=n&&t)return null;var r=Math.min(i/n,1);for(var a in e){var h=o[a],u=s[a];e[a]=h+c(r)*(u-h)}return t=i>=n,e}},f=this._viewer.controls().enabled();this._viewer.controls().disable(),this.startMovement(p,function(){f&&this._viewer.controls().enable(),i()})},n.prototype.startMovement=function(t,e){var i=this._viewer.renderLoop();this._movement&&this.stopMovement();var n=t();if("function"!=typeof n)throw new Error("Bad movement");this._movement=t,this._movementStep=n,this._movementStartTime=s(),this._movementParams={},this._movementCallback=e,i.addEventListener("beforeRender",this._updateMovementHandler),i.renderOnNextFrame()},n.prototype.stopMovement=function(){var t=this._viewer.renderLoop();this._movementCallback&&this._movementCallback(),t.removeEventListener("beforeRender",this._updateMovementHandler),this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null},n.prototype.movement=function(){return this._movement},n.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var t=this._viewer.renderLoop(),e=this._layer.view(),i=s()-this._movementStartTime,n=this._movementStep,r=this._movementParams;r=e.parameters(r),r=n(r,i),null==r?this.stopMovement():(e.setParameters(r),t.renderOnNextFrame())},n.prototype._updateHotspots=function(){var t;if(this._viewer.scene()===this)for(this._displayed=!0,t=0;t<this._hotspots.length;t++)this._hotspots[t]._display();else for(this._displayed=!1,t=0;t<this._hotspots.length;t++)this._hotspots[t]._undisplay()},e.exports=n},{"./Hotspot":7,"./util/clock":90,"./util/defaults":94,"./util/eventEmitter":97,"./util/noop":102,"./util/type":110}],12:[function(t,e,i){"use strict";function n(){}function r(t,e){var i=this;i._id=g++,i._store=t,i._tile=e,i._asset=null,i._texture=null,i._changeHandler=function(){t.emit("textureInvalid",e)};var r=t.source(),o=t.stage(),s=r.loadAsset.bind(r),a=o.createTexture.bind(o),h=p(c(s),a);d&&console.log("loading",i._id,i._tile),i._cancel=h(o,e,function(t,e,r,o){return i._cancel=null,t?(r&&r.destroy(),o&&o.destroy(),void(t instanceof n?(i._store.emit("textureCancel",i._tile),d&&console.log("cancel",i._id,i._tile)):(i._store.emit("textureError",i._tile),d&&console.log("error",i._id,i._tile)))):(i._texture=o,r.dynamic?(i._asset=r,r.addEventListener("change",i._changeHandler)):r.destroy(),i._store.emit("textureLoad",i._tile),void(d&&console.log("load",i._id,i._tile)))})}function o(t,e,i,n){n=l(n||{},y),this._source=e,this._stage=i;var r=t.TileClass;this._clientPhase=m,this._clientCounter=0,this._itemMap=new s(r.equals,r.hash),this._visible=new a(r.equals,r.hash),this._previouslyVisible=new h(r.equals,r.hash,n.previouslyVisibleCacheSize),this._pinMap=new s(r.equals,r.hash),this._newVisible=new a(r.equals,r.hash),this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}var s=t("./collections/Map"),a=t("./collections/Set"),h=t("./collections/LruSet"),u=t("./util/eventEmitter"),l=t("./util/defaults"),c=t("./util/retry"),p=t("./util/chain"),f=t("./util/inherits"),d="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.textureStore,m="idle",v="start",_="end",y={previouslyVisibleCacheSize:32},g=0;f(n,Error),r.prototype.asset=function(){return this._asset},r.prototype.texture=function(){return this._texture},r.prototype.destroy=function(){var t=this,e=t._id,i=t._store,r=t._tile,o=t._asset,s=t._texture,a=t._cancel;return a?void a(new n("Texture load cancelled")):(o&&(o.removeEventListener("change",t._changeHandler),o.destroy()),s&&s.destroy(),i.emit("textureUnload",r),d&&console.log("unload",e,r),t._changeHandler=null,t._asset=null,t._texture=null,t._tile=null,t._store=null,void(t._id=null))},u(r),u(o),o.prototype.destroy=function(){this.clear(),this._source=null,this._stage=null,this._itemMap=null,this._visible=null,this._previouslyVisible=null,this._pinMap=null,this._newVisible=null,this._noLongerVisible=null,this._visibleAgain=null,this._evicted=null},o.prototype.stage=function(){return this._stage},o.prototype.source=function(){return this._source},o.prototype.clear=function(){var t=this;t._evicted.length=0,t._itemMap.each(function(e){t._evicted.push(e)}),t._evicted.forEach(function(e){t._unloadTile(e)}),t._itemMap.clear(),t._visible.clear(),t._previouslyVisible.clear(),t._pinMap.clear(),t._newVisible.clear(),t._noLongerVisible.length=0,t._visibleAgain.length=0,t._evicted.length=0},o.prototype.clearNotPinned=function(){var t=this;t._evicted.length=0,t._itemMap.each(function(e){t._pinMap.has(e)||t._evicted.push(e)}),t._evicted.forEach(function(e){t._unloadTile(e)}),t._visible.clear(),t._previouslyVisible.clear(),t._evicted.length=0},o.prototype.startFrame=function(){if(this._clientPhase!==m&&this._clientPhase!==v)throw new Error("TextureStore: startFrame called out of sequence");this._clientPhase=v,this._clientCounter++,this._newVisible.clear()},o.prototype.markTile=function(t){if(this._clientPhase!==v)throw new Error("TextureStore: markTile called out of sequence");this._newVisible.add(t)},o.prototype.endFrame=function(){if(this._clientPhase!==v&&this._clientPhase!==_)throw new Error("TextureStore: endFrame called out of sequence");this._clientPhase=_,this._clientCounter--,this._clientCounter||(this._update(),this._clientPhase=m)},o.prototype._update=function(){var t=this;t._noLongerVisible.length=0,t._visible.each(function(e){t._newVisible.has(e)||t._noLongerVisible.push(e)}),t._visibleAgain.length=0,t._newVisible.each(function(e){t._previouslyVisible.has(e)&&t._visibleAgain.push(e)}),t._visibleAgain.forEach(function(e){t._previouslyVisible.remove(e)}),t._evicted.length=0,t._noLongerVisible.forEach(function(e){var i=t._itemMap.get(e),n=i&&i.texture();if(n){var r=t._previouslyVisible.add(e);null!=r&&t._evicted.push(r)}else i&&t._unloadTile(e)}),t._evicted.forEach(function(e){t._pinMap.has(e)||t._unloadTile(e)}),t._newVisible.each(function(e){var i=t._itemMap.get(e);if(i){var n=i.texture(),r=i.asset();n&&r&&(n.refresh(e,r),t.emit("textureInvalid",e))}else t._loadTile(e)});var e=t._visible;t._visible=t._newVisible,t._newVisible=e,t._noLongerVisible.length=0,t._visibleAgain.length=0,t._evicted.length=0},o.prototype._loadTile=function(t){if(this._itemMap.has(t))throw new Error("TextureStore: loading texture already in cache");var e=new r(this,t);this._itemMap.set(t,e)},o.prototype._unloadTile=function(t){var e=this._itemMap.del(t);if(!e)throw new Error("TextureStore: unloading texture not in cache");e.destroy()},o.prototype.asset=function(t){var e=this._itemMap.get(t);return e?e.asset():null},o.prototype.texture=function(t){var e=this._itemMap.get(t);return e?e.texture():null},o.prototype.pin=function(t){var e=this._pinMap.get(t)||0;this._pinMap.set(t,e+1),this._itemMap.has(t)||this._loadTile(t)},o.prototype.unpin=function(t){var e=this._pinMap.get(t);if(!e)throw new Error("TextureStore: unpin when not pinned");e--,e>0?this._pinMap.set(t,e):(this._pinMap.del(t),this._visible.has(t)||this._previouslyVisible.has(t)||this._unloadTile(t))},o.prototype.query=function(t){var e=this._itemMap.get(t),i=this._pinMap.get(t)||0;return{visible:this._visible.has(t),previouslyVisible:this._previouslyVisible.has(t),hasAsset:null!=e&&null!=e.asset(),hasTexture:null!=e&&null!=e.texture(),pinned:0!==i,pinCount:i}},e.exports=o},{"./collections/LruSet":24,"./collections/Map":25,"./collections/Set":26,"./util/chain":88,"./util/defaults":94,"./util/eventEmitter":97,"./util/inherits":99,"./util/retry":107}],13:[function(t,e,i){"use strict";function n(t){t=o(t||{},a),this._duration=t.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}var r=t("./util/eventEmitter"),o=t("./util/defaults"),s=t("./util/clock"),a={duration:1/0};r(n),n.prototype.start=function(){this._startTime=s(),null==this._handle&&this._duration<1/0&&this._setup(this._duration)},n.prototype.started=function(){return null!=this._startTime},n.prototype.stop=function(){this._startTime=null,null!=this._handle&&(clearTimeout(this._handle),this._handle=null)},n.prototype.reset=function(){this.start()},n.prototype._setup=function(t){this._handle=setTimeout(this._check,t)},n.prototype._check=function(){var t=s(),e=t-this._startTime,i=this._duration-e;this._handle=null,0>=i?(this.emit("timeout"),this._startTime=null):1/0>i&&this._setup(i)},n.prototype.duration=function(){return this._duration},n.prototype.setDuration=function(t){this._duration=t,null!=this._startTime&&(null!=this._handle&&(clearTimeout(this._handle),this._handle=null),this._check())},e.exports=n},{"./util/clock":90,"./util/defaults":94,"./util/eventEmitter":97}],14:[function(t,e,i){"use strict";function n(t,e){e=e||{},this._domElement=t;var i;if(e.stageType){if(i=x[e.stageType],!i)throw new Error("Unknown stage type: "+e.stageType)}else i=d();this._stage=new i(e),v(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),_.setAbsolute(this._controlContainer),_.setFullSize(this._controlContainer),_.setBlocking(this._controlContainer),t.appendChild(this._controlContainer),this._hotspotContainer=document.createElement("div"),_.setAbsolute(this._hotspotContainer),_.setNullSize(this._hotspotContainer),t.appendChild(this._hotspotContainer),this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new o(this._stage),this._controls=new s,this._controlMethods=m(this._controls,this._controlContainer,e.controls),this._controls.attach(this._renderLoop),e.cursors=e.cursors||{},this._dragCursor=new w(this._controls,"mouseViewDrag",t,e.cursors.drag),this._renderLoop.start(),this._scenes=[],this._scene=null,this._tween=null,this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new l,this._idleTimer.start(),this._resetIdleHandler=this._resetIdle.bind(this),this.addEventListener("viewChange",this._resetIdleHandler),this._enterIdleHandler=this._enterIdle.bind(this),this._idleTimer.addEventListener("timeout",this._enterIdleHandler),this._leaveIdleHandler=this._leaveIdle.bind(this),this._controls.addEventListener("active",this._leaveIdleHandler),this.addEventListener("sceneChange",this._leaveIdleHandler),this._idleMovement=null}var r=t("./util/eventEmitter"),o=t("./RenderLoop"),s=t("./controls/Controls"),a=t("./Layer"),h=t("./TextureStore"),u=t("./Scene"),l=t("./Timer"),c=t("./stages/WebGl"),p=t("./stages/Css"),f=t("./stages/Flash"),d=t("./chooseBestStage"),m=t("./controls/registerDefaultControls"),v=t("./renderers/registerDefaultRenderers"),_=t("./domUtil"),y=t("./util/tween"),g=t("./util/noop"),w=t("./controls/DragCursor"),x={webgl:c,css:p,flash:f},b=1e3;r(n),n.prototype.destroy=function(){this._domElement.removeChild(this._stage.domElement()),window.removeEventListener("resize",this._updateSizeListener),this._updateSizeListener=null,this._scene&&this._scene.view().removeEventListener("change",this._viewChangeHandler),this._viewChangeHandler=null;for(var t in this._controlMethods)this._controlMethods[t].destroy();this._controlMethods=null;for(var e=0;e<this._scenes.length;e++)this._scenes[e].destroy();this._scenes=null,this._scene=null,this._stage.destroy(),this._stage=null,this._renderLoop.destroy(),this._renderLoop=null,this._controls.destroy(),this._controls=null,this._tween&&(this._tween.stop(),this._tween=null),this._domElement=null,this._hotspotContainer=null,this._controlContainer=null},n.prototype.updateSize=function(){this._stage.updateSize()},n.prototype.stage=function(){return this._stage},n.prototype.renderLoop=function(){return this._renderLoop},n.prototype.controls=function(){return this._controls},n.prototype.createScene=function(t){t=t||{};var e=this._stage,i=t.source,n=t.geometry,r=t.view,o=new h(n,i,e,t.textureStore),s=new a(e,i,n,r,o);t.pinFirstLevel&&s.pinFirstLevel();var l=new u(this,s);return this._scenes.push(l),l},n.prototype._addLayer=function(t){t.pinFirstLevel(),this._stage.addLayer(t)},n.prototype._removeLayer=function(t){this._stage.hasLayer(t)&&(t.unpinFirstLevel(),this._stage.removeLayer(t)),t.textureStore().clearNotPinned()},n.prototype.destroyScene=function(t){var e=this._scenes.indexOf(t);if(0>e)throw new Error("No such scene in viewer");this._removeLayer(t._layer),this._scene===t&&(this._scene=null,this._tween&&(this._tween.stop(),this._tween=null)),this._scenes.splice(e,1);var i=t._layer,n=i.textureStore();t._destroy(),i.destroy(),n.destroy()},n.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},n.prototype.hasScene=function(t){return this._scenes.indexOf(t)>=0},n.prototype.listScenes=function(){return[].concat(this._scenes)},n.prototype.scene=function(){return this._scene},n.prototype.view=function(){var t=this._scene;return t?t.layer().view():null},n.prototype.lookTo=function(t,e,i){var n=this._scene;n&&n.lookTo(t,e,i)},n.prototype.startMovement=function(t,e){var i=this._scene;i&&i.startMovement(t,e)},n.prototype.stopMovement=function(){var t=this._scene;t&&t.stopMovement()},n.prototype.setIdleMovement=function(t,e){this._idleTimer.setDuration(t),this._idleMovement=e},n.prototype._resetIdle=function(){this._idleTimer.reset()},n.prototype._enterIdle=function(){var t=this._scene,e=this._idleMovement;t&&e&&t.startMovement(e)},n.prototype._leaveIdle=function(){var t=this._scene;t&&t.movement()===this._idleMovement&&t.stopMovement()},n.prototype.switchScene=function(t,e,i){e=e||{},i=i||g;var n=this._stage,r=this._scene;if(r===t)return void i();if(this._scenes.indexOf(t)<0)throw new Error("No such scene in viewer");var o=n.listLayers();if(r&&r.layer()!==o[o.length-1])throw new Error("Stage not in sync with viewer");this._tween&&(this._tween.stop(),this._tween=null);var s=r?r.layer():null,a=t.layer(),h=this._hotspotContainer;h.style.opacity=0;var u={opacity:0},l={opacity:1},c=null!=e.transitionDuration?e.transitionDuration:b;a===s&&(u.opacity=s.effects().opacity,c*=u.opacity);var p=this,f=function(){a!==s&&p._addLayer(a)},d=function(t){a.setEffects(t),h.style.opacity=t.opacity},m=function(){s&&s!==a&&p._removeLayer(s),p._tween=null,i()},v=function(){s&&s!==a&&p._removeLayer(s),p._tween=null,i()};this._tween=y(u,l,c,f,d,m,v),this._scene=t,this.emit("sceneChange"),this.emit("viewChange"),r&&r.view().removeEventListener("change",this._viewChangeHandler),t.view().addEventListener("change",this._viewChangeHandler)},e.exports=n},{"./Layer":8,"./RenderLoop":10,"./Scene":11,"./TextureStore":12,"./Timer":13,"./chooseBestStage":22,"./controls/Controls":31,"./controls/DragCursor":33,"./controls/registerDefaultControls":41,"./domUtil":43,"./renderers/registerDefaultRenderers":64,"./stages/Css":76,"./stages/Flash":77,"./stages/WebGl":80,"./util/eventEmitter":97,"./util/noop":102,"./util/tween":109}],15:[function(t,e,i){"use strict";function n(){this.constructor.super_.apply(this,arguments),this._domElement.appendChild(o())}function r(t){var e="";for(var i in t)e+=i+":"+t[i]+" !important;";return e}function o(){var t=document.createElement("a"),e=document.createElement("img");return t.appendChild(e),t.setAttribute("href","http://www.marzipano.net/"),t.setAttribute("target","_blank"),t.setAttribute("style",r(c)+r(u)),e.setAttribute("style",r(c)+r(l)),e.src=h,t}var s=t("./Viewer"),a=t("./util/inherits");a(n,s);var h="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAREAAABLCAMAAABgKEOZAAAAXVBMVEX///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8/beDHAAAAHnRSTlMAEBEgIjAzQERQVWBmcHd/iI+Zn6qvu7/Mz93f7u9X10/4AAAG2klEQVR4AeyYUYu1OAyGU6QUKVKKlFCk7///mTv4NujiqS574Rn4vudmepGjyTNpKpUBPoQgfyYgdT0JCKUBAEqUnYQmYkvMx0+TSAAMlR+U66aLs1/ASAwgtURGHATYj7Pv753EUOh7RkhxQvKelFYA6nqm5qsC+cjffzZCmh8bIW25GjFWEXEbVulEwMsrsFg3K1BkZwXK/nKXGuqupCHJjkPDJufOCYCcUYb6paFNDNNPAS7kxrqN41lTrECihkkI5bxnhCJ2DwsQpeMbNRWrKkIbvJVWxkZEPJBHRohbgXQxQiq2swe6edmIY3qOEjoLEPhHhGpSsSqAZWyEGsdGLATTZyOJy7mn5zYkeduI1H836rlZvUU1hAXV0p9ujaRnIxOQb42I2kOa+5aRwoKNjEYxif+yJlNXlrDJrZH8bERWbJ+N5MN72Bt3EfnCrlmuE2xm/SuUeRaRyuwU672RivXRSATcxQhX87H3aP91I4m1X4ddYOZslUgte+DcA1JnOhfMEcResoCrET7esGflijYfG2uegPi6kSkDWYZGpv0PN4wH3N48rgcYobdO+GFRIJpp49mIUfx5Y7FD3wKoqtoArDI2IhVZpA/VhsiN/rlHOlsQ+b89ooA6IVOj7NdApwQZG6EAK2bFSkWf58imqpVbcDRHxkZMQ0U1JQlQeRFgCSFY+pfJysOYm8QB3k4cx1KGk3WD/hcjC/D5rDmNDr7q/clKBqcv05r7WvY1ZGjEDotnI4r62QhPKvJNI6MvNBaSbV2QEnRshDGbezTigTQwotBfYuTyFe/FClPMZk0Vy72RCUhPRlxFcwMjQP4VRihhsbVvWC1bbICzTd4a/NCIKYS/NzJVIMrwK37+LUbOtwE4Jr40HKVVoMmDEbdBb4z4uMKEXIyElS/7upHBjREpp95JOPWOAbWCSQTi/Y3RFsY3Ruq+b2R4q0iW08j1QLw3wmVzYyOaZ5GBkY1v/o6RvzfP/7Rrhi2Os1AUFglBQriIBJEg/v+f+W5qtvXMsU1vty/MB8+nJbk999xHrTvDmKGhoaGhoaGhUor8n/6DyCAyiAwig8iQc24yv19DdpE/WuzjyXw8WJ+v3uJjLiVHv9Cr1sMoBe579DM8VkeYpZbI/KoLv3VbORWms3YvVdGZnta93LVL96uhepwNCslh8XP31RhFBOQRHyVxNm93sVsTNN9ehebJZqnTlApon5lI9dATYfc4GaOMULViyfq6i30AOV+lxwfD2SXXF/Yn+vN5EJHI3eqQoaiJgHv0IqFmyjxtPwLK1yGCSKi7wfcNqMvNUKYDW91Hs9zOzxHZSj7CUZrmfNUSzHMEOXp4d3axrlU43k1PiMy3dGLPlQwY9joC7pD9BO92rECDSdou0na04e8wrv0oHrL8Y5PaG9M2NB030JQrBCACL1NzTtzxIFujjFCNgoWvhjy1Bqmpn9PhWKtzu4PrgYFFcUepaRT5IIVqh0SCQYFBhGJ55W4T1F9EgAfbzw+Fl11q/fIzeyoQsVo319vCS1btBIaEGUCCBkhkrYPxEVmMLsJENfawmcgA9pQ7553p+Nk2EDKLsKeamgxDwghYii+RyM7ulWEyugiCgPBRYoOKKVb3jLCxfT1XERrT8uNGqkRMX3bHL30kAvRx3866CNttXWmyjQ0A9ITjVnVPLYDm5cdR2AJzJ/uMiMDiwb4VXYQE6wrP2AC6FCWRiOzb7R7fILLgnQBEYMeCLBhqI+AgOBDtIT0RZs9FZMEXLxPBoXh1948jQAF0YaTpgohiWM9FlxcvE8HvmO9FQBd8h++/R0TeLcrTayLyMRH5XUQ2Lrq+eHtEtidZsz7CB0SykghmA6VrInanu5WI9LPCjaiOQIMkMMAuSiLwPzqQLf04/B/tKyLF9jeX/zwCDlI309TvEvREVggHZ5jj8MXrzCWRtf+duXwcgQaRtiV2WfVELPxIAAeC4/Qv3gsiO69+hm2ujUCDTGCAXbRE8GdKxPtGnGTeIMLYNnz4TxHuBr7bRU+kv9Zr4Tj9i/eaCB8twSXVR6BBJjid0EVBBM+rYJrLODNkuCCSHUbFO1sfgQcRirPWLioisGnLdl9v629TUBw65Jt5iwhOO2342yd9BByk+WfxFn/57o2SCOYpYTkSOX8EKVEoDh3yxYFsn4hPt+m8O3AsoTAQfQQexP7tYh8GwWiJ4ICgYDgOWrBcn4gc06I8eGkjYArYFSAxSiKgZW+99sV8kwi7s/QRaBDJYOCMnghovTNOYsxXiRzu6e6+gtHnEXgQK9Dl32Wd/JGz3//LCXT/fgQ2GH9L8ns1iAwig8ggMogMIoPIIPIfiGyGLaAclDgAAAAASUVORK5CYII=",u={display:"block",position:"absolute",height:"30px",width:"auto",bottom:"10px",right:"15px",top:"auto",left:"auto"},l={height:"100%",width:"auto",position:"static"},c={display:"block",opacity:1,visibility:"visible",transform:"none","-webkit-transform":"none","-moz-transform":"none",margin:"auto","margin-left":"auto","margin-right":"auto","margin-top":"auto","margin-bottom":"auto","z-index":"10000"};e.exports=n},{"./Viewer":14,"./util/inherits":99}],16:[function(t,e,i){"use strict";function n(t,e,i){i=i||{},this._opts=i,this._element=t,this.source=e,this._timestamp=1,this._lastUsedTime=null}var r=t("../util/clock"),o=t("../util/eventEmitter");o(n),n.prototype.element=function(){return this._element},n.prototype.width=function(){return this._element.width},n.prototype.height=function(){return this._element.height},n.prototype.dynamic=!0,n.prototype.timestamp=function(){return this._timestamp},n.prototype.changed=function(){this._timestamp++,this.emit("change")},n.prototype.used=function(){this._lastUsedTime=r()},n.prototype.destroy=function(){this._opts.unload&&this._opts.unload(),this.source.unload(this)},e.exports=n},{"../util/clock":90,"../util/eventEmitter":97}],17:[function(t,e,i){"use strict";function n(t,e){this._flashElement=t,this._imageId=e,this._timestamp=r()}var r=t("../util/clock");n.prototype.element=function(){return this._imageId},n.prototype.timestamp=function(){return this._timestamp},n.prototype.dynamic=!1,n.prototype.destroy=function(){var t=this._flashElement,e=this._imageId;t.unloadImage(e),this._flashElement=null,this._imageId=null},e.exports=n},{"../util/clock":90}],18:[function(t,e,i){"use strict";function n(t){this._element=t,this._timestamp=r()}var r=t("../util/clock"),o=t("../util/noop");n.prototype.element=function(){return this._element},n.prototype.width=function(){return this._element.width},n.prototype.height=function(){return this._element.height},n.prototype.timestamp=function(){return this._timestamp},n.prototype.dynamic=!1,n.prototype.destroy=o,e.exports=n},{"../util/clock":90,"../util/noop":102}],19:[function(t,e,i){"use strict";function n(t){this._element=t,this._timestamp=r()}var r=t("../util/clock"),o=t("../util/noop");n.prototype.element=function(){return this._element},n.prototype.width=function(){return this._element.naturalWidth},n.prototype.height=function(){return this._element.naturalHeight},n.prototype.timestamp=function(){return this._timestamp},n.prototype.dynamic=!1,n.prototype.destroy=o,e.exports=n},{"../util/clock":90,"../util/noop":102}],20:[function(t,e,i){"use strict";function n(t){t=r(t||{},a);var e=t.yawSpeed,i=t.pitchSpeed,n=t.fovSpeed,o=t.yawAccel,s=t.pitchAccel,h=t.fovAccel,u=t.targetPitch,l=t.targetFov;return function(){var t,r,a,c,p=0,f=0,d=0,m=0,v=0,_=0,y=0;return function(g,w){if(t=(w-p)/1e3,v=Math.min(f+t*o,e),r=v*t,g.yaw=g.yaw+r,null!=u&&g.pitch!==u){var x=.5*d*d/s;_=Math.abs(u-g.pitch)>x?Math.min(d+t*s,i):d-t*s,a=_*t,u<g.pitch&&(g.pitch=Math.max(u,g.pitch-a)),u>g.pitch&&(g.pitch=Math.min(u,g.pitch+a))}if(null!=l&&g.fov!==u){var b=.5*m*m/h;y=Math.abs(l-g.fov)>b?Math.min(m+t*h,n):m-t*h,c=y*t,l<g.fov&&(g.fov=Math.max(l,g.fov-c)),l>g.fov&&(g.fov=Math.min(l,g.fov+c))}return p=w,f=v,d=_,m=y,g}}}var r=t("./util/defaults"),o=.1,s=.01,a={yawSpeed:o,pitchSpeed:o,fovSpeed:o,yawAccel:s,pitchAccel:s,fovAccel:s,targetPitch:0,targetFov:null};e.exports=n},{"./util/defaults":94}],21:[function(t,e,i){"use strict";function n(t,e,i,n){n=n||{};var r;r=null!=i&&null!=i.absoluteWidth?i.absoluteWidth:null!=i&&null!=i.relativeWidth?i.relativeWidth*t:t;var o;o=i&&null!=i.absoluteHeight?i.absoluteHeight:null!=i&&null!=i.relativeHeight?i.relativeHeight*e:e;var s;s=null!=i&&null!=i.absoluteX?i.absoluteX:null!=i&&null!=i.relativeX?i.relativeX*t:0;var a;return a=null!=i&&null!=i.absoluteY?i.absoluteY:null!=i&&null!=i.relativeY?i.relativeY*e:0,n.height=o,n.width=r,n.left=s,n.top=a,n.right=s+r,n.bottom=a+o,n}e.exports=n},{}],22:[function(t,e,i){"use strict";function n(){for(var t=0;t<a.length;t++){var e=a[t];if(e.supported())return e}throw new Error("None of the stage types are supported")}var r=t("./stages/WebGl"),o=t("./stages/Css"),s=t("./stages/Flash"),a=[r,o,s];e.exports=n},{"./stages/Css":76,"./stages/Flash":77,"./stages/WebGl":80}],23:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("LruMap: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("LruMap: bad hash function");if(this._hash=e,"number"!=typeof i||isNaN(i)||0>i)throw new Error("LruMap: bad maximum size");this._maxsize=i,this._keys=[],this._values=[],this._pivot=0}var r=t("../util/mod");n.prototype._modulus=function(){return this._maxsize>this._keys.length?this._keys.length+1:this._maxsize},n.prototype.get=function(t){for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this._equals(t,i)){var n=this._values[e];return n}}return null},n.prototype.set=function(t,e){var i=null,n=!1;if(0===this._maxsize)return t;for(var o=0;o<this._keys.length;o++){var s=this._keys[o];if(this._equals(t,s)){for(var a=o,h=this._modulus();a!==this._pivot;){var u=r(a+1,h);this._keys[a]=this._keys[u],this._values[a]=this._values[u],a=u}n=!0;break}}return n||(i=this._pivot<this._keys.length?this._keys[this._pivot]:null),this._keys[this._pivot]=t,this._values[this._pivot]=e,this._pivot=r(this._pivot+1,this._modulus()),i},n.prototype.del=function(t){for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this._equals(t,i)){for(var n=this._values[e],o=e;o<this._keys.length-1;o++)this._keys[o]=this._keys[o+1],this._values[o]=this._values[o+1];return this._keys.length=this._keys.length-1,this._values.length=this._values.length-1,e<this._pivot&&(this._pivot=r(this._pivot-1,this._modulus())),n}}return null},n.prototype.has=function(t){for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this._equals(t,i))return!0}return!1},n.prototype.size=function(){return this._keys.length},n.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._pivot=0},n.prototype.each=function(t){for(var e=0,i=0;i<this._keys.length;i++){var n=this._keys[i],r=this._values[i];t(n,r),e+=1}return e},e.exports=n},{"../util/mod":101}],24:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("LruSet: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("LruSet: bad hash function");if(this._hash=e,"number"!=typeof i||isNaN(i)||0>i)throw new Error("LruSet: bad maximum size");this._maxsize=i,this._items=[],this._pivot=0}var r=t("../util/mod");n.prototype._modulus=function(){return this._maxsize>this._items.length?this._items.length+1:this._maxsize},n.prototype.add=function(t){var e=null,i=!1;if(0===this._maxsize)return t;for(var n=0;n<this._items.length;n++){var o=this._items[n];if(this._equals(t,o)){for(var s=n,a=this._modulus();s!==this._pivot;){var h=r(s+1,a);this._items[s]=this._items[h],s=h}i=!0;break}}return i||(e=this._pivot<this._items.length?this._items[this._pivot]:null),this._items[this._pivot]=t,this._pivot=r(this._pivot+1,this._modulus()),e},n.prototype.remove=function(t){for(var e=0;e<this._items.length;e++){var i=this._items[e];if(this._equals(t,i)){for(var n=e;n<this._items.length-1;n++)this._items[n]=this._items[n+1];return this._items.length=this._items.length-1,e<this._pivot&&(this._pivot=r(this._pivot-1,this._modulus())),i}}return null},n.prototype.has=function(t){for(var e=0;e<this._items.length;e++){var i=this._items[e];if(this._equals(t,i))return!0}return!1},n.prototype.size=function(){return this._items.length},n.prototype.clear=function(){this._items.length=0,this._pivot=0},n.prototype.each=function(t){for(var e=0,i=0;i<this._items.length;i++){var n=this._items[i];t(n),e+=1}return e},e.exports=n},{"../util/mod":101}],25:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("Map: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("Map: bad hash function");if(this._hash=e,null!=i){if("number"!=typeof i||isNaN(i)||1>i)throw new Error("Map: bad number of buckets");this._nbuckets=i}else this._nbuckets=r;this._keyBuckets=[],this._valBuckets=[];for(var n=0;n<this._nbuckets;n++)this._keyBuckets.push([]),this._valBuckets.push([])}var r=32;n.prototype._hashmod=function(t){return this._hash(t)%this._nbuckets},n.prototype.get=function(t){for(var e=this._hashmod(t),i=this._keyBuckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r)){var o=this._valBuckets[e],s=o[n];return s}}return null},n.prototype.set=function(t,e){for(var i=this._hashmod(t),n=this._keyBuckets[i],r=this._valBuckets[i],o=0;o<n.length;o++){var s=n[o];if(this._equals(t,s)){var a=r[o];return n[o]=t,r[o]=e,a}}return n.push(t),r.push(e),null},n.prototype.del=function(t){for(var e=this._hashmod(t),i=this._keyBuckets[e],n=this._valBuckets[e],r=0;r<i.length;r++){var o=i[r];if(this._equals(t,o)){for(var s=n[r],a=r;a<i.length-1;a++)i[a]=i[a+1],n[a]=n[a+1];return i.length=i.length-1,n.length=n.length-1,s}}return null},n.prototype.has=function(t){for(var e=this._hashmod(t),i=this._keyBuckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return!0}return!1},n.prototype.size=function(){for(var t=0,e=0;e<this._nbuckets;e++){var i=this._keyBuckets[e];t+=i.length}return t},n.prototype.clear=function(){for(var t=0;t<this._nbuckets;t++){var e=this._keyBuckets[t],i=this._valBuckets[t];e.length=0,i.length=0}},n.prototype.each=function(t){for(var e=0,i=0;i<this._nbuckets;i++)for(var n=this._keyBuckets[i],r=this._valBuckets[i],o=0;o<n.length;o++){var s=n[o],a=r[o];t(s,a),e+=1}return e},e.exports=n},{}],26:[function(t,e,i){"use strict";function n(t,e,i){if("function"!=typeof t)throw new Error("Set: bad equals function");if(this._equals=t,"function"!=typeof e)throw new Error("Set: bad hash function");if(this._hash=e,null!=i){if("number"!=typeof i||isNaN(i)||1>i)throw new Error("Set: bad number of buckets");this._nbuckets=i}else this._nbuckets=r;this._buckets=[];for(var n=0;n<this._nbuckets;n++)this._buckets.push([])}var r=32;n.prototype._hashmod=function(t){return this._hash(t)%this._nbuckets},n.prototype.add=function(t){for(var e=this._hashmod(t),i=this._buckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return i[n]=t,r}return i.push(t),null},n.prototype.remove=function(t){for(var e=this._hashmod(t),i=this._buckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r)){for(var o=n;o<i.length-1;o++)i[o]=i[o+1];return i.length=i.length-1,r}}return null},n.prototype.has=function(t){for(var e=this._hashmod(t),i=this._buckets[e],n=0;n<i.length;n++){var r=i[n];if(this._equals(t,r))return!0}return!1},n.prototype.size=function(){for(var t=0,e=0;e<this._nbuckets;e++){var i=this._buckets[e];t+=i.length}return t},n.prototype.clear=function(){for(var t=0;t<this._nbuckets;t++){var e=this._buckets[t];e.length=0}},n.prototype.each=function(t){for(var e=0,i=0;i<this._nbuckets;i++)for(var n=this._buckets[i],r=0;r<n.length;r++){var o=n[r];t(o),e+=1}return e},e.exports=n},{}],27:[function(t,e,i){"use strict";function n(t){this._concurrency=t&&t.concurrency||1,this._paused=t&&!!t.paused||!1,this._pool=[];for(var e=0;e<this._concurrency;e++)this._pool.push(new r(t));this._next=0}var r=t("./WorkQueue"),o=t("../util/mod");

n.prototype.length=function(){for(var t=0,e=0;e<this._pool.length;e++)t+=this._pool[e].length();return t},n.prototype.push=function(t,e){var i=this._next,n=this._pool[i].push(t,e);return this._next=o(this._next+1,this._concurrency),n},n.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var t=0;t<this._concurrency;t++)this._pool[t].pause()}},n.prototype.resume=function(){if(this._paused){this._paused=!1;for(var t=0;t<this._concurrency;t++)this._pool[t].resume()}},e.exports=n},{"../util/mod":101,"./WorkQueue":28}],28:[function(t,e,i){"use strict";function n(t,e){this.fn=t,this.cb=e,this.cfn=null}function r(t){this._queue=[],this._delay=t&&t.delay||0,this._paused=t&&!!t.paused||!1,this._currentTask=null,this._lastFinished=null}var o=t("../util/clock");r.prototype.length=function(){return this._queue.length},r.prototype.push=function(t,e){var i=new n(t,e),r=this._cancel.bind(this,i);return this._queue.push(i),this._next(),r},r.prototype.pause=function(){this._paused||(this._paused=!0)},r.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},r.prototype._start=function(t){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=t;var e=this._finish.bind(this,t);if(t.cfn=t.fn(e),"function"!=typeof t.cfn)throw new Error("WorkQueue: function is not cancellable")},r.prototype._finish=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask!==t)throw new Error("WorkQueue: called finish on wrong task");t.cb.apply(null,e),this._currentTask=null,this._lastFinished=o(),this._next()},r.prototype._cancel=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask===t)t.cfn.apply(null,e);else{var i=this._queue.indexOf(t);i>=0&&(this._queue.splice(i,1),t.cb.apply(null,e))}},r.prototype._next=function(){if(!this._paused&&this._queue.length&&!this._currentTask){if(null!=this._lastFinished){var t=o()-this._lastFinished,e=this._delay-t;if(e>0)return void setTimeout(this._next.bind(this),e)}var i=this._queue.shift();this._start(i)}},e.exports=r},{"../util/clock":90}],29:[function(t,e,i){"use strict";function n(t){this._element=t||document,this._keys={},this._keydownHandler=this._set.bind(this,!0),this._keyupHandler=this._set.bind(this,!1),this._blurHandler=this._unsetAll.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler)}var r=t("../util/eventEmitter");r(n),n.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler)},n.prototype._set=function(t,e){var i=!1;for(var n in this._keys){var r=!1;this._keys[n][e.keyCode]&&(this._keys[n][e.keyCode].active!==t&&(i=!0,r=!0),this._keys[n][e.keyCode].active=t),r&&this.emit("changeOnType",n)}i&&this.emit("change")},n.prototype._unsetAll=function(){var t=!1;for(var e in this._keys){var i=!1;for(var n in this._keys[e])this._keys[e][n].active&&(i=!0,t=!0),this._keys[e][n].active=!1;i&&this.emit("changeOnType",e)}t&&this.emit("change")},n.prototype.register=function(t,e){return this._keys[e]=this._keys[e]||{},this._keys[e][t]?!1:void(this._keys[e][t]={isActive:!1})},n.prototype.count=function(t){var e=0;if(!this._keys[t])return 0;for(var i in this._keys[t])this._keys[t][i]&&this._keys[t][i].active&&(e+=1);return e},n.prototype.unregister=function(t,e){this._keys[e][t]=void 0},n.prototype.unregisterKey=function(t){for(var e in this._keys)this.unregister(t,e)},e.exports=n},{"../util/eventEmitter":97}],30:[function(t,e,i){"use strict";function n(t){t=t||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch"],this._clock=t.clock||s,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}var r=t("../util/eventEmitter"),o=t("./Dynamics"),s=t("../util/clock");r(n),n.prototype.add=function(t){if(!this.has(t)){var e={};this._parameters.forEach(function(t){e[t]={dynamics:new o,time:null}});var i=this._updateDynamics.bind(this,e),n={instance:t,dynamics:e,parameterDynamicsHandler:i};t.addEventListener("parameterDynamics",i),this._methods.push(n)}},n.prototype.remove=function(t){var e=this._indexOfInstance(t);if(e>=0){var i=this._methods.splice(e,1)[0];i.instance.removeEventListener("parameterDynamics",i.parameterDynamicsHandler)}},n.prototype.has=function(t){return this._indexOfInstance(t)>=0},n.prototype._indexOfInstance=function(t){for(var e=0;e<this._methods.length;e++)if(this._methods[e].instance===t)return e;return-1},n.prototype.list=function(){for(var t=[],e=0;e<this._methods.length;e++)t.push(this._methods[e].instance);return t},n.prototype._updateDynamics=function(t,e,i){var n=t[e];if(!n)throw new Error("Unknown control parameter "+e);var r=this._clock();n.dynamics.update(i,(r-n.time)/1e3),n.time=r,this.emit("change")},n.prototype._resetComposedOffsets=function(){for(var t=0;t<this._parameters.length;t++)this._composedOffsets[this._parameters[t]]=0},n.prototype.offsets=function(){var t,e=!1,i=this._clock();this._resetComposedOffsets();for(var n=0;n<this._methods.length;n++)for(var r=this._methods[n].dynamics,o=0;o<this._parameters.length;o++){t=this._parameters[o];var s=r[t],a=s.dynamics;null!=a.offset&&(this._composedOffsets[t]+=a.offset,a.offset=null);var h=(i-s.time)/1e3,u=a.offsetFromVelocity(h);u&&(this._composedOffsets[t]+=u);var l=a.velocityAfter(h);a.velocity=l,l&&(e=!0),s.time=i}return this._composeReturn.changing=e,this._composeReturn},n.prototype.destroy=function(){for(var t=this.list(),e=0;e<t.length;e++)this.remove(t[e]);this._methods=null},e.exports=n},{"../util/clock":90,"../util/eventEmitter":97,"./Dynamics":34}],31:[function(t,e,i){"use strict";function n(t){t=t||{},this._methods={},this._composer=new r,this._enabled=t&&t.enabled?!!t.enabled:!0,this._activeCount=0,this._attachedRenderLoop=null}var r=t("./Composer"),o=t("../util/eventEmitter"),s="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;o(n),n.prototype.methods=function(){var t={};for(var e in this._methods)t[e]=this._methods[e];return t},n.prototype.method=function(t){return this._methods[t]},n.prototype.registerMethod=function(t,e){if(this._methods[t])throw new Error("Control method already registered with id "+t);this._methods[t]={instance:e,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,t),inactiveHandler:this._handleInactive.bind(this,t)}},n.prototype.unregisterMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&this.disableMethod(t),delete this._methods[t]},n.prototype.enableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled||(e.enabled=!0,e.active&&this._incrementActiveCount(),this._listen(t),this._updateComposer(),this.emit("methodEnabled",t))},n.prototype.disableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&(e.enabled=!1,e.active&&this._decrementActiveCount(),this._unlisten(t),this._updateComposer(),this.emit("methodDisabled",t))},n.prototype.enabled=function(){return this._enabled},n.prototype.enable=function(){this._enabled=!0,this._activeCount>0&&this.emit("active"),this._updateComposer()},n.prototype.disable=function(){this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this._updateComposer()},n.prototype.attach=function(t){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=t,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=t.renderOnNextFrame.bind(t),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},n.prototype.detach=function(){this._attachedRenderLoop&&(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},n.prototype.attached=function(){return null!=this._attachedRenderLoop},n.prototype._listen=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.addEventListener("active",e.activeHandler),e.instance.addEventListener("inactive",e.inactiveHandler)},n.prototype._unlisten=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.removeEventListener("active",e.activeHandler),e.instance.removeEventListener("inactive",e.inactiveHandler)},n.prototype._handleActive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active||(e.active=!0,this._incrementActiveCount())},n.prototype._handleInactive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active&&(e.active=!1,this._decrementActiveCount())},n.prototype._incrementActiveCount=function(){this._activeCount++,s&&this._checkActiveCount(),this._enabled&&1===this._activeCount&&this.emit("active")},n.prototype._decrementActiveCount=function(){this._activeCount--,s&&this._checkActiveCount(),this._enabled&&0===this._activeCount&&this.emit("inactive")},n.prototype._checkActiveCount=function(){var t=0;for(var e in this._methods){var i=this._methods[e];i.enabled&&i.active&&t++}if(t!=this._activeCount)throw new Error("Bad control state")},n.prototype._updateComposer=function(){var t=this._composer;for(var e in this._methods){var i=this._methods[e],n=this._enabled&&i.enabled;n&&!t.has(i.instance)&&t.add(i.instance),!n&&t.has(i.instance)&&t.remove(i.instance)}},n.prototype._updateViewsWithControls=function(){var t=this._composer.offsets();t.changing&&this._attachedRenderLoop.renderOnNextFrame();for(var e=this._attachedRenderLoop.stage().listLayers(),i=0;i<e.length;i++)e[i].view().updateWithControlParameters(t.offsets)},n.prototype.destroy=function(){this.detach(),this._composer.destroy(),this._methods=null},e.exports=n},{"../util/eventEmitter":97,"./Composer":30}],32:[function(t,e,i){"use strict";function n(t,e,i){this._element=t,this._opts=s(i||{},u),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new r,y:new r},this._hammer=o.get(t,e),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleEnd.bind(this)),this._hammer.on("pancancel",this._handleEnd.bind(this))}var r=t("./Dynamics"),o=t("./HammerGestures"),s=t("../util/defaults"),a=t("../util/eventEmitter"),h=t("./util").maxFriction,u={friction:6,maxFrictionTime:.3},l="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;a(n),n.prototype.destroy=function(){this._hammer.release(),this._element=null,this._opts=null,this._startEvent=null,this._lastEvent=null,this._active=null,this._dynamics=null,this._hammer=null},n.prototype._handleHammerEvent=function(t){if(t.isFirst){if(l&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}else if(t.isFinal){if(l&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},n.prototype._handleStart=function(t){t.preventDefault(),this._startEvent=t},n.prototype._handleMove=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsMove(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},n.prototype._handleEnd=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},n.prototype._updateDynamicsMove=function(t){var e=t.deltaX,i=t.deltaY,n=this._lastEvent||this._startEvent;n&&(e-=n.deltaX,i-=n.deltaY);var r=this._element.getBoundingClientRect(),o=r.right-r.left,s=r.bottom-r.top;e/=o,i/=s,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-1*e,this._dynamics.y.offset=i,this._lastEvent=t};var c=[null,null];n.prototype._updateDynamicsRelease=function(t){var e=this._element.getBoundingClientRect(),i=e.right-e.left,n=e.bottom-e.top,r=1e3*t.velocityX/i,o=-1e3*t.velocityY/n;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=r,this._dynamics.y.velocity=o,h(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,c),this._dynamics.x.friction=c[0],this._dynamics.y.friction=c[1]},e.exports=n},{"../util/defaults":94,"../util/eventEmitter":97,"./Dynamics":34,"./HammerGestures":35,"./util":42}],33:[function(t,e,i){"use strict";function n(t,e,i,n){n=n||{},n.active=["move"],n.inactive=["default"],n.disabled=[null],this._controls=t,this._id=e,this._setActiveCursor=r.bind(null,i,n.active),this._setInactiveCursor=r.bind(null,i,n.inactive),this._setDisabledCursor=r.bind(null,i,n.disabled),t.method(e).enabled&&this._attachCursor(t.method(e));var o=this;this._methodEnabledHandler=function(i){i===e&&o._attachCursor(t.method(e))},this._methodDisabledHandler=function(i){i===e&&o._detachCursor(t.method(e))},t.addEventListener("methodEnabled",this._methodEnabledHandler),t.addEventListener("methodDisabled",this._methodDisabledHandler)}function r(t,e){e.forEach(function(e){t.style.cursor=e})}n.prototype.destroy=function(){this._detachCursor(this._controls.method(this._id)),this._controls.removeEventListener("methodEnabled",this._methodEnabledHandler),this._controls.removeEventListener("methodDisabled",this._methodDisabledHandler)},n.prototype._attachCursor=function(t){t.instance.addEventListener("active",this._setActiveCursor),t.instance.addEventListener("inactive",this._setInactiveCursor),t.active?this._setActiveCursor():this._setInactiveCursor()},n.prototype._detachCursor=function(t){t.instance.removeEventListener("active",this._setActiveCursor),t.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor()},e.exports=n},{}],34:[function(t,e,i){"use strict";function n(){this.velocity=null,this.friction=null,this.offset=null}function r(t,e){return 0>t?Math.min(0,t+e):t>0?Math.max(0,t-e):0}n.equals=function(t,e){return t.velocity===e.velocity&&t.friction===e.friction&&t.offset===e.offset},n.prototype.equals=function(t){return n.equals(this,t)},n.prototype.update=function(t,e){t.offset&&(this.offset=this.offset||0,this.offset+=t.offset);var i=this.offsetFromVelocity(e);i&&(this.offset=this.offset||0,this.offset+=i),this.velocity=t.velocity,this.friction=t.friction},n.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},n.prototype.velocityAfter=function(t){return this.velocity?this.friction?r(this.velocity,this.friction*t):this.velocity:null},n.prototype.offsetFromVelocity=function(t){t=Math.min(t,this.nullVelocityTime());var e=this.velocityAfter(t),i=(this.velocity+e)/2;return i*t},n.prototype.nullVelocityTime=function(){return null==this.velocity?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)},e.exports=n},{}],35:[function(t,e,i){"use strict";function n(){this._managers=new h(r,o)}function r(t,e){return t===e}function o(t){for(var e=t.id||t.toString();e.length<5;)e+="0";return u(e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3),e.charCodeAt(4))}function s(t,e,i,n){this._manager=e,this._element=i,this._type=n,this._hammerGestures=t,this._eventHandlers=[]}var a=t("hammerjs"),h=t("../collections/Map"),u=t("../util/hash"),l=t("bowser").browser;n.prototype.get=function(t,e){this._managers.has(t)||this._managers.set(t,{});var i=this._managers.get(t);i[e]||(i[e]=this._createManager(t,e));var n=i[e];return n.refs+=1,new s(this,n.manager,t,e)},n.prototype._createManager=function(t,e){var i=new a.Manager(t);return"mouse"===e?i.add(new a.Pan({direction:a.DIRECTION_ALL,threshold:0})):("touch"===e||"pen"===e||"kinect"===e)&&(i.add(new a.Pan({direction:a.DIRECTION_ALL,threshold:20,pointers:1})),l.msie&&parseFloat(l.version)<10||i.add(new a.Pinch)),{manager:i,refs:0}},n.prototype._releaseHandle=function(t,e){var i=this._managers.get(t)[e];i.refs-=1,i.refs<=0&&(i.manager.destroy(),this._managers.get(t)[e]=null)},s.prototype.on=function(t,e){var i=this._type,n=function(t){i===t.pointerType&&e(t)};this._eventHandlers.push({events:t,handler:n}),this._manager.on(t,n)},s.prototype.release=function(){for(var t=0;t<this._eventHandlers.length;t++){var e=this._eventHandlers[t];this._manager.off(e.events,e.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},s.prototype.manager=function(){return this._manager()},e.exports=new n},{"../collections/Map":25,"../util/hash":98,bowser:1,hammerjs:3}],36:[function(t,e,i){"use strict";function n(t,e){this._dynamics={x:new o,y:new o,zoom:new o},this._opts=s(e||{},h),this._activeKeys=new r;for(var i=Object.keys(t),n=0;n<i.length;n++)for(var a=i[n],u=0;u<t[a].length;u++)this._activeKeys.register(t[a][u],a);this._changeOnTypeHandler=this._updateDynamics.bind(this),this._activeKeys.addEventListener("changeOnType",this._changeOnTypeHandler)}var r=t("./ActiveKeys"),o=t("./Dynamics"),s=t("../util/defaults"),a=t("../util/eventEmitter"),h={velocity:.7,zoomVelocity:.7,friction:3,zoomFriction:3};a(n),n.prototype.destroy=function(){this._activeKeys.removeEventListener("changeOnType",this._changeOnTypeHandler),this._activeKeys.destroy(),this._changeOnTypeHandler=null,this._activeKeys=null,this._opts=null},n.prototype._updateDynamics=function(t){"right"===t||"left"===t?(this._setParameterDynamics("x",this._activation("right","left"),this._opts.velocity,this._opts.friction),this.emit("parameterDynamics","x",this._dynamics.x)):"up"===t||"down"===t?(this._setParameterDynamics("y",this._activation("up","down"),this._opts.velocity,this._opts.friction),this.emit("parameterDynamics","y",this._dynamics.y)):("out"===t||"in"===t)&&(this._setParameterDynamics("zoom",this._activation("out","in"),this._opts.zoomVelocity,this._opts.zoomFriction),this.emit("parameterDynamics","zoom",this._dynamics.zoom)),this.emit("active"),this.emit("inactive")},n.prototype._activation=function(t,e){var i=this._activeKeys.count(t)-this._activeKeys.count(e);return i>0?1:0>i?-1:0},n.prototype._setParameterDynamics=function(t,e,i,n){0!==e&&(this._dynamics[t].velocity=i*e),this._dynamics[t].friction=0===e?n:null},e.exports=n},{"../util/defaults":94,"../util/eventEmitter":97,"./ActiveKeys":29,"./Dynamics":34}],37:[function(t,e,i){"use strict";function n(t,e,i){this._hammer=o.get(t,e),this._lastEvent=null,this._active=!1,this._dynamics=new r,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}var r=t("./Dynamics"),o=t("./HammerGestures"),s=t("../util/eventEmitter");s(n),n.prototype.destroy=function(){this._hammer.release(),this._hammer=null,this._lastEvent=null,this._active=null,this._dynamics=null},n.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},n.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},n.prototype._handleEvent=function(t){var e=t.scale;this._lastEvent&&(e/=this._lastEvent.scale),this._dynamics.offset=-1*(e-1),this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=t},e.exports=n},{"../util/eventEmitter":97,"./Dynamics":34,"./HammerGestures":35}],38:[function(t,e,i){"use strict";function n(t,e,i){this._element=t,this._opts=s(i||{},u),this._active=!1,this._hammer=o.get(t,e),this._dynamics={x:new r,y:new r},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}var r=t("./Dynamics"),o=t("./HammerGestures"),s=t("../util/defaults"),a=t("../util/eventEmitter"),h=t("./util").maxFriction,u={speed:8,friction:6,maxFrictionTime:.3};a(n),n.prototype.destroy=function(){this._hammer.release(),this._hammer=null,this._element=null,this._opts=null,this._active=null,this._dynamics=null},n.prototype._handleStart=function(t){t.preventDefault(),this._active||(this._active=!0,this.emit("active"))},n.prototype._handleMove=function(t){t.preventDefault(),this._updateDynamics(t,!1)},n.prototype._handleRelease=function(t){t.preventDefault(),this._updateDynamics(t,!0),this._active&&(this._active=!1,this.emit("inactive"))};var l=[null,null];n.prototype._updateDynamics=function(t,e){var i=this._element.getBoundingClientRect(),n=i.right-i.left,r=i.bottom-i.top,o=Math.max(n,r),s=t.deltaX/o*this._opts.speed,a=-t.deltaY/o*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=s,this._dynamics.y.velocity=a,e&&(h(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,l),this._dynamics.x.friction=l[0],this._dynamics.y.friction=l[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)},e.exports=n},{"../util/defaults":94,"../util/eventEmitter":97,"./Dynamics":34,"./HammerGestures":35,"./util":42}],39:[function(t,e,i){"use strict";function n(t,e){this._opts=a(e||{},u),this._dynamics=new o,this._eventList=[];var i=this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing;this._wheelListener=new s(t,i.bind(this))}function r(t){var e=1==t.deltaMode?20:1;return t.deltaY*e}var o=t("./Dynamics"),s=t("./WheelListener"),a=t("../util/defaults"),h=t("../util/eventEmitter"),u={frictionTime:.2,zoomDelta:.001};h(n),n.prototype.destroy=function(){this._wheelListener.remove(),this._opts=null,this._dynamics=null,this._eventList=null},n.prototype.withoutSmoothing=function(t){this._dynamics.offset=r(t)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")},n.prototype.withSmoothing=function(t){var e=t.timeStamp;for(this._eventList.push(t);this._eventList[0].timeStamp<e-1e3*this._opts.frictionTime;)this._eventList.shift(0);for(var i=0,n=0;n<this._eventList.length;n++){var o=r(this._eventList[n])*this._opts.zoomDelta;i+=o/this._opts.frictionTime}this._dynamics.velocity=i,this._dynamics.friction=Math.abs(i)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")},e.exports=n},{"../util/defaults":94,"../util/eventEmitter":97,"./Dynamics":34,"./WheelListener":40}],40:[function(t,e,i){"use strict";function n(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":null}function r(t,e,i){var r=n();if("wheel"===r)this._fun=e,this._elem=t,this._elem.addEventListener("wheel",this._fun,i);else{if("mousewheel"!==r)throw new Error("Browser does not support mouse wheel events");this._fun=o(e),this._elem=t,this._elem.addEventListener("mousewheel",this._fun,i)}}function o(t){return function(e){e||(e=window.event);var i={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:1,deltaX:0,deltaZ:0,timeStamp:e.timeStamp||Date.now(),preventDefault:e.preventDefault.bind(e)};return i.deltaY=-1/40*e.wheelDelta,e.wheelDeltaX&&(i.deltaX=-1/40*e.wheelDeltaX),t(i)}}r.prototype.remove=function(){var t=n();"wheel"===t?this._elem.removeEventListener("wheel",this._fun):"mousewheel"===t&&this._elem.removeEventListener("mousewheel",this._fun)},e.exports=r},{}],41:[function(t,e,i){"use strict";function n(t,e,i){i=r(i||{},l);var n={left:[37,65],up:[38,87],right:[39,68],down:[40,83],"in":[107],out:[109]},c={keyboard:new o(n),mouseViewDrag:new s(e,"mouse"),mouseViewQtvr:new a(e,"mouse"),scrollZoom:new h(e),touchView:new s(e,"touch"),pinch:new u(e,"touch")},p=["gyro"];switch(i.mouseViewMode){case"drag":p.push("mouseViewQtvr");break;case"qtvr":p.push("mouseViewDrag");break;default:throw new Error("Unknown mouse view mode: "+i.mouseViewMode)}for(var f in c){var d=c[f];t.registerMethod(f,d),p.indexOf(f)<0&&t.enableMethod(f)}return c}var r=t("../util/defaults"),o=t("./Keyboard"),s=t("./Drag"),a=t("./Qtvr"),h=t("./ScrollZoom"),u=t("./PinchZoom"),l={mouseViewMode:"drag"};e.exports=n},{"../util/defaults":94,"./Drag":32,"./Keyboard":36,"./PinchZoom":37,"./Qtvr":38,"./ScrollZoom":39}],42:[function(t,e,i){"use strict";function n(t,e,i,n,o){var s=Math.sqrt(Math.pow(e,2)+Math.pow(i,2));t=Math.max(t,s/n),r(e,i,t,o),o[0]=Math.abs(o[0]),o[1]=Math.abs(o[1])}function r(t,e,i,n){var r=Math.atan(e/t);n[0]=i*Math.cos(r),n[1]=i*Math.sin(r)}e.exports={maxFriction:n,changeVectorNorm:r}},{}],43:[function(t,e,i){"use strict";function n(t){for(var e=document.documentElement.style,i=["Moz","Webkit","Khtml","O","ms"],n=0;n<i.length;n++){var r=i[n],o=t[0].toUpperCase()+t.slice(1),s=r+o;if(s in e)return s}return t}function r(t){var e=n(t);return function(t){return t.style[e]}}function o(t){var e=n(t);return function(t,i){return t.style[e]=i}}function s(t){m(t,"translateZ(0)")}function a(t){v(t,"0 0 0")}function h(t){t.style.position="absolute"}function u(t,e,i){t.style.width=e+"px",t.style.height=i+"px"}function l(t){t.style.width=t.style.height=0}function c(t){t.style.width=t.style.height="100%"}function p(t){t.style.overflow="hidden"}function f(t){t.style.pointerEvents="none"}function d(t){t.style.backgroundColor="#000",t.style.opacity="0",t.style.filter="alpha(opacity=0)"}var m=o("transform"),v=o("transformOrigin");e.exports={prefixProperty:n,getWithVendorPrefix:r,setWithVendorPrefix:o,setTransform:m,setTransformOrigin:v,setNullTransform:s,setNullTransformOrigin:a,setAbsolute:h,setPixelSize:u,setNullSize:l,setFullSize:c,setOverflowHidden:p,setNoPointerEvents:f,setBlocking:d}},{}],44:[function(t,e,i){"use strict";function n(t,e,i,n,r){this.face=t,this.x=e,this.y=i,this.z=n,this._cube=r}function r(t){if(this.constructor.super_.call(this,t),this._size=t.size,this._tileSize=t.tileSize,this._size%this._tileSize!==0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}function o(t){if("array"!==y(t))throw new Error("Argument 0 must be an array");this.levelList=p(t,r),this.selectableLevelList=f(this.levelList),d(this.levelList),this._graphFinder=new h(n.equals,n.hash),this._neighborsCache=new l(n.equals,n.hash,64),this._vec=m.create(),this._tileVertices=[m.create(),m.create(),m.create(),m.create()]}for(var s=t("../util/inherits"),a=t("../util/hash"),h=t("../GraphFinder"),u=t("../util/rotateVector"),l=t("../collections/LruMap"),c=t("./Level"),p=t("./common").makeLevelList,f=t("./common").makeSelectableLevelList,d=t("./common").checkLevelDimensions,m=t("gl-matrix").vec3,v=t("../util/clamp"),_=t("../util/cmp"),y=t("../util/type"),g="fblrud",w={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},x={},b=0;b<g.length;b++){var E=g[b],T=w[E],M=m.fromValues(0,0,-1);u(M,M,0,T.y,T.x),x[E]=M}var C={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},L=[[0,1],[1,0],[0,-1],[-1,0]];n.prototype.level=function(){return this._cube.levelList[this.z]},n.prototype.rotX=function(){return w[this.face].x},n.prototype.rotY=function(){return w[this.face].y},n.prototype.centerX=function(){return(this.x+.5)/this.level().numHorizontalTiles()-.5},n.prototype.centerY=function(){return.5-(this.y+.5)/this.level().numVerticalTiles()},n.prototype.scaleX=function(){return 1/this.level().numHorizontalTiles()},n.prototype.scaleY=function(){return 1/this.level().numVerticalTiles()},n.prototype.width=function(){return this.level().tileWidth()},n.prototype.height=function(){return this.level().tileHeight()},n.prototype.levelWidth=function(){return this.level().width()},n.prototype.levelHeight=function(){return this.level().height()},n.prototype.vertices=function(t){return this._cube.vertices(this,t)},n.prototype.atTopLevel=function(){return 0===this.z},n.prototype.atBottomLevel=function(){return this.z===this._cube.levelList.length-1},n.prototype.parent=function(){return this._cube.parent(this)},n.prototype.children=function(t){return this._cube.children(this,t)},n.prototype.atTopEdge=function(){return 0===this.y},n.prototype.atBottomEdge=function(){return this.y===this.level().numVerticalTiles()-1},n.prototype.atLeftEdge=function(){return 0===this.x},n.prototype.atRightEdge=function(){return this.x===this.level().numHorizontalTiles()-1},n.prototype.padTop=function(){return this.atTopEdge()&&/[fu]/.test(this.face)},n.prototype.padBottom=function(){return!this.atBottomEdge()||/[fd]/.test(this.face)},n.prototype.padLeft=function(){return this.atLeftEdge()&&/[flud]/.test(this.face)},n.prototype.padRight=function(){return!this.atRightEdge()||/[frud]/.test(this.face)},n.hash=function(t){return null!=t?a(t.face.charCodeAt(0),t.z,t.x,t.y):0},n.equals=function(t,e){return null!=t&&null!=e&&t.face===e.face&&t.z===e.z&&t.x===e.x&&t.y===e.y},n.cmp=function(t,e){var i="fudlrb".indexOf(t.face),n="fudlrb".indexOf(e.face);return _(t.z,e.z)||_(i,n)||_(t.y,e.y)||_(t.x,e.x)},n.str=function(t){return"CubeTile("+t.face+", "+t.x+", "+t.y+", "+t.z+")"},n.prototype.hash=function(){return n.hash(this)},n.prototype.equals=function(t){return n.equals(this,t)},n.prototype.cmp=function(t){return n.cmp(this,t)},n.prototype.str=function(){return n.str(this)},s(r,c),r.prototype.width=function(){return this._size},r.prototype.height=function(){return this._size},r.prototype.tileWidth=function(){return this._tileSize},r.prototype.tileHeight=function(){return this._tileSize},o.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var i=this.levelList[e];t=Math.max(t,i.tileWidth,i.tileHeight)}return t},o.prototype._tile=function(t,e,i,r){return new n(t,e,i,r,this)},o.prototype.tileAt=function(t,e,i){var r=this._vec,o=1/0,s=null;m.set(r,0,0,-1),u(r,r,0,-t,-e);for(var a in x){var h=x[a],l=1-m.dot(h,r);o>l&&(o=l,s=a)}for(var c=Math.max(Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]))/.5,p=0;3>p;p++)r[p]=r[p]/c;var f=w[s];u(r,r,0,-f.y,-f.x);var d=this.levelList.indexOf(i),_=i.numHorizontalTiles(),y=i.numVerticalTiles(),g=r[0],b=r[1],E=v(Math.floor((.5+g)*_),0,_-1),T=v(Math.floor((.5-b)*y),0,y-1);return new n(s,E,T,d,this)},o.prototype.neighbors=function(t){var e=this._neighborsCache.get(t);if(e)return e;for(var i=this._vec,r=t.face,o=t.x,s=t.y,a=t.z,h=t.level(),l=h.numHorizontalTiles(),c=h.numVerticalTiles(),p=[],f=0;f<L.length;f++){var d=L[f][0],_=L[f][1],y=o+d,g=s+_,x=r;if(0>y||y>=l||0>g||g>=c){var b=t.centerX(),E=t.centerY();0>y?(m.set(i,-.5,E,-.5),x=C[r][0]):y>=l?(m.set(i,.5,E,-.5),x=C[r][1]):0>g?(m.set(i,b,.5,-.5),x=C[r][2]):g>=c&&(m.set(i,b,-.5,-.5),x=C[r][3]);var T;T=w[r],u(i,i,0,T.y,T.x),T=w[x],u(i,i,0,-T.y,-T.x),y=v(Math.floor((.5+i[0])*l),0,l-1),g=v(Math.floor((.5-i[1])*c),0,c-1)}p.push(new n(x,y,g,a,this))}return this._neighborsCache.set(t,p),p},o.prototype.vertices=function(t,e){function i(e,i,n){switch(t.face){case"f":m.set(e,i,n,-.5);break;case"b":m.set(e,-i,n,.5);break;case"l":m.set(e,-.5,n,-i);break;case"r":m.set(e,.5,n,i);break;case"u":m.set(e,i,.5,n);break;case"d":m.set(e,i,-.5,-n);break;default:throw new Error("bad cube face")}}var n=t.centerX()-t.scaleX()/2,r=t.centerX()+t.scaleX()/2,o=t.centerY()-t.scaleY()/2,s=t.centerY()+t.scaleY()/2;return i(e[0],n,s),i(e[1],r,s),i(e[2],r,o),i(e[3],n,o),e},o.prototype.getLevelTiles=function(t,e){var i=this.levelList.indexOf(t),r=t.numHorizontalTiles()-1,o=t.numVerticalTiles()-1;e||(e=[]);

for(var s=0;s<g.length;s++)for(var a=g[s],h=0;r>=h;h++)for(var u=0;o>=u;u++)e.push(new n(a,h,u,i,this));return e},o.prototype.parent=function(t){if(t.atTopLevel())return null;var e=t.z-1,i=t.face,r=t.x/t.level().numHorizontalTiles(),o=t.y/t.level().numVerticalTiles(),s=this.levelList[e],a=Math.floor(r*s.numHorizontalTiles()),h=Math.floor(o*s.numVerticalTiles());return new n(i,a,h,e,this)},o.prototype.children=function(t,e){if(t.atBottomLevel())return null;e||(e=[]);for(var i=t.z+1,r=t.level(),o=this.levelList[i],s=o.numHorizontalTiles()/r.numHorizontalTiles(),a=o.numVerticalTiles()/r.numVerticalTiles(),h=0;s>h;h++)for(var u=0;a>u;u++)e.push(new n(t.face,s*t.x+h,a*t.y+u,i,this));return e},o.prototype.visibleTiles=function(t,e,i){function n(e){return e.vertices(r),t.intersects(r)}var r=this._tileVertices,o=this._graphFinder,s=this.tileAt(t.yaw(),t.pitch(),e);if(!n(s))throw new Error("Starting tile is not visible");i||(i=[]);var a;for(o.start(s,this.neighbors.bind(this),n);null!=(a=o.next());)i.push(a);return i},o.TileClass=o.prototype.TileClass=n,o.type=o.prototype.type="cube",n.type=n.prototype.type="cube",e.exports=o},{"../GraphFinder":6,"../collections/LruMap":23,"../util/clamp":89,"../util/cmp":91,"../util/hash":98,"../util/inherits":99,"../util/rotateVector":108,"../util/type":110,"./Level":47,"./common":48,"gl-matrix":2}],45:[function(t,e,i){"use strict";function n(t,e){this.z=t,this._equirect=e}function r(t){this.constructor.super_.call(this,t),this._width=t.width}function o(t){if("array"!==c(t))throw new Error("Argument 0 must be an array");this.levelList=u.makeLevelList(t,r),this.selectableLevelList=u.makeSelectableLevelList(this.levelList)}var s=t("../util/inherits"),a=t("../util/hash"),h=t("../util/cmp"),u=t("./common"),l=t("./Level"),c=t("../util/type");n.prototype.level=function(){return this._equirect.levelList[this.z]},n.prototype.width=function(){return this.level().tileWidth()},n.prototype.height=function(){return this.level().tileHeight()},n.prototype.atTopLevel=function(){return 0===this.z},n.prototype.atBottomLevel=function(){return this.z===this._equirect.levelList.length-1},n.prototype.padTop=function(){return!1},n.prototype.padBottom=function(){return!1},n.prototype.padLeft=function(){return!1},n.prototype.padRight=function(){return!1},n.prototype.neighbors=function(){return this._equirect.neighbors(this)},n.prototype.parent=function(){return this._equirect.parent(this)},n.prototype.children=function(t){return this._equirect.children(this,t)},n.prototype.atTopEdge=function(){return!0},n.prototype.atBottomEdge=function(){return!0},n.prototype.atLeftEdge=function(){return!0},n.prototype.atRightEdge=function(){return!0},n.hash=function(t){return a(t.z)},n.equals=function(t,e){return t.z===e.z},n.cmp=function(t,e){return h(t.z,e.z)},n.str=function(t){return"EquirectTile("+t.z+")"},n.prototype.hash=function(){return n.hash(this)},n.prototype.equals=function(t){return n.equals(this,t)},n.prototype.cmp=function(t){return n.cmp(this,t)},n.prototype.str=function(){return n.str(this)},s(r,l),r.prototype.width=function(){return this._width},r.prototype.height=function(){return this._width/2},r.prototype.tileWidth=function(){return this._width},r.prototype.tileHeight=function(){return this._width/2},o.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var i=this.levelList[e];t=Math.max(t,i.tileWidth,i.tileHeight)}return t},o.prototype.getLevelTiles=function(t,e){var i=this.levelList.indexOf(t);return e||(e=[]),e.push(new n(i,this)),e},o.prototype.parent=function(t){return t.atTopLevel()?null:new n(t.z-1,this)},o.prototype.children=function(t,e){return t.atBottomLevel()?null:(e||(e=[]),e.push(new n(t.z+1,this)),e)},o.prototype.neighbors=function(t){return[]},o.prototype.getFirstLevel=function(){return new n(0,this)},o.prototype.visibleTiles=function(t,e,i){var r=new n(this.levelList.indexOf(e),this);i||(i=[]),i.length=0,i.push(r)},o.TileClass=o.prototype.TileClass=n,o.type=o.prototype.type="equirect",n.type=n.prototype.type="equirect",n.disableMipmapping=n.prototype.disableMipmapping=!0,e.exports=o},{"../util/cmp":91,"../util/hash":98,"../util/inherits":99,"../util/type":110,"./Level":47,"./common":48}],46:[function(t,e,i){"use strict";function n(t,e,i,n){this.x=t,this.y=e,this.z=i,this._flat=n}function r(t){if(this.constructor.super_.call(this,t),this._width=t.width,this._height=t.height,this._tileWidth=t.tileWidth,this._tileHeight=t.tileHeight,this._width%this._tileWidth!==0)throw new Error("Level width is not multiple of tile width: "+this._width+" vs. "+this._tileWidth);if(this._height%this._tileHeight!==0)throw new Error("Level height is not multiple of tile height: "+this._height+" vs. "+this._tileHeight)}function o(t){if("array"!==_(t))throw new Error("Argument 0 must be an array");this.levelList=c(t,r),this.selectableLevelList=p(this.levelList),f(this.levelList),this._graphFinder=new h(n.equals,n.hash),this._neighborsCache=new u(n.equals,n.hash,64),this._tileVertices=[d.create(),d.create(),d.create(),d.create()]}var s=t("../util/inherits"),a=t("../util/hash"),h=t("../GraphFinder"),u=t("../collections/LruMap"),l=t("./Level"),c=t("./common").makeLevelList,p=t("./common").makeSelectableLevelList,f=t("./common").checkLevelDimensions,d=t("gl-matrix").vec2,m=t("../util/clamp"),v=t("../util/cmp"),_=t("../util/type"),y=[[0,1],[1,0],[0,-1],[-1,0]];n.prototype.level=function(){return this._flat.levelList[this.z]},n.prototype.rotX=function(){return 0},n.prototype.rotY=function(){return 0},n.prototype.centerX=function(){return(this.x+.5)/this.level().numHorizontalTiles()},n.prototype.centerY=function(){return-(this.y+.5)/this.level().numVerticalTiles()},n.prototype.scaleX=function(){return 1/this.level().numHorizontalTiles()},n.prototype.scaleY=function(){return 1/this.level().numVerticalTiles()},n.prototype.width=function(){return this.level().tileWidth()},n.prototype.height=function(){return this.level().tileHeight()},n.prototype.levelWidth=function(){return this.level().width()},n.prototype.levelHeight=function(){return this.level().height()},n.prototype.vertices=function(t){return this._flat.vertices(this,t)},n.prototype.atTopLevel=function(){return 0===this.z},n.prototype.atBottomLevel=function(){return this.z===this._flat.levelList.length-1},n.prototype.neighbors=function(){return this._flat.neighbors(this)},n.prototype.parent=function(){return this._flat.parent(this)},n.prototype.children=function(t){return this._flat.children(this,t)},n.prototype.atTopEdge=function(){return 0===this.y},n.prototype.atBottomEdge=function(){return this.y===this.level().numVerticalTiles()-1},n.prototype.atLeftEdge=function(){return 0===this.x},n.prototype.atRightEdge=function(){return this.x===this.level().numHorizontalTiles()-1},n.prototype.padTop=function(){return!1},n.prototype.padBottom=function(){return!this.atBottomEdge()},n.prototype.padLeft=function(){return!1},n.prototype.padRight=function(){return!this.atRightEdge()},n.hash=function(t){return null!=t?a(t.z,t.x,t.y):0},n.equals=function(t,e){return null!=t&&null!=e&&t.z===e.z&&t.x===e.x&&t.y===e.y},n.cmp=function(t,e){return v(t.z,e.z)||v(t.y,e.y)||v(t.x,e.x)},n.str=function(t){return"FlatTile("+t.x+", "+t.y+", "+t.z+")"},n.prototype.hash=function(){return n.hash(this)},n.prototype.equals=function(t){return n.equals(this,t)},n.prototype.cmp=function(t){return n.cmp(this,t)},n.prototype.str=function(){return n.str(this)},s(r,l),r.prototype.width=function(){return this._width},r.prototype.height=function(){return this._height},r.prototype.tileWidth=function(){return this._tileWidth},r.prototype.tileHeight=function(){return this._tileHeight},o.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var i=this.levelList[e];t=Math.max(t,i.tileWidth,i.tileHeight)}return t},o.prototype.vertices=function(t,e){var i=t.centerX()-t.scaleX()/2,n=t.centerX()+t.scaleX()/2,r=t.centerY()-t.scaleY()/2,o=t.centerY()+t.scaleY()/2;return d.set(e[0],i,o),d.set(e[1],n,o),d.set(e[2],n,r),d.set(e[3],i,r),e},o.prototype.getLevelTiles=function(t,e){var i=this.levelList.indexOf(t),r=t.numHorizontalTiles()-1,o=t.numVerticalTiles()-1;e||(e=[]);for(var s=0;r>=s;s++)for(var a=0;o>=a;a++)e.push(new n(s,a,i,this));return e},o.prototype.parent=function(t){if(t.atTopLevel())return null;var e=t.z-1,i=Math.floor(t.x/2),r=Math.floor(t.y/2);return new n(i,r,e,this)},o.prototype.children=function(t,e){if(t.atBottomLevel())return null;e||(e=[]);var i=t.z+1;return e.push(new n(2*t.x,2*t.y,i,this)),e.push(new n(2*t.x,2*t.y+1,i,this)),e.push(new n(2*t.x+1,2*t.y,i,this)),e.push(new n(2*t.x+1,2*t.y+1,i,this)),e},o.prototype.neighbors=function(t){var e=this._neighborsCache.get(t);if(e)return e;for(var i=t.x,r=t.y,o=t.z,s=t.level(),a=s.numHorizontalTiles()-1,h=s.numVerticalTiles()-1,u=[],l=0;l<y.length;l++){var c=y[l][0],p=y[l][1],f=i+c,d=r+p;f>=0&&a>=f&&d>=0&&h>=d&&u.push(new n(f,d,o,this))}return this._neighborsCache.set(t,u),u},o.prototype.getFirstLevel=function(t){var e=this.levelList[0],i=e.numHorizontalTiles()-1,r=e.numVerticalTiles()-1;t||(t=[]);for(var o=0;i>=o;o++)for(var s=0;r>=s;s++)t.push(new n(o,s,0,this));return t},o.prototype.tileAt=function(t,e,i){var r=this.levelList.indexOf(i),o=i.numHorizontalTiles(),s=i.numVerticalTiles(),a=m(Math.floor(t*o),0,o-1),h=m(Math.floor(e*s),0,s-1);return new n(a,h,r,this)},o.prototype.visibleTiles=function(t,e,i){function n(e){return e.vertices(r),t.intersects(r)}var r=this._tileVertices,o=this._graphFinder,s=this.tileAt(t.x(),t.y(),e);if(!n(s))throw new Error("Starting tile is not visible");i||(i=[]);var a;for(o.start(s,this.neighbors.bind(this),n);null!=(a=o.next());)i.push(a);return i},o.TileClass=o.prototype.TileClass=n,o.type=o.prototype.type="flat",n.type=n.prototype.type="flat",e.exports=o},{"../GraphFinder":6,"../collections/LruMap":23,"../util/clamp":89,"../util/cmp":91,"../util/hash":98,"../util/inherits":99,"../util/type":110,"./Level":47,"./common":48,"gl-matrix":2}],47:[function(t,e,i){"use strict";function n(t){this._fallbackOnly=!!t.fallbackOnly}n.prototype.numHorizontalTiles=function(){return this.width()/this.tileWidth()},n.prototype.numVerticalTiles=function(){return this.height()/this.tileHeight()},n.prototype.fallbackOnly=function(){return this._fallbackOnly},e.exports=n},{}],48:[function(t,e,i){"use strict";function n(t){for(var e=1;e<t.length;e++){var i=t[e],n=t[e-1];if(i.width()%n.width()!==0)throw new Error("Level width must be multiple of previous level: "+i.width()+" vs. "+n.width());if(i.height()%n.height()!==0)throw new Error("Level height must be multiple of previous level: "+i.height()+" vs. "+n.height());if(i.numHorizontalTiles()%n.numHorizontalTiles()!==0)throw new Error("Number of horizontal tiles must be multiple of that on parent level: "+i.numHorizontalTiles()+" ("+i.width()+"/"+i.tileWidth()+") vs. "+n.numHorizontalTiles()+" ("+n.width()+"/"+n.tileWidth()+")");if(i.numVerticalTiles()%n.numVerticalTiles()!==0)throw new Error("Number of vertical tiles must be multiple of that on parent level: "+i.numVerticalTiles()+" ("+i.height()+"/"+i.tileHeight()+") vs. "+n.numVerticalTiles()+" ("+n.height()+"/"+n.tileHeight()+")")}}function r(t,e){for(var i=[],n=0;n<t.length;n++)i.push(new e(t[n]));return i.sort(function(t,e){return s(t.width(),e.width())}),i}function o(t){var e=t.filter(function(t){return!t.fallbackOnly()});if(!e.length)throw new Error("No selectable levels in list");return e}var s=t("../util/cmp");e.exports={makeLevelList:r,makeSelectableLevelList:o,checkLevelDimensions:n}},{"../util/cmp":91}],49:[function(t,e,i){var n=t("./index");n.Viewer=t("./WatermarkedViewer"),e.exports=n},{"./WatermarkedViewer":15,"./index":50}],50:[function(t,e,i){e.exports={WebGlStage:t("./stages/WebGl"),CssStage:t("./stages/Css"),FlashStage:t("./stages/Flash"),WebGlCubeRenderer:t("./renderers/WebGlCube"),WebGlFlatRenderer:t("./renderers/WebGlFlat"),WebGlEquirectRenderer:t("./renderers/WebGlEquirect"),CssCubeRenderer:t("./renderers/CssCube"),CssFlatRenderer:t("./renderers/CssFlat"),FlashCubeRenderer:t("./renderers/FlashCube"),FlashFlatRenderer:t("./renderers/FlashFlat"),registerDefaultRenderers:t("./renderers/registerDefaultRenderers"),CubeGeometry:t("./geometries/Cube"),FlatGeometry:t("./geometries/Flat"),EquirectGeometry:t("./geometries/Equirect"),RectilinearView:t("./views/Rectilinear"),FlatView:t("./views/Flat"),ImageUrlSource:t("./sources/ImageUrl"),VideoUrlSource:t("./sources/VideoUrl"),SolidColorSource:t("./sources/SolidColor"),DynamicCanvasAsset:t("./assets/DynamicCanvas"),TextureStore:t("./TextureStore"),Layer:t("./Layer"),RenderLoop:t("./RenderLoop"),KeyboardControls:t("./controls/Keyboard"),DragControls:t("./controls/Drag"),QtvrControls:t("./controls/Qtvr"),ScrollZoomControls:t("./controls/ScrollZoom"),PinchZoomControls:t("./controls/PinchZoom"),Controls:t("./controls/Controls"),Viewer:t("./Viewer"),Scene:t("./Scene"),Hotspot:t("./Hotspot"),chooseBestStage:t("./chooseBestStage"),registerDefaultControls:t("./controls/registerDefaultControls"),autorotate:t("./autorotate"),version:t("./version")}},{"./Hotspot":7,"./Layer":8,"./RenderLoop":10,"./Scene":11,"./TextureStore":12,"./Viewer":14,"./assets/DynamicCanvas":16,"./autorotate":20,"./chooseBestStage":22,"./controls/Controls":31,"./controls/Drag":32,"./controls/Keyboard":36,"./controls/PinchZoom":37,"./controls/Qtvr":38,"./controls/ScrollZoom":39,"./controls/registerDefaultControls":41,"./geometries/Cube":44,"./geometries/Equirect":45,"./geometries/Flat":46,"./renderers/CssCube":52,"./renderers/CssFlat":53,"./renderers/FlashCube":55,"./renderers/FlashFlat":56,"./renderers/WebGlCube":59,"./renderers/WebGlEquirect":61,"./renderers/WebGlFlat":63,"./renderers/registerDefaultRenderers":64,"./sources/ImageUrl":71,"./sources/SolidColor":72,"./sources/VideoUrl":74,"./stages/Css":76,"./stages/Flash":77,"./stages/WebGl":80,"./version":111,"./views/Flat":112,"./views/Rectilinear":113}],51:[function(t,e,i){"use strict";function n(t,e){return t.cmp(e)}function r(t,e,i){this._root=t,this._browserQuirks=e;var n=document.createElement("div");t.appendChild(n),n.style.position="absolute",s.setOverflowHidden(n),s.setNoPointerEvents(n),this._browserQuirks.useNullTransform&&s.setNullTransform(n),this.domElement=n,this._oldTileList=[],this._newTileList=[],this._textureMap=new o(i.equals,i.hash)}var o=t("../collections/Map"),s=t("../domUtil"),a="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.css;r.prototype.destroy=function(){this._root.removeChild(this.domElement),this._textureMap=null,this.domElement=null},r.prototype.startLayer=function(t,e){var i=this.domElement;i.style.left=e.left+"px",i.style.top=e.top+"px",i.style.width=e.width+"px",i.style.height=e.height+"px";var n=1,r=t.effects();r&&null!=r.opacity&&(n=r.opacity),i.style.opacity=n,this._newTileList.length=0,this._textureMap.clear()},r.prototype.renderTile=function(t,e){this._newTileList.push(t),this._textureMap.set(t,e)},r.prototype.endLayer=function(t){var e,i,r,o,h,u,l,c,p=this.domElement,f=this._oldTileList,d=this._newTileList,m=this._textureMap,v=t.view();if(p.children.length!==f.length)throw new Error("DOM not in sync with tile list");for(d.sort(n),e=0,r=f[e],l=p.firstChild,i=0;i<d.length;i++){for(o=d[i];e<f.length&&!(r.cmp(o)>=0);)c=l.nextSibling,p.removeChild(l),l=c,r=f[++e];if(h=m.get(o),u=h?h._canvas:null,!u)throw new Error("Rendering tile with missing texture");if(r&&0===r.cmp(o)){if(u!=l)throw new Error("DOM not in sync with tile list");l=l.nextSibling,r=f[++e]}else p.insertBefore(u,l);s.setTransform(u,this.calculateTransform(o,h,v)),a&&u.setAttribute("data-tile",o.str())}for(;l;)c=l.nextSibling,p.removeChild(l),l=c;if(p.children.length!==d.length)throw new Error("DOM not in sync with tile list");var _=this._oldTileList;this._oldTileList=this._newTileList,this._newTileList=_},e.exports=r},{"../collections/Map":25,"../domUtil":43}],52:[function(t,e,i){"use strict";function n(t,e){this.constructor.super_.call(this,t,e,r)}var r=t("../geometries/Cube").TileClass,o=t("./CssBase"),s=t("../util/inherits");s(n,o),n.prototype.calculateTransform=function(t,e,i){var n=this._browserQuirks.padSize,r=this._browserQuirks.reverseLevelDepth,o=this._browserQuirks.perspectiveNudge,s="",a=r?256-t.z:t.levelWidth(),h=i.size(),u=h.width,l=h.height;s+="translate3d("+u/2+"px, "+l/2+"px, 0px) ";var c=.5*l/Math.tan(i.fov()/2),p=c+o;s+="perspective("+c+"px) translateZ("+p+"px) ";var f=-i.pitch(),d=i.yaw();s+="rotateX("+f+"rad) rotateY("+d+"rad) ";var m=-t.rotX(),v=t.rotY();s+="rotateX("+m+"rad) rotateY("+v+"rad) ";var _=t.centerX()-t.scaleX()/2,y=-(t.centerY()+t.scaleY()/2),g=_*a,w=y*a,x=-a/2;if(s+="translate3d("+g+"px, "+w+"px, "+x+"px) ",r){var b=a*t.scaleX()/t.width(),E=a*t.scaleY()/t.height();s+="scale("+b+", "+E+") "}var T=t.padLeft()?n:0,M=t.padTop()?n:0;return(0!==T||0!==M)&&(s+="translate3d("+-T+"px, "+-M+"px, 0) "),s},e.exports=n},{"../geometries/Cube":44,"../util/inherits":99,"./CssBase":51}],53:[function(t,e,i){"use strict";function n(t,e){this.constructor.super_.call(this,t,e,r)}var r=t("../geometries/Flat").TileClass,o=t("./CssBase"),s=t("../util/inherits");s(n,o),n.prototype.calculateTransform=function(t,e,i){var n=this._browserQuirks.padSize,r="",o=i.width(),s=i.height();r+="translateX("+o/2+"px) translateY("+s/2+"px) ";var a=o/i.zoomX(),h=s/i.zoomY(),u=t.centerX()-t.scaleX()/2,l=-t.centerY()-t.scaleY()/2,c=u*a,p=l*h;r+="translateX("+c+"px) translateY("+p+"px) ";var f=-i.x()*a,d=-i.y()*h;r+="translateX("+f+"px) translateY("+d+"px) ";var m=t.padLeft()?n:0,v=t.padTop()?n:0;(0!==m||0!==v)&&(r+="translateX("+-m+"px) translateY("+-v+"px) ");var _=a/t.levelWidth();return r+="scale("+_+") "},e.exports=n},{"../geometries/Flat":46,"../util/inherits":99,"./CssBase":51}],54:[function(t,e,i){"use strict";function n(t,e){return t.cmp(e)}function r(t,e,i,n){this._flashElement=t,this._layerId=e,this._quirks=i,this._tileList=[],this._textureMap=new o(n.equals,n.hash),this._layerCreated=!1}var o=t("../collections/Map");r.prototype.destroy=function(){this._flashElement.destroyLayer(this._layerId),this._flashElement=null,this._layerId=null,this._layerCreated=null,this._tileList=null,this._padSize=null},r.prototype.startLayer=function(t,e){this._flashElement.isReady&&(this._layerCreated||(this._flashElement.createLayer(this._layerId),this._layerCreated=!0),this._tileList.length=0,this._textureMap.clear())},r.prototype.renderTile=function(t,e){this._tileList.push(t),this._textureMap.set(t,e)},r.prototype.endLayer=function(t,e){if(this._flashElement.isReady){var i=this._tileList;i.sort(n),this._renderOnFlash(t,e)}},e.exports=r},{"../collections/Map":25}],55:[function(t,e,i){"use strict";function n(t,e,i){this.constructor.super_.call(this,t,e,i,o),this._flashTileList=[]}var r=t("./FlashBase"),o=t("../geometries/Cube").TileClass,s=t("../util/inherits"),a=t("../util/radToDeg");s(n,r),n.prototype._renderOnFlash=function(t,e){var i=this._flashElement,n=this._layerId,r=this._quirks.padSize,o=this._tileList,s=this._textureMap,h=this._flashTileList;h.length=0;for(var u=0;u<o.length;u++){var l=o[u],c=s.get(l);if(!c)throw new Error("Rendering tile with missing texture");var p=l.padTop()?r:0,f=l.padBottom()?r:0,d=l.padLeft()?r:0,m=l.padRight()?r:0;h.push({textureId:c._textureId,face:l.face,width:l.width(),height:l.height(),centerX:l.centerX(),centerY:l.centerY(),rotX:a(l.rotX()),rotY:a(l.rotY()),levelSize:l.levelWidth(),padTop:p,padBottom:f,padLeft:d,padRight:m})}var v=1,_=t.effects();_&&null!=_.opacity&&(v=_.opacity);var y=t.view(),g=y.yaw(),w=y.pitch(),x=y.fov();i.drawCubeTiles(n,e.width,e.height,e.left,e.top,v,g,w,x,h)},e.exports=n},{"../geometries/Cube":44,"../util/inherits":99,"../util/radToDeg":105,"./FlashBase":54}],56:[function(t,e,i){"use strict";function n(t,e,i){this.constructor.super_.call(this,t,e,i,o),this._flashTileList=[]}var r=t("./FlashBase"),o=t("../geometries/Flat").TileClass,s=t("../util/inherits");s(n,r),n.prototype._renderOnFlash=function(t,e){var i=this._flashElement,n=this._layerId,r=this._quirks.padSize,o=this._tileList,s=this._textureMap,a=this._flashTileList;a.length=0;for(var h=0;h<o.length;h++){var u=o[h],l=s.get(u);if(!l)throw new Error("Rendering tile with missing texture");var c=u.padTop()?r:0,p=u.padBottom()?r:0,f=u.padLeft()?r:0,d=u.padRight()?r:0;a.push({textureId:l._textureId,tileWidth:u.width(),tileHeight:u.height(),levelWidth:u.levelWidth(),levelHeight:u.levelHeight(),x:u.x,y:u.y,padTop:c,padBottom:p,padLeft:f,padRight:d})}var m=1,v=t.effects();v&&null!=v.opacity&&(m=v.opacity);var _=t.view(),y=_.x(),g=_.y(),w=_.zoom();i.drawFlatTiles(n,e.width,e.height,e.left,e.top,m,y,g,w,a)},e.exports=n},{"../geometries/Flat":46,"../util/inherits":99,"./FlashBase":54}],57:[function(t,e,i){"use strict";function n(t){this.gl=t,this.mvMatrix=g.create(),this.translateVector=w.create(),this.scaleVector=w.create(),this.constantBuffers=o(this.gl,d,m,v),this.shaderProgram=a(this.gl,p,f,_,y)}var r=t("./WebGlCommon"),o=r.createConstantBuffers,s=r.destroyConstantBuffers,a=r.createShaderProgram,h=r.destroyShaderProgram,u=r.setViewport,l=r.setDepth,c=r.setTexture,p=t("../shaders/vertexNormal"),f=t("../shaders/fragmentNormal"),d=[0,1,2,0,2,3],m=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],v=[0,0,1,0,1,1,0,1],_=["aVertexPosition","aTextureCoord"],y=["uPMatrix","uMVMatrix","uDepth","uSampler","uOpacity"],g=t("gl-matrix").mat4,w=t("gl-matrix").vec3;n.prototype.destroy=function(){this.mvMatrix=null,this.translateVector=null,this.scaleVector=null,s(this.gl,this.constantBuffers),this.constantBuffers=null,h(this.gl,this.shaderProgram),this.shaderProgram=null,this.gl=null},n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers,o=t.view();u(i,t,e),i.useProgram(n),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,i.FALSE,0,0),i.uniformMatrix4fv(n.uPMatrix,!1,o.projection());var s=1,a=t.effects();a&&null!=a.opacity&&(s=a.opacity),i.uniform1f(n.uOpacity,s)},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n){var r=this.gl,o=this.shaderProgram,s=this.constantBuffers,a=this.mvMatrix,h=this.translateVector,u=this.scaleVector;h[0]=t.centerX(),h[1]=t.centerY(),h[2]=-.5,u[0]=t.scaleX(),u[1]=t.scaleY(),u[2]=1,g.identity(a),g.rotateX(a,a,t.rotX()),g.rotateY(a,a,t.rotY()),g.translate(a,a,h),g.scale(a,a,u),r.uniformMatrix4fv(o.uMVMatrix,!1,a),l(r,o,n,t.z),c(r,o,e),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s.vertexIndices),r.drawElements(r.TRIANGLES,d.length,r.UNSIGNED_SHORT,0)},e.exports=n},{"../shaders/fragmentNormal":68,"../shaders/vertexNormal":70,"./WebGlCommon":58,"gl-matrix":2}],58:[function(t,e,i){"use strict";function n(t,e,i){var n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw t.getShaderInfoLog(n);return n}function r(t,e,i,r,o){var s=n(t,t.VERTEX_SHADER,e),a=n(t,t.FRAGMENT_SHADER,i),h=t.createProgram();if(t.attachShader(h,s),t.attachShader(h,a),t.linkProgram(h),!t.getProgramParameter(h,t.LINK_STATUS))throw t.getProgramInfoLog(h);for(var u=0;u<r.length;u++){var l=r[u];h[l]=t.getAttribLocation(h,l),t.enableVertexAttribArray(h[l])}for(var c=0;c<o.length;c++){var p=o[c];h[p]=t.getUniformLocation(h,p)}return h}function o(t,e){for(var i=t.getAttachedShaders(e),n=0;n<i.length;n++){var r=i[n];t.detachShader(e,r),t.deleteShader(r)}t.deleteProgram(e)}function s(t,e,i,n){var r=t.createBuffer();return t.bindBuffer(e,r),t.bufferData(e,n,i),r}function a(t,e,i,n){return{vertexIndices:s(t,t.ELEMENT_ARRAY_BUFFER,t.STATIC_DRAW,new Uint16Array(e)),vertexPositions:s(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(i)),textureCoords:s(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(n))}}function h(t,e){t.deleteBuffer(e.vertexIndices),t.deleteBuffer(e.vertexPositions),t.deleteBuffer(e.textureCoords)}function u(t,e,i){t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i._texture),t.uniform1i(e.uSampler,0)}function l(t,e,i,n){var r=((i+1)*f-n)/(f*p);t.uniform1f(e.uDepth,r)}function c(t,e,i){var n=d();t.viewport(i.left,i.top,n*i.width,n*i.height)}var p=256,f=256,d=t("../util/pixelRatio");e.exports={createShaderProgram:r,destroyShaderProgram:o,createConstantBuffers:a,destroyConstantBuffers:h,setTexture:u,setDepth:l,setViewport:c}},{"../util/pixelRatio":104}],59:[function(t,e,i){"use strict";var n=t("./WebGlBase");e.exports=n},{"./WebGlBase":57}],60:[function(t,e,i){"use strict";function n(t){this.gl=t,this.viewTransformMatrix=_.create(),this.constantBuffers=s(this.gl,p,f,d),this.shaderProgram=a(this.gl,l,c,m,v)}function r(t,e,i,n,r){r=r||0;var o=((i+1)*g-n)/(g*y);o-=r/1e5,t.uniform1f(e.uDepth,o)}var o=t("./WebGlCommon"),s=o.createConstantBuffers,a=o.createShaderProgram,h=o.setViewport,u=(o.setDepth,o.setTexture),l=t("../shaders/vertexEquirect"),c=t("../shaders/fragmentCubeStereographic"),p=[0,1,2,0,2,3],f=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],d=[0,0,1,0,1,1,0,1],m=["aVertexPosition","aTextureCoord"],v=["viewTransformMatrix","uDepth","uSampler","uOpacity","uWidth","uHeight","fov","stereographicDistance","outerSide","tileFace","tileXMin","tileXMax","tileYMin","tileYMax"],_=t("gl-matrix").mat4;n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers,o=this.viewTransformMatrix,s=t.view();h(i,t,e),i.useProgram(this.shaderProgram),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,i.FALSE,0,0),_.identity(o),_.rotateX(o,o,-s.pitch()),_.rotateY(o,o,-s.yaw()),i.uniformMatrix4fv(n.viewTransformMatrix,!1,o),this.gl.uniform1f(this.shaderProgram.uWidth,s.width()),this.gl.uniform1f(this.shaderProgram.uHeight,s.height()),this.gl.uniform1f(this.shaderProgram.fov,s.fov()),this.gl.uniform1f(this.shaderProgram.stereographicDistance,s.distance()),this.gl.uniform1f(this.shaderProgram.outerSide,s.outerSide());var a=1,u=t.effects();u&&null!=u.opacity&&(a=u.opacity),i.uniform1f(n.uOpacity,a)},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n,o){var s=this.gl,a=this.shaderProgram,h=this.constantBuffers;r(s,a,n,t.z,o),u(s,a,e),this.gl.uniform1i(this.shaderProgram.tileFace,"fblrud".indexOf(t.face));var l=t.x/t.level().numHorizontalTiles(),c=l+1/t.level().numHorizontalTiles(),f=1-t.y/t.level().numVerticalTiles(),d=f-1/t.level().numVerticalTiles();this.gl.uniform1f(this.shaderProgram.tileXMin,l),this.gl.uniform1f(this.shaderProgram.tileXMax,c),this.gl.uniform1f(this.shaderProgram.tileYMin,d),this.gl.uniform1f(this.shaderProgram.tileYMax,f),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,h.vertexIndices),s.drawElements(s.TRIANGLES,p.length,s.UNSIGNED_SHORT,0)};var y=256,g=256;e.exports=n},{"../shaders/fragmentCubeStereographic":65,"../shaders/vertexEquirect":69,"./WebGlCommon":58,"gl-matrix":2}],61:[function(t,e,i){"use strict";function n(t){this.gl=t,this.pMatrix=g.create(),this.constantBuffers=o(this.gl,d,m,v),this.shaderProgram=s(this.gl,p,f,_,y)}var r=t("./WebGlCommon"),o=r.createConstantBuffers,s=r.createShaderProgram,a=r.setViewport,h=r.destroyConstantBuffers,u=r.destroyShaderProgram,l=r.setDepth,c=r.setTexture,p=t("../shaders/vertexEquirect"),f=t("../shaders/fragmentEquirect"),d=[0,1,2,0,2,3],m=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],v=[0,0,1,0,1,1,0,1],_=["aVertexPosition","aTextureCoord"],y=["uPInvMatrix","uDepth","uSampler","uOpacity","uWidth","uHeight"],g=t("gl-matrix").mat4;n.prototype.destroy=function(){this.pMatrix=null,h(this.gl,this.constantBuffers),this.constantBuffers=null,u(this.gl,this.shaderProgram),this.shaderProgram=null,this.gl=null},n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers,o=this.pMatrix,s=t.view();a(i,t,e),i.useProgram(this.shaderProgram),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,i.FALSE,0,0),g.copy(this.pMatrix,s.projection()),g.invert(o,o),i.uniformMatrix4fv(n.uPInvMatrix,!1,o),this.gl.uniform1f(this.shaderProgram.uWidth,e.width),this.gl.uniform1f(this.shaderProgram.uHeight,e.height);var h=1,u=t.effects();u&&null!=u.opacity&&(h=u.opacity),i.uniform1f(n.uOpacity,h)},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n){var r=this.gl,o=this.shaderProgram,s=this.constantBuffers;l(r,o,n,t.z),c(r,o,e),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s.vertexIndices),r.drawElements(r.TRIANGLES,d.length,r.UNSIGNED_SHORT,0)},e.exports=n},{"../shaders/fragmentEquirect":66,"../shaders/vertexEquirect":69,"./WebGlCommon":58,"gl-matrix":2}],62:[function(t,e,i){"use strict";function n(t){this.gl=t,this.viewTransformMatrix=_.create(),this.constantBuffers=o(this.gl,p,f,d),this.shaderProgram=s(this.gl,l,c,m,v)}var r=t("./WebGlCommon"),o=r.createConstantBuffers,s=r.createShaderProgram,a=r.setViewport,h=r.setDepth,u=r.setTexture,l=t("../shaders/vertexEquirect"),c=t("../shaders/fragmentEquirectStereographic"),p=[0,1,2,0,2,3],f=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],d=[0,0,1,0,1,1,0,1],m=["aVertexPosition","aTextureCoord"],v=["viewTransformMatrix","uDepth","uSampler","uOpacity","uWidth","uHeight","fov","stereographicDistance","outerSide"],_=t("gl-matrix").mat4;n.prototype.startLayer=function(t,e){var i=this.gl,n=this.shaderProgram,r=this.constantBuffers,o=this.viewTransformMatrix,s=t.view();a(i,t,e),i.useProgram(this.shaderProgram),i.bindBuffer(i.ARRAY_BUFFER,r.vertexPositions),i.vertexAttribPointer(n.aVertexPosition,3,i.FLOAT,i.FALSE,0,0),i.bindBuffer(i.ARRAY_BUFFER,r.textureCoords),i.vertexAttribPointer(n.aTextureCoord,2,i.FLOAT,i.FALSE,0,0),_.identity(o),_.rotateX(o,o,-s.pitch()),_.rotateY(o,o,-s.yaw()),i.uniformMatrix4fv(n.viewTransformMatrix,!1,o),this.gl.uniform1f(this.shaderProgram.uWidth,s.width()),this.gl.uniform1f(this.shaderProgram.uHeight,s.height()),this.gl.uniform1f(this.shaderProgram.fov,s.fov()),this.gl.uniform1f(this.shaderProgram.stereographicDistance,s.distance()),this.gl.uniform1f(this.shaderProgram.outerSide,s.outerSide());var h=1,u=t.effects();u&&null!=u.opacity&&(h=u.opacity),i.uniform1f(n.uOpacity,h)},n.prototype.endLayer=function(){},n.prototype.renderTile=function(t,e,i,n){var r=this.gl,o=this.shaderProgram,s=this.constantBuffers;h(r,o,n,t.z),u(r,o,e),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s.vertexIndices),r.drawElements(r.TRIANGLES,p.length,r.UNSIGNED_SHORT,0)},e.exports=n},{"../shaders/fragmentEquirectStereographic":67,"../shaders/vertexEquirect":69,"./WebGlCommon":58,"gl-matrix":2}],63:[function(t,e,i){arguments[4][59][0].apply(i,arguments)},{"./WebGlBase":57,dup:59}],64:[function(t,e,i){"use strict";function n(t){switch(t.type){case"webgl":t.registerRenderer("flat","flat",s),t.registerRenderer("cube","rectilinear",r),t.registerRenderer("cube","stereographic",o),t.registerRenderer("equirect","rectilinear",a),t.registerRenderer("equirect","stereographic",h);break;case"css":t.registerRenderer("flat","flat",l),t.registerRenderer("cube","rectilinear",u);break;case"flash":t.registerRenderer("flat","flat",p),t.registerRenderer("cube","rectilinear",c);break;default:throw new Error("Unknown stage type: "+t.type)}}var r=t("./WebGlCube"),o=t("./WebGlCubeStereographic"),s=t("./WebGlFlat"),a=t("./WebGlEquirect"),h=t("./WebGlEquirectStereographic"),u=t("./CssCube"),l=t("./CssFlat"),c=t("./FlashCube"),p=t("./FlashFlat");e.exports=n},{"./CssCube":52,"./CssFlat":53,"./FlashCube":55,"./FlashFlat":56,"./WebGlCube":59,"./WebGlCubeStereographic":60,"./WebGlEquirect":61,"./WebGlEquirectStereographic":62,"./WebGlFlat":63}],65:[function(t,e,i){e.exports="//TODO: support multiresolution\n//share code with fragmentEquirectangularStereographic\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uSampler;\nuniform mat4 viewTransformMatrix;\nuniform float uWidth;\nuniform float uHeight;\nuniform float uOpacity;\n\nuniform float fov;\nuniform float stereographicDistance;\nuniform bool outerSide;\n\n// Face encoding as int:\n// fblrud\n// 012345\nuniform int tileFace;\n// Tile position inside face as [xmin, xmax, ymin, ymax]\nuniform float tileXMin;\nuniform float tileXMax;\nuniform float tileYMin;\nuniform float tileYMax;\n\nvarying vec2 vTextureCoord;\n\nconst float PI = 3.14159265358979323846264;\n\n// Inspired by https://github.com/notlion/streetview-stereographic\n\n\nvec3 intersectWithUnitSphere(vec2 pnt, float s, bool small) {\n  // Formulas from http://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n\n  // s - distance from center (r is stereographic projection, 0 is normal)\n\n  //float r = 1.0;\n  //vec3 c = vec3(0,0,0)\n  vec3 o = vec3(0.0, 0.0, -s);\n\n  //v is a non-unit vector in the same direction as l\n  //v = (x,y,r) - (0, 0, -s)\n  vec3 v = vec3(pnt, 1.0 + s);\n  vec3 l = v / length(v);\n\n  float sqrtComponent = pow(dot(l,o), 2.0) - pow(length(o), 2.0) + 1.0;\n  // if sqrtComponent < 0, there is no intersection\n\n  float d = 0.0;\n  if(small) {\n    d = -dot(l, o) - sqrt(sqrtComponent);\n  }\n  else {\n    d = -dot(l, o) + sqrt(sqrtComponent);\n  }\n\n  return o + l * d;\n}\n\nbool intersectsSphere(vec2 pnt, float s) {\n  //TODO: code duplicated with function above\n  vec3 o = vec3(0.0, 0.0, -s);\n  vec3 v = vec3(pnt, 1.0 + s);\n  vec3 l = v / length(v);\n\n  float sqrtComponent = pow(dot(l,o), 2.0) - pow(length(o), 2.0) + 1.0;\n  return sqrtComponent > 0.0;\n}\n\nbool spherePointInTile(vec3 p) {\n  // Project view ray onto cube, i.e., normalize the coordinate with\n  // largest absolute value to Â±0.5.\n  float maxRayComponent = max(max(abs(p[0]), abs(p[1])), abs(p[2]));\n  float maxVal = maxRayComponent / 0.5;\n  p = p / maxVal;\n\n  // The largest coordinate can be used to check if we are on the correct face\n  bool correctFace = false;\n\n  if(tileFace == 0) {\n    //For the front tile, z should be the maximum value\n    correctFace = p.z > 0.0 && abs(p.z) >= abs(p.x) && abs(p.z) >= abs(p.y) && (0.5 + p.x) >= tileXMin && (0.5 + p.x) <= tileXMax && (0.5 + p.y) >= tileYMin && (0.5 + p.y) <= tileYMax;\n  }\n  else if(tileFace == 1) {\n    correctFace = p.z < 0.0 && abs(p.z) >= abs(p.x) && abs(p.z) >= abs(p.y) && (0.5 - p.x) >= tileXMin && (0.5 - p.x) <= tileXMax && (0.5 + p.y) >= tileYMin && (0.5 + p.y) <= tileYMax;\n  }\n  else if (tileFace == 2) {\n    correctFace = p.x < 0.0 && abs(p.x) >= abs(p.y) && abs(p.x) >= abs(p.z) && (0.5 + p.z) >= tileXMin && (0.5 + p.z) <= tileXMax && (0.5 + p.y) >= tileYMin && (0.5 + p.y) <= tileYMax;\n  }\n  else if (tileFace == 3) {\n    correctFace = p.x > 0.0 && abs(p.x) >= abs(p.y) && abs(p.x) >= abs(p.z) && (0.5 - p.z) >= tileXMin && (0.5 - p.z) <= tileXMax && (0.5 + p.y) >= tileYMin && (0.5 + p.y) <= tileYMax;\n  }\n  else if (tileFace == 4) {\n    correctFace = p.y > 0.0 && abs(p.y) >= abs(p.x) && abs(p.y) >= abs(p.z) && (0.5 + p.x) >= tileXMin && (0.5 + p.x) <= tileXMax && (0.5 - p.z) >= tileYMin && (0.5 - p.z) <= tileYMax;\n  }\n  else if (tileFace == 5) {\n    correctFace = p.y < 0.0 && abs(p.y) >= abs(p.x) && abs(p.y) >= abs(p.z) && (0.5 + p.x) >= tileXMin && (0.5 + p.x) <= tileXMax && (0.5 + p.z) >= tileYMin && (0.5 + p.z) <= tileYMax;\n  }\n\n  return correctFace;\n}\n\nvec2 tileCoordinates(vec3 p) {\n  // Project view ray onto cube, i.e., normalize the coordinate with\n  // largest absolute value to Â±0.5.\n  float maxRayComponent = max(max(abs(p[0]), abs(p[1])), abs(p[2]));\n  float maxVal = maxRayComponent / 0.5;\n  p = p / maxVal;\n\n  float xScale = tileXMax - tileXMin;\n  float yScale = tileYMax - tileYMin;\n\n  if(tileFace == 0) {\n    return vec2( (0.5 + p.x - tileXMin) / xScale, (0.5 + p.y - tileYMin) / yScale);\n  }\n  else if(tileFace == 1) {\n    return vec2( (0.5 - p.x - tileXMin) / xScale, (0.5 + p.y - tileYMin) / yScale);\n  }\n  else if(tileFace == 2) {\n    return vec2( (0.5 + p.z - tileXMin) / xScale, (0.5 + p.y - tileYMin) / yScale);\n  }\n  else if(tileFace == 3) {\n    return vec2( (0.5 - p.z - tileXMin) / xScale, (0.5 + p.y - tileYMin) / yScale);\n  }\n  else if(tileFace == 4) {\n    return vec2( (0.5 + p.x - tileXMin) / xScale, (0.5 - p.z - tileYMin) / yScale);\n  }\n  else if(tileFace == 5) {\n    return vec2( (0.5 + p.x - tileXMin) / xScale, (0.5 + p.z - tileYMin) / yScale);\n  }\n  else {\n    return vec2(-999.0, -999.0);\n  }\n}\n\nvoid main(void) {\n  // x and y value in range [-1, 1]\n  float x = 2.0 * (vTextureCoord.x - 0.5);\n  float y = 2.0 * (vTextureCoord.y - 0.5);\n\n  // range of visible projection plane according to fov\n  float yRange = tan(fov / 2.0);\n  float xRange = yRange * uWidth / uHeight;\n\n  vec2 pnt = vec2(x, y) * vec2(xRange, yRange);\n\n  if(!intersectsSphere(pnt, stereographicDistance)) {\n    // If sphere is not intersected (happens at stereographicDistance > 1), paint black\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  vec3 sphere_pnt = intersectWithUnitSphere(pnt, stereographicDistance, outerSide);\n\n  // Transform the view by multiplying by viewTransformMatrix\n  sphere_pnt = (vec4(sphere_pnt, 0.0) * viewTransformMatrix).xyz;\n\n\n  // Convert to Spherical Coordinates\n  float r = 1.0 / length(sphere_pnt);\n  float phi  = acos(sphere_pnt.y * r);\n  float theta = atan(sphere_pnt.x, -sphere_pnt.z);\n\n  if(!spherePointInTile(sphere_pnt)) {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n\n  vec2 tileCoords = tileCoordinates(sphere_pnt);\n\n  vec4 color = texture2D(uSampler, tileCoords);\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}";

},{}],66:[function(t,e,i){e.exports="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uSampler;\nuniform mat4 uPInvMatrix;\nuniform float uWidth;\nuniform float uHeight;\nuniform float uOpacity;\nvarying vec2 vTextureCoord;\n\nconst float PI = 3.14159265358979323846264;\n\nvoid main(void) {\n  float x = 2.0 * vTextureCoord.x - 1.0;\n  float y = 2.0 * vTextureCoord.y - 1.0;\n  vec4 pos = uPInvMatrix * vec4(x, y, 1.0, 1.0);\n  float r = inversesqrt(pos.x * pos.x + pos.y * pos.y + pos.z * pos.z);\n  float phi  = acos(pos.y * r);\n  float theta = atan(pos.x, -pos.z);\n  float s = 0.5 + 0.5 * theta / PI;\n  float t = 1.0 - phi / PI;\n  vec4 color = texture2D(uSampler, vec2(s, t));\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}\n"},{}],67:[function(t,e,i){e.exports="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nuniform sampler2D uSampler;\nuniform mat4 viewTransformMatrix;\nuniform float uWidth;\nuniform float uHeight;\nuniform float uOpacity;\n\nuniform float fov;\nuniform float stereographicDistance;\nuniform bool outerSide;\n\nvarying vec2 vTextureCoord;\n\nconst float PI = 3.14159265358979323846264;\n\n// Inspired by https://github.com/notlion/streetview-stereographic\n\n\nvec3 intersectWithUnitSphere(vec2 pnt, float s, bool small) {\n  // Formulas from http://en.wikipedia.org/wiki/Line%E2%80%93sphere_intersection\n\n  // s - distance from center (r is stereographic projection, 0 is normal)\n\n  //float r = 1.0;\n  //vec3 c = vec3(0,0,0)\n  vec3 o = vec3(0.0, 0.0, -s);\n\n  //v is a non-unit vector in the same direction as l\n  //v = (x,y,r) - (0, 0, -s)\n  vec3 v = vec3(pnt, 1.0 + s);\n  vec3 l = v / length(v);\n\n  float sqrtComponent = pow(dot(l,o), 2.0) - pow(length(o), 2.0) + 1.0;\n  // if sqrtComponent < 0, there is no intersection\n\n  float d = 0.0;\n  if(small) {\n    d = -dot(l, o) - sqrt(sqrtComponent);\n  }\n  else {\n    d = -dot(l, o) + sqrt(sqrtComponent);\n  }\n\n  return o + l * d;\n}\n\nbool intersectsSphere(vec2 pnt, float s) {\n  //TODO: code duplicated with function above\n  vec3 o = vec3(0.0, 0.0, -s);\n  vec3 v = vec3(pnt, 1.0 + s);\n  vec3 l = v / length(v);\n\n  float sqrtComponent = pow(dot(l,o), 2.0) - pow(length(o), 2.0) + 1.0;\n  return sqrtComponent > 0.0;\n}\n\nvoid main(void) {\n  // x and y value in range [-1, 1]\n  float x = 2.0 * (vTextureCoord.x - 0.5);\n  float y = 2.0 * (vTextureCoord.y - 0.5);\n\n  // range of visible projection plane according to fov\n  float yRange = tan(fov / 2.0);\n  float xRange = yRange * uWidth / uHeight;\n\n  vec2 pnt = vec2(x, y) * vec2(xRange, yRange);\n\n  if(!intersectsSphere(pnt, stereographicDistance)) {\n    // If sphere is not intersected (happens at stereographicDistance > 1), paint black\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  vec3 sphere_pnt = intersectWithUnitSphere(pnt, stereographicDistance, outerSide);\n\n  // Transform the view by multiplying by viewTransformMatrix\n  sphere_pnt = (vec4(sphere_pnt, 0.0) * viewTransformMatrix).xyz;\n\n\n  // Convert to Spherical Coordinates\n  float r = 1.0 / length(sphere_pnt);\n  float phi  = acos(sphere_pnt.y * r);\n  float theta = atan(sphere_pnt.x, -sphere_pnt.z);\n\n  float s = 0.5 + 0.5 * theta / PI;\n  float t = 1.0 - phi / PI;\n\n  // TODO: this looks odd. why can't we use the same formula as on the other equirectangular shader?\n  s = s * -1.0 + 1.0;\n  s += 0.5;\n  if(s > 1.0) { s -= 1.0; }\n\n  vec4 color = texture2D(uSampler, vec2(s, t));\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}"},{}],68:[function(t,e,i){e.exports="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float uOpacity;\n\nvoid main(void) {\n  vec4 color = texture2D(uSampler, vTextureCoord);\n  gl_FragColor = vec4(color.rgb * color.a * uOpacity, color.a * uOpacity);\n}\n"},{}],69:[function(t,e,i){e.exports="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\nuniform float uDepth;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexPosition.xy, uDepth, 1.0);\n  vTextureCoord = aTextureCoord;\n}\n"},{}],70:[function(t,e,i){e.exports="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\nuniform float uDepth;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\n\nvoid main(void) {\n  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);\n  gl_Position.z = uDepth * gl_Position.w;\n  vTextureCoord = aTextureCoord;\n}\n"},{}],71:[function(t,e,i){"use strict";function n(t,e){e=e?e:{},this._loadPool=new s({concurrency:e.concurrency||p}),this._retryDelay=e.retryDelay||f,this._retryMap={},this._sourceFromTile=t}function r(t){var e="\\{("+t+")\\}";return new RegExp(e,"g")}var o=t("../NetworkError"),s=t("../collections/WorkPool"),a=t("../util/chain"),h=t("../util/delay"),u=t("../util/clock"),l={x:"x",y:"y",z:"z",f:"face"},c="bdflru",p=4,f=1e4;n.prototype.loadAsset=function(t,e,i){var n,r=this,s=this._retryDelay,l=this._retryMap,c=this._sourceFromTile(e),p=c.url,f=c.rect,d=t.loadImage.bind(t,p,f),m=function(t){return r._loadPool.push(d,function(i,n){i?(i instanceof o&&(l[p]=u()),t(i,e)):(delete l[p],t(null,e,n))})},v=l[p];if(null!=v){var _=u(),y=_-v;s>y?n=s-y:(n=0,delete l[p])}var g=h.bind(null,n);return a(g,m)(i)},n.fromString=function(t,e){function i(e){var i=t;for(var n in l){var o=r(n),s=e[l[n]];i=i.replace(o,s)}return{url:i}}function o(t){return 0===t.z?s(t):i(t)}function s(t){var i=a.indexOf(t.face)/6;return{url:e.cubeMapPreviewUrl,rect:{x:0,y:i,width:1,height:1/6}}}e=e||{};var a=e&&e.cubeMapPreviewFaceOrder||c,h=e.cubeMapPreviewUrl?o:i;return new n(h)},n.stringHasFace=function(t){return n.stringHasProperty(t,"f")},n.stringHasX=function(t){return n.stringHasProperty(t,"x")},n.stringHasY=function(t){return n.stringHasProperty(t,"y")},n.stringHasLevel=function(t){return n.stringHasProperty(t,"z")},n.stringHasProperty=function(t,e){return!!t.match(r(e))},e.exports=n},{"../NetworkError":9,"../collections/WorkPool":27,"../util/chain":88,"../util/clock":90,"../util/delay":96}],72:[function(t,e,i){"use strict";function n(t,e,i,n,r){i=i||function(t){var e=[];return t.face&&e.push("face:"+t.face),e.push("x:"+t.x),e.push("y:"+t.y),e.push("zoom:"+t.z),e.join(" ")},n=n||function(t){if(t.face){if("u"==t.face)return"#999";if("b"==t.face)return"#aaa";if("d"==t.face)return"#bbb";if("f"==t.face)return"#ccc";if("r"==t.face)return"#ddd";if("l"==t.face)return"#eee"}return"#ddd"},r=r||function(){return"#000"},this._width=t,this._height=e,this._textFromTileFun=i,this._colorFromTileFun=n,this._textColorFromTileFun=r}function r(e,i){if("undefined"!=typeof document){var n=document.createElement("canvas");return n.width=e,n.height=i,n}var r=t,o=r("canvas"),s=new o(e,i);return s}var o=t("../util/defer"),s=t("../assets/StaticCanvas");n.prototype.loadAsset=function(t,e,i){var n=this._width,a=this._height,h=this._textFromTileFun(e),u=this._colorFromTileFun(e),l=this._textColorFromTileFun(e),c=r(n,a),p=c.getContext("2d");p.fillStyle=u,p.fillRect(0,0,n,a),p.fillStyle=l,p.font=n/20+"px Arial",p.textAlign="center",p.fillText(h,n/2,a/2),o(function(){var t=new s(c);i(null,e,t)})},e.exports=n},{"../assets/StaticCanvas":18,"../util/defer":95}],73:[function(t,e,i){"use strict";function n(){this._videos=[],this._lastRemovedVideoState=r}var r={paused:!0,currentTime:0};n.prototype._add=function(t){var e=this._videos.indexOf(t);if(e>=0)throw new Error("VideoMux.add(): videoElement already in list");this._videos.push(t)},n.prototype._remove=function(t){var e=this._videos.indexOf(t);if(-1>e)throw new Error("VideoMux.remove(): videoElement not in list");this._videos.splice(e,1),this._lastRemovedVideoState=this._cloneState(t)},n.prototype.play=function(){this._videos.forEach(function(t){t.play()})},n.prototype.pause=function(){this._videos.forEach(function(t){t.pause()})},n.prototype.paused=function(){if(0===this._videos.length)return this._lastRemovedVideoState.paused;var t=0;return this._videos.forEach(function(e){e.paused&&t++}),t>0},n.prototype.currentTime=function(){if(0===this._videos.length)return this._lastRemovedVideoState.currentTime;var t=0;return this._videos.forEach(function(e){t+=e.currentTime}),t/this._videos.length},n.prototype._cloneState=function(t){return{paused:t.paused,currentTime:t.currentTime}},e.exports=n},{}],74:[function(t,e,i){"use strict";function n(t,e){function i(){n&&r.paintCanvasFallback(),r._videoElement.paused||r.emit("changed"),r._unloaded||requestAnimationFrame(i)}var n=o.msie;n?(this._videoElement=t,this._drawElement=document.createElement("canvas"),this.paintCanvasFallback()):(this._videoElement=t,this._drawElement=t),this.source=e,this._unloaded=!1;var r=this;this._handleTimeUpdate=function(){n&&r.paintCanvasFallback(),r.emit("changed")},this._videoElement.addEventListener("timeupdate",this._handleTimeUpdate),i()}function r(t){this._urlFromTile=t,this._video=new u}var o=t("bowser").browser,s=(t("../util/clock"),t("../util/once")),a=t("./loadVideo"),h=t("../util/eventEmitter"),u=t("./VideoMux");h(n),n.prototype.dynamic=!0,n.prototype.disableMipmapping=!0,n.prototype.paintCanvasFallback=function(){this._drawElement.width=this._videoElement.videoWidth,this._drawElement.height=this._videoElement.videoHeight,this._drawElement.getContext("2d").drawImage(this._videoElement,0,0)},n.prototype.element=function(){return this._drawElement},n.prototype.videoElement=function(){return this._videoElement},n.prototype.timestamp=function(){return this._videoElement.currentTime},n.prototype.destroy=function(){this._unloaded=!0,this._videoElement.removeEventListener("timeupdate",this._handleProgress),this._videoElement.pause(),this._videoElement.volume=0,this._videoElement.removeAttribute("src"),this.source.destroyAsset(this)},n.prototype.width=function(){return this._videoElement.videoWidth},n.prototype.height=function(){return this._videoElement.videoHeight},r.prototype.video=function(){return this._video},r.prototype.loadAsset=function(t,e,i){function r(){h.removeAttribute("src"),i.apply(null,arguments)}i=s(i);var o=this,h=document.createElement("video"),u=this._urlFromTile(e,h);return h.style.position="absolute",h.style.display="none",a(h,u,this.video(),function(t){if(t)i(t);else{var r=new n(h,o);o.video()._add(h),i(null,e,r)}}),r},r.prototype.destroyAsset=function(t){var e=t.videoElement();this._video._remove(e)},e.exports=r},{"../util/clock":90,"../util/eventEmitter":97,"../util/once":103,"./VideoMux":73,"./loadVideo":75,bowser:1}],75:[function(t,e,i){"use strict";function n(t,e,i,n){t.controls=!0,t.crossOrigin="anonymous";var o=5e3;t.src=e,r(t,t.HAVE_CURRENT_DATA,.2,function(){i.paused()?t.currentTime=i.currentTime():t.currentTime=i.currentTime()+o/1e3,r(t,t.HAVE_ENOUGH_DATA,.2,function(){i.paused()?(t.currentTime=i.currentTime(),n(null,t)):t.currentTime<=i.currentTime()?(t.play(),n(null,t)):setTimeout(function(){t.play(),n(null,t)},1e3*(t.currentTime-i.currentTime()))})})}function r(t,e,i,n){var r=setInterval(function(){t.readyState>=e&&(clearInterval(r),n(null,!0))},i)}t("../util/clock");e.exports=n},{"../util/clock":90}],76:[function(t,e,i){"use strict";function n(t){this.constructor.super_.call(this,t),this._domElement=document.createElement("div"),h.setAbsolute(this._domElement),h.setFullSize(this._domElement)}function r(t,e,i){var n=document.createElement("canvas");h.setAbsolute(n),h.setNullTransformOrigin(n),this._canvas=n,this._timestamp=null,this.refresh(e,i)}var o=t("./Stage"),s=t("../support/Css"),a=t("../util/inherits"),h=t("../domUtil"),u=t("bowser").browser,l=t("./loadImageHtml"),c={padSize:u.ios?0:3,reverseLevelDepth:u.ios,useNullTransform:u.ios,perspectiveNudge:u.webkit||u.gecko?.001:0};a(n,o),n.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement=null},n.supported=function(){return s()},n.prototype._updateSize=function(){var t=this._domElement,e=this._width,i=this._height;h.setPixelSize(t,e,i)},n.prototype.loadImage=l,n.prototype._validateLayer=function(t){},n.prototype.createRenderer=function(t){return new t(this._domElement,c)},n.prototype.destroyRenderer=function(t){t.destroy()},n.prototype.startFrame=function(){},n.prototype.endFrame=function(){},n.type=n.prototype.type="css",r.prototype.refresh=function(t,e){var i=e.timestamp();if(i!==this._timestamp){this._timestamp=i;var n=this._canvas,r=n.getContext("2d"),o=e.element(),s=t.width(),a=t.height(),h=c.padSize,u=t.padTop()?h:0,l=t.padBottom()?h:0,p=t.padLeft()?h:0,f=t.padRight()?h:0;n.width=p+s+f,n.height=u+a+l,r.drawImage(o,p,u,s,a);var d;for(d=0;u>d;d++)r.drawImage(n,p,u,s,1,p,d,s,1);for(d=0;p>d;d++)r.drawImage(n,p,u,1,a,d,u,1,a);for(d=0;l>d;d++)r.drawImage(n,p,u+a-1,s,1,p,u+a+d,s,1);for(d=0;f>d;d++)r.drawImage(n,p+s-1,u,1,a,p+s+d,u,1,a)}},r.prototype.destroy=function(){this._canvas=null,this._timestamp=null},n.TextureClass=n.prototype.TextureClass=r,e.exports=n},{"../domUtil":43,"../support/Css":83,"../util/inherits":99,"./Stage":79,"./loadImageHtml":82,bowser:1}],77:[function(t,e,i){"use strict";function n(t){this.constructor.super_.call(this,t),this._wmode=t&&t.wmode||d,this._swfPath=t&&t.swfPath||f,this._flashStageId=++_,this._callbacksObj=window[m][this._flashStageId]={},this._stageCallbacksObjVarName=m+"["+this._flashStageId+"]",this._callbackListeners={};for(var e=0;e<v.length;e++)this._callbacksObj[v[e]]=this._callListeners(v[e]);this._loadImageQueue=new h,this._loadImageQueue.pause(),this._flashReady=!1,this._nextLayerId=0;var i=r(this._swfPath,this._flashStageId,this._stageCallbacksObjVarName);this._domElement=i.root,this._blockingElement=i.blocking,this._flashElement=i.flash,this._checkReadyTimer=setInterval(this._checkReady.bind(this),50)}function r(t,e,i){var n=document.createElement("div");c.setAbsolute(n),c.setFullSize(n);var r="marzipano-flash-stage-"+e,o='<object id="'+r+'" name="'+r+'" type="application/x-shockwave-flash" data="'+t+'">',s="";s+='<param name="movie" value="'+t+'" />',s+='<param name="allowscriptaccess" value="always" />',s+='<param name="flashvars" value="callbacksObjName='+i+'" />',s+='<param name="wmode" value="transparent" />',o+=s,o+="</object>";var a=document.createElement("div");a.innerHTML=o;var h=a.firstChild;c.setAbsolute(h),c.setFullSize(h),n.appendChild(h);var u=document.createElement("div");return c.setAbsolute(u),c.setFullSize(u),c.setBlocking(u),n.appendChild(u),{root:n,flash:h,blocking:u}}function o(t,e,i){var n=i.element(),r=e.width(),o=e.height(),s=y.padSize,a=e.padTop()?s:0,h=e.padBottom()?s:0,u=e.padLeft()?s:0,l=e.padRight()?s:0,c=t._flashElement.createTexture(n,r,o,a,h,u,l);this._stage=t,this._textureId=c}var s=t("./Stage"),a=t("../support/Flash"),h=t("../collections/WorkQueue"),u=t("../util/inherits"),l=t("../util/defer"),c=t("../domUtil"),p=t("./loadImageFlash"),f="marzipano.swf",d="transparent",m="MarzipanoFlashCallbacks",v=["imageLoaded"];window[m]={};var _=0,y={padSize:3};u(n,s),n.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement=null,this._blockingElement=null,this._flashElement=null,window[m][this._flashStageId]=null,this._callbacksObj=null,this._loadImageQueue=null,clearInterval(this._checkReadyTimer)},n.supported=function(){return a()},n.prototype._updateSize=function(){var t=this._domElement,e=this._width,i=this._height;c.setPixelSize(t,e,i)},n.prototype.loadImage=function(t,e,i){var n=p.bind(null,this,t,e);return this._loadImageQueue.push(n,i)},n.prototype._validateLayer=function(t){},n.prototype._onCallback=function(t,e){this._callbackListeners[t]=this._callbackListeners[t]||[],this._callbackListeners[t].push(e)},n.prototype._offCallback=function(t,e){var i=this._callbackListeners[t]||[],n=i.indexOf(e);n>=0&&i.splice(n,1)},n.prototype._callListeners=function(t){var e=this;return function(){for(var i=e._callbackListeners[t]||[],n=0;n<i.length;n++){var r=i[n];l(r,arguments)}}},n.prototype._checkReady=function(){return this._flashElement.isReady?(this._flashReady=!0,clearTimeout(this._checkReadyTimer),this._loadImageQueue.resume(),this.emitRenderInvalid(),!0):!1},n.prototype.createRenderer=function(t){return new t(this._flashElement,++this._nextLayerId,y)},n.prototype.destroyRenderer=function(t){t.destroy()},n.prototype.startFrame=function(){},n.prototype.endFrame=function(){},n.type=n.prototype.type="flash",o.prototype.refresh=function(t,e){},o.prototype.destroy=function(){var t=this._textureId,e=this._stage;e._flashElement.destroyTexture(t),this._stage=null,this._textureId=null},n.TextureClass=n.prototype.TextureClass=o,e.exports=n},{"../collections/WorkQueue":28,"../domUtil":43,"../support/Flash":84,"../util/defer":95,"../util/inherits":99,"./Stage":79,"./loadImageFlash":81}],78:[function(t,e,i){"use strict";function n(){this._renderers={}}n.prototype.set=function(t,e,i){this._renderers[t]||(this._renderers[t]={}),this._renderers[t][e]=i},n.prototype.get=function(t,e){var i=this._renderers[t]&&this._renderers[t][e];return i||null},e.exports=n},{}],79:[function(t,e,i){"use strict";function n(t,e){return-t.cmp(e)}function r(t){this._domElement=null,this._layers=[],this._renderers=[],this._visibleTiles=[],this._fallbackTiles={children:[],parents:[]},this._tmpTiles=[],this._width=null,this._height=null,this._rect={},this._createTextureWorkQueue=new s({delay:c}),this.emitRenderInvalid=this.emitRenderInvalid.bind(this),this._rendererRegistry=new l}var o=t("../util/eventEmitter"),s=t("../collections/WorkQueue"),a=t("../calcRect"),h=t("../util/async"),u=t("../util/cancelize"),l=t("./RendererRegistry"),c=20;o(r),r.prototype.destroy=function(){this.removeAllLayers(),this._layers=null,this._renderers=null,this._visibleTiles=null,this._fallbackTiles=null,this._tmpTiles=null,this._width=null,this._height=null,this._createTextureWorkQueue=null,this.emitRenderInvalid=null,this._rendererRegistry=null},r.prototype.registerRenderer=function(t,e,i){return this._rendererRegistry.set(t,e,i)},r.prototype.domElement=function(){return this._domElement},r.prototype.size=function(t){return t=t||{},t.width=this._width,t.height=this._height,t},r.prototype.updateSize=function(){this._width=this._domElement.parentElement.clientWidth,this._height=this._domElement.parentElement.clientHeight,this._updateSize(),this.emit("resize"),this.emitRenderInvalid()},r.prototype.emitRenderInvalid=function(){this.emit("renderInvalid")},r.prototype.addLayer=function(t){if(this._layers.indexOf(t)>=0)throw new Error("Layer already in stage");this._validateLayer(t),this._layers.push(t),this._renderers.push(null),t.addEventListener("viewChange",this.emitRenderInvalid),t.addEventListener("effectsChange",this.emitRenderInvalid),t.addEventListener("fixedLevelChange",this.emitRenderInvalid),t.addEventListener("textureStoreChange",this.emitRenderInvalid),this.emitRenderInvalid()},r.prototype.removeLayer=function(t){var e=this._layers.indexOf(t);if(0>e)throw new Error("No such layer in stage");var i=this._layers.splice(e,1)[0],n=this._renderers.splice(e,1)[0];n&&this.destroyRenderer(n),i.removeEventListener("viewChange",this.emitRenderInvalid),i.removeEventListener("effectsChange",this.emitRenderInvalid),i.removeEventListener("fixedLevelChange",this.emitRenderInvalid),i.removeEventListener("textureStoreChange",this.emitRenderInvalid),this.emitRenderInvalid()},r.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},r.prototype.listLayers=function(){return[].concat(this._layers)},r.prototype.hasLayer=function(t){return this._layers.indexOf(t)>=0},r.prototype.moveLayerToIndex=function(t,e){var i=this._layers.indexOf(t);if(0>i)throw new Error("No such layer in stage");var t=this._layers.splice(i,1)[0],n=this._renderers.splice(i,1)[0];this._layers.splice(e,0,t),this._renderers.splice(e,0,n),this.emitRenderInvalid()},r.prototype.render=function(){var t,e=this._visibleTiles,i=this._fallbackTiles,r=this._width,o=this._height,s=this._rect;if(!(0>=r||0>=o)){for(this.startFrame(),t=0;t<this._layers.length;t++)this._layers[t].textureStore().startFrame();for(t=0;t<this._layers.length;t++){var h=this._layers[t],u=h.effects(),l=h.view(),c=this._updateRenderer(t),p=this._layers.length-t,f=h.textureStore();a(r,o,u&&u.rect,s),l.setSize(s),e.length=0,h.visibleTiles(e),c.startLayer(h,s),i.children.length=0,i.parents.length=0,this._renderTiles(e,f,c,h,p,!0),this._renderTiles(i.children,f,c,h,p,!1),i.parents.sort(n),this._renderTiles(i.parents,f,c,h,p,!1),c.endLayer(h,s)}for(t=0;t<this._layers.length;t++)this._layers[t].textureStore().endFrame();this.endFrame()}},r.prototype._updateRenderer=function(t){var e=this._layers[t],i=this.type,n=e.geometry().type,r=e.view().type,o=this._rendererRegistry.get(n,r);if(!o)throw new Error("No "+i+" renderer avaiable for "+n+" geometry and "+r+" view");var s=this._renderers[t];return s?s instanceof o||(this._renderers[t]=this.createRenderer(o),this.destroyRenderer(s)):this._renderers[t]=this.createRenderer(o),this._renderers[t]},r.prototype._renderTiles=function(t,e,i,n,r,o){for(var s=0;s<t.length;s++){var a=t[s];e.texture(a)?i.renderTile(a,e.texture(a),n,r,s):o&&this._fallback(a,e),e.markTile(a)}},r.prototype._fallback=function(t,e){return this._childrenFallback(t,e)||this._parentFallback(t,e)},r.prototype._parentFallback=function(t,e){for(var i=this._fallbackTiles.parents;null!=(t=t.parent());)if(t&&e.texture(t)){for(var n=0;n<i.length;n++)if(t.equals(i[n]))return!0;return i.push(t),!0}return!1},r.prototype._childrenFallback=function(t,e){var i=this._fallbackTiles.children,n=this._tmpTiles;if(n.length=0,!t.children(n))return!1;if(1===n.length&&!e.texture(n[0]))return this._childrenFallback(n[0],e,i);for(var r=!1,o=0;o<n.length;o++)e.texture(n[o])?i.push(n[o]):r=!0;return!r},r.prototype.createTexture=function(t,e,i){function n(){return new r.TextureClass(r,t,e)}var r=this,o=u(h(n));return this._createTextureWorkQueue.push(o,function(n,r){i(n,t,e,r)})},e.exports=r},{"../calcRect":21,"../collections/WorkQueue":28,"../util/async":86,"../util/cancelize":87,"../util/eventEmitter":97,"./RendererRegistry":78}],80:[function(t,e,i){"use strict";function n(t,e){var i={alpha:!0,preserveDrawingBuffer:e&&e.preserveDrawingBuffer};v&&"undefined"!=typeof WebGLDebugUtils&&(console.log("Using WebGL lost context simulator"),t=WebGLDebugUtils.makeLostContextSimulatingCanvas(t));var n=t.getContext&&(t.getContext("webgl",i)||t.getContext("experimental-webgl",i));if(!n)throw new Error("Could not get WebGL context");return v&&"undefined"!=typeof WebGLDebugUtils&&(n=WebGLDebugUtils.makeDebugContext(n),console.log("Using WebGL debug context")),n}function r(t){function e(t,e){return t===e}function i(t){return d(t.toString())}var r=this;this.constructor.super_.call(this,t),this._domElement=document.createElement("canvas"),u.setAbsolute(this._domElement),u.setFullSize(this._domElement),this._gl=n(this._domElement,t),this._handleContextLoss=function(){r.emit("webglcontextlost"),r._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=new h(e,i)}function o(t,e,i){this._stage=t,this._gl=t._gl,this._texture=t._gl.createTexture(),this._timestamp=null,this.refresh(e,i)}var s=t("./Stage"),a=t("../support/WebGl"),h=t("../collections/Map"),u=t("../domUtil"),l=t("./loadImageHtml"),c=t("../util/inherits"),p=t("../util/defer"),f=t("../util/pixelRatio"),d=t("../util/hash"),m=t("../util/ispot"),v="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.webGl;c(r,s),r.prototype.destroy=function(){this.constructor.super_.prototype.destroy.call(this),this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this._domElement=null,this._rendererInstances=null,this._gl=null},r.supported=function(){return a()},r.prototype._updateSize=function(){var t=this._domElement,e=this._width,i=this._height,n=f();this._domElement.width=n*e,this._domElement.height=n*i,p(u.setPixelSize.bind(null,t,e,i))},r.prototype.loadImage=l,r.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},r.prototype._validateLayer=function(t){var e=t.geometry().maxTileSize(),i=this.maxTextureSize();if(e>i)throw new Error("Layer has level with tile size larger than maximum texture size ("+e+" vs. "+i+")")},r.prototype.createRenderer=function(t){if(this._rendererInstances.has(t))return this._rendererInstances.get(t);var e=new t(this._gl);return this._rendererInstances.set(t,e),e},r.prototype.destroyRenderer=function(t){this._renderers.indexOf(t)<0&&(t.destroy(),this._rendererInstances.del(t.constructor))},r.prototype.startFrame=function(){var t=this._gl;if(!t)throw new Error("Bad WebGL context - maybe context was lost?");var e=this._width,i=this._height,n=f();t.viewport(0,0,n*e,n*i),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},r.prototype.endFrame=function(){},r.type=r.prototype.type="webgl",o.prototype.refresh=function(t,e){var i=e.timestamp();if(i!==this._timestamp){this._timestamp=i;var n=this._stage,r=this._texture,o=e.element(),s=e.width(),a=e.height(),h=t.width(),u=t.height(),l=n.maxTextureSize();if(h>l||u>l){var c=Math.min(h,u);throw new Error("Texture larger than max size ("+c+" vs. "+l+")")}if(h!==s||u!==a){var p=document.createElement("canvas");p.width=h,p.height=u;var f=p.getContext("2d");f.drawImage(o,0,0,h,u),o=p}var d=this._gl;d.bindTexture(d.TEXTURE_2D,r),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,o);var v=m(h)&&m(u)&&!t.disableMipmapping&&!e.disableMipmapping;v?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR),d.generateMipmap(d.TEXTURE_2D)):(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR)),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.bindTexture(d.TEXTURE_2D,null)}},o.prototype.destroy=function(){var t=this._texture,e=this._gl;e.deleteTexture(t),this._stage=null,this._gl=null,this._texture=null,this._timestamp=null},r.TextureClass=r.prototype.TextureClass=o,e.exports=r},{"../collections/Map":25,"../domUtil":43,"../support/WebGl":85,"../util/defer":95,"../util/hash":98,"../util/inherits":99,"../util/ispot":100,"../util/pixelRatio":104,"./Stage":79,"./loadImageHtml":82}],81:[function(t,e,i){"use strict";function n(t,e,i,n){function a(i,o){o===d&&(t._offCallback("imageLoaded",a),i?n(new r("Network error: "+e)):n(null,new s(u,d)))}function h(){u.cancelImage(d),t._offCallback("imageLoaded",a),n.apply(null,arguments)}var u=t._flashElement,l=i&&i.x||0,c=i&&i.y||0,p=i&&i.width||1,f=i&&i.height||1,d=u.loadImage(e,p,f,l,c);return n=o(n),t._onCallback("imageLoaded",a),h}var r=t("../NetworkError"),o=t("../util/once"),s=t("../assets/FlashImage");e.exports=n},{"../NetworkError":9,"../assets/FlashImage":17,"../util/once":103}],82:[function(t,e,i){"use strict";function n(t,e,i){function n(){h.onload=h.onerror=null,h.src="",i.apply(null,arguments)}var h=new Image,u=e&&e.x||0,l=e&&e.y||0,c=e&&e.width||1,p=e&&e.height||1;return i=o(i),h.onload=function(){if(0===u&&0===l&&1===c&&1===p)i(null,new s(h));else{u*=h.naturalWidth,l*=h.naturalHeight,c*=h.naturalWidth,p*=h.naturalHeight;var t=document.createElement("canvas");t.width=c,t.height=p;var e=t.getContext("2d");e.drawImage(h,u,l,c,p,0,0,c,p),i(null,new a(t))}},h.onerror=function(){i(new r("Network error: "+t))},h.src=t,n}var r=t("../NetworkError"),o=t("../util/once"),s=t("../assets/StaticImage"),a=t("../assets/StaticCanvas");e.exports=n},{"../NetworkError":9,"../assets/StaticCanvas":18,"../assets/StaticImage":19,"../util/once":103}],83:[function(t,e,i){"use strict";function n(){var t=s("perspective"),e=document.createElement("div"),i="undefined"!=typeof e.style[t];if(i&&"WebkitPerspective"===t){var n="__testCssSupport__",r=document.createElement("style");r.textContent="@media(-webkit-transform-3d){#"+n+"{height: 3px;})",document.getElementsByTagName("head")[0].appendChild(r),e.id=n,document.body.appendChild(e),i=3===e.offsetHeight,r.parentNode.removeChild(r),e.parentNode.removeChild(e)}return i}function r(){return void 0!==o?o:o=n()}var o,s=t("../domUtil").prefixProperty;e.exports=r},{"../domUtil":43}],84:[function(t,e,i){"use strict";function n(){var t=null,e=navigator.plugins,i=navigator.mimeTypes,n=null;if(e&&e["Shockwave Flash"]&&i&&i["application/x-shockwave-flash"]&&i["application/x-shockwave-flash"].enabledPlugin)n=e["Shockwave Flash"].description,n=n.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),t=[0,0,0],t[0]=parseInt(n.replace(/^(.*)\..*$/,"$1"),10),t[1]=parseInt(n.replace(/^.*\.(.*)\s.*$/,"$1"),10),t[2]=/[a-zA-Z]/.test(n)?parseInt(n.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;else if(window.ActiveXObject)try{var r=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");r&&(n=r.GetVariable("$version"))&&(n=n.split(" ")[1].split(","),t=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)])}catch(o){}return t}function r(){var t=n();return t&&t[0]>=11||10===t[0]&&t[1]>=1}function o(){return void 0!==s?s:s=r()}var s;e.exports=o},{}],85:[function(t,e,i){"use strict";function n(){var t=document.createElement("canvas"),e=t.getContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"));return!!e}function r(){return void 0!==o?o:o=n()}var o;e.exports=r},{}],86:[function(t,e,i){"use strict";function n(t){return function(e){var i,n;try{n=t()}catch(r){i=r}finally{e(i||null,i?null:n)}}}e.exports=n},{}],87:[function(t,e,i){"use strict";function n(t){return function(){function e(){n.apply(null,arguments)}if(!arguments.length)throw new Error("cancelized: expected at least one argument");var i=Array.prototype.slice.call(arguments,0),n=i[i.length-1]=r(i[i.length-1]);return t.apply(null,i),e}}var r=t("./once");e.exports=n},{"./once":103}],88:[function(t,e,i){"use strict";function n(){var t=Array.prototype.slice.call(arguments,0);return function(){function e(){var t=arguments[0];if(t)return o=s=null,void h.apply(null,arguments);if(!n.length)return o=s=null,void h.apply(null,arguments);o=n.shift();var i=o,r=Array.prototype.slice.call(arguments,1);r.push(e);var a=o.apply(null,r);if(i===o){if("function"!=typeof a)throw new Error("chain: chaining on non-cancellable function");s=a}}function i(){s&&s.apply(null,arguments)}var n=t.slice(0),o=null,s=null,a=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],h=arguments.length?arguments[arguments.length-1]:r;return a.unshift(null),e.apply(null,a),i}}var r=t("./noop");e.exports=n},{"./noop":102}],89:[function(t,e,i){"use strict";function n(t,e,i){return Math.min(Math.max(t,e),i)}e.exports=n},{}],90:[function(t,e,i){"use strict";function n(){return window.performance&&window.performance.now?function(){return window.performance.now()}:null}function r(){return function(){return Date.now()}}var o=n()||r();e.exports=o},{}],91:[function(t,e,i){"use strict";function n(t,e){return e>t?-1:t>e?1:0}e.exports=n},{}],92:[function(t,e,i){"use strict";function n(){var t=arguments;return function(e){for(var i=e,n=0;n<t.length;n++){var r=t[n];i=r.call(null,i)}return i}}e.exports=n},{}],93:[function(t,e,i){"use strict";function n(t,e,i){return 2*Math.atan(e*Math.tan(t/2)/i)}function r(t,e,i){return n(t,e,i)}function o(t,e,i){return n(t,e,Math.sqrt(e*e+i*i))}function s(t,e,i){return n(t,i,e)}function a(t,e,i){return n(t,i,Math.sqrt(e*e+i*i))}function h(t,e,i){return n(t,Math.sqrt(e*e+i*i),e)}function u(t,e,i){return n(t,Math.sqrt(e*e+i*i),i)}e.exports={convert:n,htov:r,htod:o,vtoh:s,vtod:a,dtoh:h,dtov:u}},{}],94:[function(t,e,i){"use strict";function n(t,e){for(var i in e)i in t||(t[i]=e[i]);return t}e.exports=n},{}],95:[function(t,e,i){"use strict";function n(t,e){function i(){
e&&e.length>0?t.apply(null,e):t()}setTimeout(i,0)}e.exports=n},{}],96:[function(t,e,i){"use strict";function n(t,e){function i(){null!=r&&(r=null,e(null))}function n(){null!=r&&(clearTimeout(r),r=null,e.apply(null,arguments))}var r=null;return r=setTimeout(i,t),n}e.exports=n},{}],97:[function(t,e,i){"use strict";function n(){}function r(t){for(var e=Object.keys(n.prototype),i=0;i<e.length;i++){var r=e[i];t.prototype[r]=n.prototype[r]}}n.prototype.addEventListener=function(t,e){var i=this.__events=this.__events||{},n=i[t]=i[t]||[];n.push(e)},n.prototype.removeEventListener=function(t,e){var i=this.__events=this.__events||{},n=i[t];if(n){var r=n.indexOf(e);r>=0&&n.splice(r,1)}},n.prototype.emit=function(t,e,i,n,r,o){var s=this.__events=this.__events||{},a=s[t];if(a)for(var h=0;h<a.length;h++){var u=a[h];u.call(this,e,i,n,r,o)}},e.exports=r},{}],98:[function(t,e,i){"use strict";function n(){for(var t=0,e=0;e<arguments.length;e++){var i=arguments[e];t+=i,t+=i<<10,t^=i>>6}return t+=t<<3,t^=t>>11,t+=t<<15,t>=0?t:-t}e.exports=n},{}],99:[function(t,e,i){"use strict";function n(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}e.exports=n},{}],100:[function(t,e,i){"use strict";function n(t){return 0===(t&t-1)}e.exports=n},{}],101:[function(t,e,i){"use strict";function n(t,e){return(+t%(e=+e)+e)%e}e.exports=n},{}],102:[function(t,e,i){"use strict";function n(){}e.exports=n},{}],103:[function(t,e,i){"use strict";function n(t){var e,i=!1;return function(){return i||(i=!0,e=t.apply(null,arguments)),e}}e.exports=n},{}],104:[function(t,e,i){"use strict";function n(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;if(window.screen&&window.screen.deviceXDPI&&window.screen.logicalXDPI)return window.screen.deviceXDPI/window.screen.logicalXDPI;if(window.screen&&window.screen.systemXDPI&&window.screen.logicalXDPI)return window.screen.systemXDPI/window.screen.logicalXDPI}return r}var r=1;e.exports=n},{}],105:[function(t,e,i){"use strict";function n(t){return 180*t/Math.PI}e.exports=n},{}],106:[function(t,e,i){"use strict";function n(t){return"number"==typeof t&&isFinite(t)}e.exports=n},{}],107:[function(t,e,i){"use strict";function n(t){return function(){function e(){var e=arguments[0];!e||s?n.apply(null,arguments):o=t.apply(null,i)}var i=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],n=arguments.length?arguments[arguments.length-1]:r,o=null,s=!1;return i.push(e),e(!0),function(){s=!0,o.apply(null,arguments)}}}var r=t("./noop");e.exports=n},{"./noop":102}],108:[function(t,e,i){"use strict";function n(t,e,i,n,h){return r.copy(a,s),i&&r.rotateZ(a,a,i),n&&r.rotateY(a,a,n),h&&r.rotateX(a,a,h),o.transformMat4(t,e,a),t}var r=t("gl-matrix").mat4,o=t("gl-matrix").vec3,s=r.identity(r.create()),a=r.create();e.exports=n},{"gl-matrix":2}],109:[function(t,e,i){"use strict";function n(){a.update(),h=a.getAll().length>0?requestAnimationFrame(n):null}function r(){null==h&&(h=requestAnimationFrame(n))}function o(t,e,i,n,o,h,u){n=n?n:s,o=o?o:s,h=h?h:s,u=u?u:s;var l=new a.Tween(t).to(e,i).easing(a.Easing.Quadratic.InOut).onStart(function(){n(this)}).onUpdate(function(){o(this)}).onComplete(function(){h(this)}).onStop(function(){u(this)}).start();return r(),l}var s=t("./noop"),a=t("tween.js"),h=null;e.exports=o},{"./noop":102,"tween.js":4}],110:[function(t,e,i){"use strict";function n(t){var e=typeof t;if("object"===e){if(null===t)return"null";if("[object Array]"===Object.prototype.toString.call(t))return"array";if("[object RegExp]"===Object.prototype.toString.call(t))return"regexp"}return e}e.exports=n},{}],111:[function(t,e,i){e.exports="0.1.1"},{}],112:[function(t,e,i){"use strict";function n(t,e){this._x=t&&null!=t.x?t.x:u,this._y=t&&null!=t.y?t.y:l,this._zoom=t&&null!=t.zoom?t.zoom:c,this._mediaAspectRatio=t&&null!=t.mediaAspectRatio?t.mediaAspectRatio:p,this._width=t&&null!=t.width?t.width:0,this._height=t&&null!=t.height?t.height:0,this._limiter=e||null,this._frustum=[0,0,0,0],this._projectionMatrix=s.create(),this._projectionChanged=!0,this._params={},this._update()}var r=t("../util/pixelRatio"),o=t("../util/eventEmitter"),s=t("gl-matrix").mat4,a=t("../util/real"),h=t("../util/clamp"),u=.5,l=.5,c=1,p=1,f=[1,0,1,0],d=[-1,-1,1,1],m=1e-4;o(n),n.prototype.destroy=function(){},n.prototype.x=function(){return this._x},n.prototype.y=function(){return this._y},n.prototype.width=function(){return this._width},n.prototype.height=function(){return this._height},n.prototype.zoom=function(){return this._zoom},n.prototype.zoomX=function(){return this._zoom},n.prototype.zoomY=function(){if(this._width<=0||this._height<=0)return 1;var t=this._width/this._height;return this._zoom*this._mediaAspectRatio/t},n.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},n.prototype.size=function(t){return t||(t={}),t.width=this._width,t.height=this._height,t},n.prototype.parameters=function(t){return t||(t={}),t.x=this._x,t.y=this._y,t.zoom=this._zoom,t.mediaAspectRatio=this._mediaAspectRatio,t},n.prototype.setX=function(t){this._resetParams(),this._params.x=t,this._update(this._params)},n.prototype.setY=function(t){this._resetParams(),this._params.y=t,this._update(this._params)},n.prototype.setZoom=function(t){this._resetParams(),this._params.zoom=t,this._update(this._params)},n.prototype.offsetX=function(t){this.setX(this._x+t)},n.prototype.offsetY=function(t){this.setY(this._y+t)},n.prototype.offsetZoom=function(t){this.setZoom(this._zoom+t)},n.prototype.setMediaAspectRatio=function(t){this._resetParams(),this._params.mediaAspectRatio=t,this._update(this._params)},n.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},n.prototype.setParameters=function(t){this._resetParams();var e=this._params;e.x=t.x,e.y=t.y,e.zoom=t.zoom,e.mediaAspectRatio=t.mediaAspectRatio,this._update(e)},n.prototype._resetParams=function(){var t=this._params;t.x=null,t.y=null,t.zoom=null,t.mediaAspectRatio=null,t.width=null,t.height=null},n.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._x,i=this._y,n=this._zoom,r=this._mediaAspectRatio,o=this._width,s=this._height;if(t.x=null!=t.x?t.x:e,t.y=null!=t.y?t.y:i,t.zoom=null!=t.zoom?t.zoom:n,t.mediaAspectRatio=null!=t.mediaAspectRatio?t.mediaAspectRatio:r,t.width=null!=t.width?t.width:o,t.height=null!=t.height?t.height:s,this._limiter&&(t=this._limiter(t),!t))throw new Error("Bad view limiter");var u=t.x,l=t.y,c=t.zoom,p=t.mediaAspectRatio,f=t.width,d=t.height;if(!(a(u)&&a(l)&&a(c)&&a(p)&&a(f)&&a(d)))throw new Error("Bad view - suspect a broken limiter");c=h(c,m,1/0),this._x=u,this._y=l,this._zoom=c,this._mediaAspectRatio=p,this._width=f,this._height=d,(u!==e||l!==i||c!==n||p!==r||f!==o||d!==s)&&(this._projectionChanged=!0,this.emit("change"))},n.prototype.updateWithControlParameters=function(t){var e=this.zoom();this.offsetX(t.axisScaledX*this.zoomX()+t.x*e),this.offsetY(-t.axisScaledY*this.zoomY()+-t.y*e),this.offsetZoom(t.zoom*e)},n.prototype.projection=function(){var t=this._projectionMatrix;if(this._projectionChanged){var e=this._x,i=this._y,n=this.zoomX(),r=this.zoomY(),o=this._frustum,a=o[0]=-i+.5*r,h=o[1]=e+.5*n,u=o[2]=-i-.5*r,l=o[3]=e-.5*n;s.ortho(t,l,h,u,a,-1,1),this._projectionChanged=!1}return t},n.prototype.selectLevel=function(t){for(var e=r()*this.width(),i=this._zoom,n=0;n<t.length;n++){var o=t[n];if(i*o.width()>=e)return o}return t[t.length-1]},n.prototype.intersects=function(t){var e=this._frustum;this.projection();for(var i=0;i<e.length;i++){for(var n=e[i],r=f[i],o=d[i],s=!1,a=0;a<t.length;a++){var h=t[a];if(0>o&&h[r]<n||o>0&&h[r]>n){s=!0;break}}if(!s)return!1}return!0},n.prototype.coordinatesToScreen=function(t,e){e||(e={}),this.projection();var i=this._frustum,n=i[0],r=i[1],o=i[2],s=i[3],a=this.width(),h=this.height();return e.x=a*(t.x-s)/(r-s),e.y=h*(t.y+n)/(n-o),e},n.prototype.screenToCoordinates=function(t,e){e||(e={}),this.projection();var i=this._frustum,n=i[0],r=i[1],o=i[2],s=i[3],a=this.width(),h=this.height();return e.x=s+t.x*(r-s)/a,e.y=t.y*(n-o)/h-n,e},n.limit={x:function(t,e){return function(i){return i.x=h(i.x,t,e),i}},y:function(t,e){return function(i){return i.y=h(i.y,t,e),i}},zoom:function(t,e){return function(i){return i.zoom=h(i.zoom,t,e),i}},resolution:function(t){return function(e){var i=e.width,n=r()*i/t;return e.zoom=h(e.zoom,n,1/0),e}},visibleX:function(t,e){return function(i){var n=e-t;i.zoom>n&&(i.zoom=n);var r=0+.5*i.zoom/n,o=1-.5*i.zoom/n;return i.x=h(i.x,r,o),i}},visibleY:function(t,e){return function(i){var n=i.width/i.height,r=(e-t)*n/i.mediaAspectRatio;i.zoom>r&&(i.zoom=r);var o=0+.5*i.zoom/r,s=1-.5*i.zoom/r;return i.y=h(i.y,o,s),i}},letterbox:function(){return function(t){var e=t.width/t.height,i=1,n=e/t.mediaAspectRatio;t.mediaAspectRatio>=e&&(t.zoom=Math.min(t.zoom,i)),t.mediaAspectRatio<=e&&(t.zoom=Math.min(t.zoom,n));var r,o;t.zoom>i?r=o=.5:(r=0+.5*t.zoom/i,o=1-.5*t.zoom/i);var s,a;return t.zoom>n?s=a=.5:(s=0+.5*t.zoom/n,a=1-.5*t.zoom/n),t.x=h(t.x,r,o),t.y=h(t.y,s,a),t}}},n.type=n.prototype.type="flat",e.exports=n},{"../util/clamp":89,"../util/eventEmitter":97,"../util/pixelRatio":104,"../util/real":106,"gl-matrix":2}],113:[function(t,e,i){"use strict";function n(t,e){this._yaw=t&&null!=t.yaw?t.yaw:_,this._pitch=t&&null!=t.pitch?t.pitch:y,this._fov=t&&null!=t.fov?t.fov:g,this._width=t&&null!=t.width?t.width:m,this._height=t&&null!=t.height?t.height:v,this._limiter=e||null,this._params={},this._frustum=new c,this._projectionMatrix=p.create(),this._projectionChanged=!0,this._ray=f.create(),this._invProj=p.create(),this._update()}var r=t("../util/eventEmitter"),o=t("../util/pixelRatio"),s=t("../util/convertFov"),a=t("../util/rotateVector"),h=t("../util/mod"),u=t("../util/real"),l=t("../util/clamp"),c=t("../Frustum"),p=t("gl-matrix").mat4,f=t("gl-matrix").vec4,d=t("../util/compose"),m=0,v=0,_=0,y=0,g=Math.PI/4,w=1e-4;r(n),n.prototype.destroy=function(){this._yaw=null,this._pitch=null,this._fov=null,this._width=null,this._height=null,this._limiter=null,this._params=null,this._frustum=null,this._projectionMatrix=null,this._projectionChanged=null,this._ray=null,this._invProj=null},n.prototype.yaw=function(){return this._yaw},n.prototype.pitch=function(){return this._pitch},n.prototype.fov=function(){return this._fov},n.prototype.size=function(t){return t||(t={}),t.width=this._width,t.height=this._height,t},n.prototype.parameters=function(t){return t||(t={}),t.yaw=this._yaw,t.pitch=this._pitch,t.fov=this._fov,t},n.prototype.setYaw=function(t){this._resetParams(),this._params.yaw=t,this._update(this._params)},n.prototype.setPitch=function(t){this._resetParams(),this._params.pitch=t,this._update(this._params)},n.prototype.setFov=function(t){this._resetParams(),this._params.fov=t,this._update(this._params)},n.prototype.offsetYaw=function(t){this.setYaw(this._yaw+t)},n.prototype.offsetPitch=function(t){this.setPitch(this._pitch+t)},n.prototype.offsetFov=function(t){this.setFov(this._fov+t)},n.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},n.prototype.setParameters=function(t){this._resetParams();var e=this._params;e.yaw=t.yaw,e.pitch=t.pitch,e.fov=t.fov,this._update(e)},n.prototype._resetParams=function(){var t=this._params;t.yaw=null,t.pitch=null,t.fov=null,t.width=null,t.height=null},n.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._yaw,i=this._pitch,n=this._fov,r=this._width,o=this._height;if(t.yaw=null!=t.yaw?t.yaw:e,t.pitch=null!=t.pitch?t.pitch:i,t.fov=null!=t.fov?t.fov:n,t.width=null!=t.width?t.width:r,t.height=null!=t.height?t.height:o,this._limiter&&(t=this._limiter(t),!t))throw new Error("Bad view limiter");t=this._normalize(t);var s=t.yaw,a=t.pitch,h=t.fov,l=t.width,c=t.height;if(!(u(s)&&u(a)&&u(h)&&u(l)&&u(c)))throw new Error("Bad view - suspect a broken limiter");this._yaw=s,this._pitch=a,this._fov=h,this._width=l,this._height=c,(s!==e||a!==i||h!==n||l!==r||c!==o)&&(this._projectionChanged=!0,this.emit("change"))},n.prototype._normalize=function(t){t.yaw=h(t.yaw-Math.PI,-2*Math.PI)+Math.PI,t.pitch=h(t.pitch-Math.PI,-2*Math.PI)+Math.PI;var e=s.htov(Math.PI,t.width,t.height),i=isNaN(e)?Math.PI:Math.min(Math.PI,e);return t.fov=l(t.fov,w,i-w),t},n.prototype.updateWithControlParameters=function(t){var e=this._fov,i=s.vtoh(e,this._height,this._width);isNaN(i)&&(i=e),this.offsetYaw(t.axisScaledX*i+2*t.x*i+t.yaw),this.offsetPitch(-t.axisScaledY*e+2*-t.y*i+t.pitch),this.offsetFov(t.zoom*e)},n.prototype.projection=function(){var t=this._projectionMatrix;if(this._projectionChanged){var e=this._width/this._height;p.perspective(t,this._fov,e,-1,1),p.rotateX(t,t,this.pitch()),p.rotateY(t,t,this.yaw()),this._projectionChanged=!1}return t},n.prototype.selectLevel=function(t){for(var e=o()*this._height,i=Math.tan(.5*this._fov),n=0;n<t.length;n++){var r=t[n];if(i*r.height()>=e)return r}return t[t.length-1]},n.prototype.intersects=function(t){var e=this._frustum,i=this._yaw,n=this._pitch,r=this._fov,o=s.vtoh(r,this._height,this._width);return isNaN(o)&&(o=r),e.intersects(i,n,o,r,t)},n.prototype.coordinatesToScreen=function(t,e){var i=this._ray;e||(e={});var n=this._width,r=this._height;if(0>=n||0>=r)return e.x=null,e.y=null,null;f.set(i,0,0,-1,1),a(i,i,0,-t.yaw,-t.pitch),f.transformMat4(i,i,this.projection());for(var o=0;3>o;o++)i[o]/=i[3];return i[2]>=0?(e.x=n*(i[0]+1)/2,e.y=r*(1-i[1])/2,e):(e.x=null,e.y=null,null)},n.prototype.screenToCoordinates=function(t,e){var i=this._ray,n=this._invProj;e||(e={});var r=this._width,o=this._height;p.invert(n,this.projection());var s=2*t.x/r-1,a=1-2*t.y/o;f.set(i,s,a,1,1),f.transformMat4(i,i,n);var h=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);return e.yaw=Math.atan(i[0],-i[2]),e.pitch=Math.acos(i[1]/h)-Math.PI/2,e},n.prototype.setLimiter=function(t){this._limiter=t||null,this._update()},n.limit={yaw:function(t,e){return function(i){return i.yaw=l(i.yaw,t,e),i}},pitch:function(t,e){return function(i){return i.pitch=l(i.pitch,t,e),i}},hfov:function(t,e){return function(i){var n=i.width,r=i.height;if(n>0&&r>0){var o=s.htov(t,n,r),a=s.htov(e,n,r);i.fov=l(i.fov,o,a)}return i}},vfov:function(t,e){return function(i){return i.fov=l(i.fov,t,e),i}},resolution:function(t){return function(e){var i=e.height;if(i){var n=o()*i,r=2*Math.atan(n/t);e.fov=l(e.fov,r,1/0)}return e}},maxResolutionAndMaxFov:function(t,e){return d(n.limit.resolution(t),n.limit.hfov(0,e),n.limit.vfov(0,e),n.limit.pitch(-Math.PI/2,Math.PI/2))}},n.type=n.prototype.type="rectilinear",e.exports=n},{"../Frustum":5,"../util/clamp":89,"../util/compose":92,"../util/convertFov":93,"../util/eventEmitter":97,"../util/mod":101,"../util/pixelRatio":104,"../util/real":106,"../util/rotateVector":108,"gl-matrix":2}]},{},[49])(49)});